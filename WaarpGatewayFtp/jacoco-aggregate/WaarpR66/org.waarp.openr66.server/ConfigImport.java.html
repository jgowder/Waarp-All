<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>ConfigImport.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Waarp Gateway Ftp</a> &gt; <a href="../index.html" class="el_bundle">WaarpR66</a> &gt; <a href="index.source.html" class="el_package">org.waarp.openr66.server</a> &gt; <span class="el_source">ConfigImport.java</span></div><h1>ConfigImport.java</h1><pre class="source lang-java linenums">/*
 * This file is part of Waarp Project (named also Waarp or GG).
 *
 *  Copyright (c) 2019, Waarp SAS, and individual contributors by the @author
 *  tags. See the COPYRIGHT.txt in the distribution for a full listing of
 * individual contributors.
 *
 *  All Waarp Project is free software: you can redistribute it and/or
 * modify it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or (at your
 * option) any later version.
 *
 * Waarp is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along with
 * Waarp . If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package org.waarp.openr66.server;

import org.waarp.common.database.exception.WaarpDatabaseException;
import org.waarp.common.logging.WaarpLogger;
import org.waarp.common.logging.WaarpLoggerFactory;
import org.waarp.common.logging.WaarpSlf4JLoggerFactory;
import org.waarp.openr66.client.AbstractTransfer;
import org.waarp.openr66.configuration.FileBasedConfiguration;
import org.waarp.openr66.context.ErrorCode;
import org.waarp.openr66.context.R66FiniteDualStates;
import org.waarp.openr66.context.R66Result;
import org.waarp.openr66.database.data.DbHostAuth;
import org.waarp.openr66.protocol.configuration.Configuration;
import org.waarp.openr66.protocol.configuration.PartnerConfiguration;
import org.waarp.openr66.protocol.localhandler.LocalChannelReference;
import org.waarp.openr66.protocol.localhandler.packet.AbstractLocalPacket;
import org.waarp.openr66.protocol.localhandler.packet.JsonCommandPacket;
import org.waarp.openr66.protocol.localhandler.packet.LocalPacketFactory;
import org.waarp.openr66.protocol.localhandler.packet.ValidPacket;
import org.waarp.openr66.protocol.localhandler.packet.json.ConfigImportJsonPacket;
import org.waarp.openr66.protocol.networkhandler.NetworkTransaction;
import org.waarp.openr66.protocol.utils.R66Future;

import static org.waarp.common.database.DbConstant.*;

/**
 * Config Import from a local client without database connection
 */
public class ConfigImport implements Runnable {
  /**
   * Internal Logger
   */
  static volatile WaarpLogger logger;

  protected static final String INFO_ARGS =
      &quot;Need at least the configuration file as first argument then at least one from\n&quot; +
      &quot;    -hosts file\n&quot; + &quot;    -rules file\n&quot; +
      &quot;    -business file (if compatible)\n&quot; +
      &quot;    -alias file (if compatible)\n&quot; +
      &quot;    -roles file (if compatible)\n&quot; + &quot;    -purgehosts\n&quot; +
      &quot;    -purgerules\n&quot; + &quot;    -purgebusiness (if compatible)\n&quot; +
      &quot;    -purgealias (if compatible)\n&quot; +
      &quot;    -purgeroles (if compatible)\n&quot; +
      &quot;    -hostid file transfer id (if compatible)\n&quot; +
      &quot;    -ruleid file transfer id (if compatible)\n&quot; +
      &quot;    -businessid file transfer id (if compatible)\n&quot; +
      &quot;    -aliasid file transfer id (if compatible)\n&quot; +
      &quot;    -roleid file transfer id (if compatible)\n&quot; +
      &quot;    -host host (optional)&quot;;

  protected final R66Future future;
  protected final String host;
  protected final boolean hostPurge;
  protected final String rule;
  protected final boolean rulePurge;
  protected final String business;
  protected final boolean businessPurge;
  protected final String alias;
  protected final boolean aliasPurge;
  protected final String role;
  protected final boolean rolePurge;
<span class="nc" id="L81">  protected long hostid = ILLEGALVALUE;</span>
<span class="nc" id="L82">  protected long ruleid = ILLEGALVALUE;</span>
<span class="nc" id="L83">  protected long businessid = ILLEGALVALUE;</span>
<span class="nc" id="L84">  protected long aliasid = ILLEGALVALUE;</span>
<span class="nc" id="L85">  protected long roleid = ILLEGALVALUE;</span>
  protected final NetworkTransaction networkTransaction;
  protected DbHostAuth dbhost;

  public ConfigImport(final R66Future future, final boolean hostPurge,
                      final boolean rulePurge, final String host,
                      final String rule,
<span class="nc" id="L92">                      final NetworkTransaction networkTransaction) {</span>
<span class="nc" id="L93">    this.future = future;</span>
<span class="nc" id="L94">    this.host = host;</span>
<span class="nc" id="L95">    this.rule = rule;</span>
<span class="nc" id="L96">    this.hostPurge = hostPurge;</span>
<span class="nc" id="L97">    this.rulePurge = rulePurge;</span>
<span class="nc" id="L98">    business = null;</span>
<span class="nc" id="L99">    businessPurge = false;</span>
<span class="nc" id="L100">    alias = null;</span>
<span class="nc" id="L101">    aliasPurge = false;</span>
<span class="nc" id="L102">    role = null;</span>
<span class="nc" id="L103">    rolePurge = false;</span>
<span class="nc" id="L104">    this.networkTransaction = networkTransaction;</span>
<span class="nc" id="L105">    dbhost = Configuration.configuration.getHostSslAuth();</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">    if (logger == null) {</span>
<span class="nc" id="L107">      logger = WaarpLoggerFactory.getLogger(ConfigImport.class);</span>
    }
<span class="nc" id="L109">  }</span>

  public ConfigImport(final R66Future future, final boolean hostPurge,
                      final boolean rulePurge, final boolean businessPurge,
                      final boolean aliasPurge, final boolean rolePurge,
                      final String host, final String rule,
                      final String business, final String alias,
                      final String role,
<span class="nc" id="L117">                      final NetworkTransaction networkTransaction) {</span>
<span class="nc" id="L118">    this.future = future;</span>
<span class="nc" id="L119">    this.host = host;</span>
<span class="nc" id="L120">    this.rule = rule;</span>
<span class="nc" id="L121">    this.hostPurge = hostPurge;</span>
<span class="nc" id="L122">    this.rulePurge = rulePurge;</span>
<span class="nc" id="L123">    this.business = business;</span>
<span class="nc" id="L124">    this.businessPurge = businessPurge;</span>
<span class="nc" id="L125">    this.alias = alias;</span>
<span class="nc" id="L126">    this.aliasPurge = aliasPurge;</span>
<span class="nc" id="L127">    this.role = role;</span>
<span class="nc" id="L128">    this.rolePurge = rolePurge;</span>
<span class="nc" id="L129">    this.networkTransaction = networkTransaction;</span>
<span class="nc" id="L130">    dbhost = Configuration.configuration.getHostSslAuth();</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">    if (logger == null) {</span>
<span class="nc" id="L132">      logger = WaarpLoggerFactory.getLogger(ConfigImport.class);</span>
    }
<span class="nc" id="L134">  }</span>

  /**
   * Used when the filenames are not compliant with remote filenames.
   *
   * @param hostid
   * @param ruleid
   * @param businessid
   * @param aliasid
   * @param roleid
   */
  public final void setSpecialIds(final long hostid, final long ruleid,
                                  final long businessid, final long aliasid,
                                  final long roleid) {
<span class="nc" id="L148">    this.hostid = hostid;</span>
<span class="nc" id="L149">    this.ruleid = ruleid;</span>
<span class="nc" id="L150">    this.businessid = businessid;</span>
<span class="nc" id="L151">    this.aliasid = aliasid;</span>
<span class="nc" id="L152">    this.roleid = roleid;</span>
<span class="nc" id="L153">  }</span>

  public final void setHost(final DbHostAuth host) {
<span class="nc" id="L156">    dbhost = host;</span>
<span class="nc" id="L157">  }</span>

  /**
   * Prior to call this method, the pipeline and NetworkTransaction must have
   * been initialized. It is the
   * responsibility of the caller to finish all network resources.
   */
  @Override
  public void run() {
<span class="nc bnc" id="L166" title="All 2 branches missed.">    if (logger == null) {</span>
<span class="nc" id="L167">      logger = WaarpLoggerFactory.getLogger(ConfigImport.class);</span>
    }
<span class="nc" id="L169">    final LocalChannelReference localChannelReference =</span>
<span class="nc" id="L170">        AbstractTransfer.tryConnect(dbhost, future, networkTransaction);</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">    if (localChannelReference == null) {</span>
<span class="nc" id="L172">      return;</span>
    }
<span class="nc" id="L174">    localChannelReference.sessionNewState(R66FiniteDualStates.VALIDOTHER);</span>
<span class="nc" id="L175">    final boolean useJson = PartnerConfiguration.useJson(dbhost.getHostid());</span>
<span class="nc" id="L176">    logger.debug(&quot;UseJson: {}&quot;, useJson);</span>
    final AbstractLocalPacket valid;
<span class="nc bnc" id="L178" title="All 2 branches missed.">    if (useJson) {</span>
<span class="nc" id="L179">      final ConfigImportJsonPacket node = new ConfigImportJsonPacket();</span>
<span class="nc" id="L180">      node.setHost(host);</span>
<span class="nc" id="L181">      node.setRule(rule);</span>
<span class="nc" id="L182">      node.setBusiness(business);</span>
<span class="nc" id="L183">      node.setAlias(alias);</span>
<span class="nc" id="L184">      node.setRoles(role);</span>
<span class="nc" id="L185">      node.setPurgehost(hostPurge);</span>
<span class="nc" id="L186">      node.setPurgerule(rulePurge);</span>
<span class="nc" id="L187">      node.setPurgebusiness(businessPurge);</span>
<span class="nc" id="L188">      node.setPurgealias(aliasPurge);</span>
<span class="nc" id="L189">      node.setPurgeroles(rolePurge);</span>
<span class="nc" id="L190">      node.setHostid(hostid);</span>
<span class="nc" id="L191">      node.setRuleid(ruleid);</span>
<span class="nc" id="L192">      node.setBusinessid(businessid);</span>
<span class="nc" id="L193">      node.setAliasid(aliasid);</span>
<span class="nc" id="L194">      node.setRolesid(roleid);</span>
<span class="nc" id="L195">      valid = new JsonCommandPacket(node, LocalPacketFactory.CONFIMPORTPACKET);</span>
<span class="nc" id="L196">    } else {</span>
<span class="nc bnc" id="L197" title="All 4 branches missed.">      valid = new ValidPacket((hostPurge? &quot;1 &quot; : &quot;0 &quot;) + host,</span>
                              (rulePurge? &quot;1 &quot; : &quot;0 &quot;) + rule,
                              LocalPacketFactory.CONFIMPORTPACKET);
    }
<span class="nc" id="L201">    AbstractTransfer.sendValidPacket(dbhost, localChannelReference, valid,</span>
                                     future);
<span class="nc" id="L203">    logger.debug(&quot;Request done with {}&quot;,</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">                 (future.isSuccess()? &quot;success&quot; : &quot;error&quot;));</span>
<span class="nc" id="L205">  }</span>

  protected static String shost;
  protected static String srule;
  protected static String sbusiness;
  protected static String salias;
  protected static String srole;
  protected static boolean shostpurge;
  protected static boolean srulepurge;
  protected static boolean sbusinesspurge;
  protected static boolean saliaspurge;
  protected static boolean srolepurge;
  protected static String stohost;
<span class="nc" id="L218">  protected static long lhost = ILLEGALVALUE;</span>
<span class="nc" id="L219">  protected static long lrule = ILLEGALVALUE;</span>
<span class="nc" id="L220">  protected static long lbusiness = ILLEGALVALUE;</span>
<span class="nc" id="L221">  protected static long lalias = ILLEGALVALUE;</span>
<span class="nc" id="L222">  protected static long lrole = ILLEGALVALUE;</span>

  protected static boolean getParams(final String[] args) {
<span class="nc bnc" id="L225" title="All 2 branches missed.">    if (logger == null) {</span>
<span class="nc" id="L226">      logger = WaarpLoggerFactory.getLogger(ConfigImport.class);</span>
    }
<span class="nc bnc" id="L228" title="All 2 branches missed.">    if (args.length &lt; 3) {</span>
<span class="nc" id="L229">      logger.error(INFO_ARGS);</span>
<span class="nc" id="L230">      return false;</span>
    }
<span class="nc bnc" id="L232" title="All 2 branches missed.">    if (!FileBasedConfiguration.setClientConfigurationFromXml(</span>
        Configuration.configuration, args[0])) {
<span class="nc" id="L234">      logger.error(INFO_ARGS);</span>
<span class="nc" id="L235">      return false;</span>
    }
<span class="nc bnc" id="L237" title="All 2 branches missed.">    for (int i = 1; i &lt; args.length; i++) {</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">      if (&quot;-hosts&quot;.equalsIgnoreCase(args[i])) {</span>
<span class="nc" id="L239">        i++;</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">        if (args.length &lt;= i) {</span>
<span class="nc" id="L241">          return false;</span>
        }
<span class="nc" id="L243">        shost = args[i];</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">      } else if (&quot;-rules&quot;.equalsIgnoreCase(args[i])) {</span>
<span class="nc" id="L245">        i++;</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">        if (args.length &lt;= i) {</span>
<span class="nc" id="L247">          return false;</span>
        }
<span class="nc" id="L249">        srule = args[i];</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">      } else if (&quot;-business&quot;.equalsIgnoreCase(args[i])) {</span>
<span class="nc" id="L251">        i++;</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">        if (args.length &lt;= i) {</span>
<span class="nc" id="L253">          return false;</span>
        }
<span class="nc" id="L255">        sbusiness = args[i];</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">      } else if (&quot;-alias&quot;.equalsIgnoreCase(args[i])) {</span>
<span class="nc" id="L257">        i++;</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">        if (args.length &lt;= i) {</span>
<span class="nc" id="L259">          return false;</span>
        }
<span class="nc" id="L261">        salias = args[i];</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">      } else if (&quot;-roles&quot;.equalsIgnoreCase(args[i])) {</span>
<span class="nc" id="L263">        i++;</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">        if (args.length &lt;= i) {</span>
<span class="nc" id="L265">          return false;</span>
        }
<span class="nc" id="L267">        srole = args[i];</span>
<span class="nc bnc" id="L268" title="All 2 branches missed.">      } else if (&quot;-purgehosts&quot;.equalsIgnoreCase(args[i])) {</span>
<span class="nc" id="L269">        shostpurge = true;</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">      } else if (&quot;-purgerules&quot;.equalsIgnoreCase(args[i])) {</span>
<span class="nc" id="L271">        srulepurge = true;</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">      } else if (&quot;-purgebusiness&quot;.equalsIgnoreCase(args[i])) {</span>
<span class="nc" id="L273">        sbusinesspurge = true;</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">      } else if (&quot;-purgealias&quot;.equalsIgnoreCase(args[i])) {</span>
<span class="nc" id="L275">        saliaspurge = true;</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">      } else if (&quot;-purgeroles&quot;.equalsIgnoreCase(args[i])) {</span>
<span class="nc" id="L277">        srolepurge = true;</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">      } else if (&quot;-host&quot;.equalsIgnoreCase(args[i])) {</span>
<span class="nc" id="L279">        i++;</span>
<span class="nc" id="L280">        stohost = args[i];</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">      } else if (&quot;-hostid&quot;.equalsIgnoreCase(args[i])) {</span>
<span class="nc" id="L282">        i++;</span>
<span class="nc bnc" id="L283" title="All 2 branches missed.">        if (args.length &lt;= i) {</span>
<span class="nc" id="L284">          return false;</span>
        }
        try {
<span class="nc" id="L287">          lhost = Long.parseLong(args[i]);</span>
<span class="nc" id="L288">        } catch (final NumberFormatException e) {</span>
<span class="nc" id="L289">          return false;</span>
<span class="nc" id="L290">        }</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">      } else if (&quot;-ruleid&quot;.equalsIgnoreCase(args[i])) {</span>
<span class="nc" id="L292">        i++;</span>
<span class="nc bnc" id="L293" title="All 2 branches missed.">        if (args.length &lt;= i) {</span>
<span class="nc" id="L294">          return false;</span>
        }
        try {
<span class="nc" id="L297">          lrule = Long.parseLong(args[i]);</span>
<span class="nc" id="L298">        } catch (final NumberFormatException e) {</span>
<span class="nc" id="L299">          return false;</span>
<span class="nc" id="L300">        }</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">      } else if (&quot;-businessid&quot;.equalsIgnoreCase(args[i])) {</span>
<span class="nc" id="L302">        i++;</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">        if (args.length &lt;= i) {</span>
<span class="nc" id="L304">          return false;</span>
        }
        try {
<span class="nc" id="L307">          lbusiness = Long.parseLong(args[i]);</span>
<span class="nc" id="L308">        } catch (final NumberFormatException e) {</span>
<span class="nc" id="L309">          return false;</span>
<span class="nc" id="L310">        }</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">      } else if (&quot;-aliasid&quot;.equalsIgnoreCase(args[i])) {</span>
<span class="nc" id="L312">        i++;</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">        if (args.length &lt;= i) {</span>
<span class="nc" id="L314">          return false;</span>
        }
        try {
<span class="nc" id="L317">          lalias = Long.parseLong(args[i]);</span>
<span class="nc" id="L318">        } catch (final NumberFormatException e) {</span>
<span class="nc" id="L319">          return false;</span>
<span class="nc" id="L320">        }</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">      } else if (&quot;-roleid&quot;.equalsIgnoreCase(args[i])) {</span>
<span class="nc" id="L322">        i++;</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">        if (args.length &lt;= i) {</span>
<span class="nc" id="L324">          return false;</span>
        }
        try {
<span class="nc" id="L327">          lrole = Long.parseLong(args[i]);</span>
<span class="nc" id="L328">        } catch (final NumberFormatException e) {</span>
<span class="nc" id="L329">          return false;</span>
<span class="nc" id="L330">        }</span>
      }
    }
<span class="nc" id="L333">    return true;</span>
  }

  public static void main(final String[] args) {
<span class="nc" id="L337">    WaarpLoggerFactory.setDefaultFactoryIfNotSame(</span>
        new WaarpSlf4JLoggerFactory(null));
<span class="nc bnc" id="L339" title="All 2 branches missed.">    if (logger == null) {</span>
<span class="nc" id="L340">      logger = WaarpLoggerFactory.getLogger(ConfigImport.class);</span>
    }
<span class="nc bnc" id="L342" title="All 2 branches missed.">    if (!getParams(args)) {</span>
<span class="nc" id="L343">      logger.error(&quot;Wrong initialization&quot;);</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">      if (admin != null) {</span>
<span class="nc" id="L345">        admin.close();</span>
      }
<span class="nc" id="L347">      System.exit(1);//NOSONAR</span>
    }
<span class="nc" id="L349">    final long time1 = System.currentTimeMillis();</span>
<span class="nc" id="L350">    final R66Future future = new R66Future(true);</span>

<span class="nc" id="L352">    Configuration.configuration.pipelineInit();</span>
<span class="nc" id="L353">    final NetworkTransaction networkTransaction = new NetworkTransaction();</span>
    try {
<span class="nc" id="L355">      final ConfigImport transaction =</span>
          new ConfigImport(future, shostpurge, srulepurge, sbusinesspurge,
                           saliaspurge, srolepurge, shost, srule, sbusiness,
                           salias, srole, networkTransaction);
<span class="nc" id="L359">      transaction.setSpecialIds(lhost, lrule, lbusiness, lalias, lrole);</span>
<span class="nc bnc" id="L360" title="All 2 branches missed.">      if (stohost != null) {</span>
        try {
<span class="nc" id="L362">          transaction.setHost(new DbHostAuth(stohost));</span>
<span class="nc" id="L363">        } catch (final WaarpDatabaseException e) {</span>
<span class="nc" id="L364">          logger.error(</span>
              &quot;ConfigImport in     FAILURE since Host is not found: &quot; + stohost,
              e);
<span class="nc" id="L367">          networkTransaction.closeAll();</span>
<span class="nc" id="L368">          System.exit(10);//NOSONAR</span>
<span class="nc" id="L369">        }</span>
      } else {
<span class="nc" id="L371">        stohost = Configuration.configuration.getHostSslId();</span>
      }
<span class="nc" id="L373">      transaction.run();</span>
<span class="nc" id="L374">      future.awaitOrInterruptible();</span>
<span class="nc" id="L375">      final long time2 = System.currentTimeMillis();</span>
<span class="nc" id="L376">      final long delay = time2 - time1;</span>
<span class="nc" id="L377">      final R66Result result = future.getResult();</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">      if (future.isSuccess()) {</span>
<span class="nc" id="L379">        final boolean useJson = PartnerConfiguration.useJson(stohost);</span>
<span class="nc" id="L380">        logger.debug(&quot;UseJson: {}&quot;, useJson);</span>
        final String message;
<span class="nc bnc" id="L382" title="All 2 branches missed.">        if (useJson) {</span>
<span class="nc bnc" id="L383" title="All 2 branches missed.">          message = result.getOther() != null?</span>
<span class="nc" id="L384">              ((JsonCommandPacket) result.getOther()).getRequest() : &quot;no file&quot;;</span>
        } else {
<span class="nc bnc" id="L386" title="All 2 branches missed.">          message = result.getOther() != null?</span>
<span class="nc" id="L387">              ((ValidPacket) result.getOther()).getSheader() : &quot;no file&quot;;</span>
        }
<span class="nc bnc" id="L389" title="All 2 branches missed.">        if (result.getCode() == ErrorCode.Warning) {</span>
<span class="nc" id="L390">          logger.warn(</span>
              &quot;WARNED on import:     &quot; + message + &quot;     delay: &quot; + delay);
        } else {
<span class="nc" id="L393">          logger.warn(</span>
              &quot;SUCCESS on import:     &quot; + message + &quot;     delay: &quot; + delay);
        }
<span class="nc" id="L396">      } else {</span>
<span class="nc bnc" id="L397" title="All 2 branches missed.">        if (result.getCode() == ErrorCode.Warning) {</span>
<span class="nc" id="L398">          logger.warn(&quot;ConfigImport is     WARNED&quot; + &quot; : {}&quot;,</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">                      future.getCause() != null?</span>
<span class="nc" id="L400">                          future.getCause().getMessage() : &quot;&quot;);</span>
        } else {
<span class="nc" id="L402">          logger.error(&quot;ConfigImport in     FAILURE&quot; + &quot; : {}&quot;,</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">                       future.getCause() != null?</span>
<span class="nc" id="L404">                           future.getCause().getMessage() : &quot;&quot;);</span>
        }
<span class="nc" id="L406">        networkTransaction.closeAll();</span>
<span class="nc" id="L407">        System.exit(result.getCode().ordinal());//NOSONAR</span>
      }
    } finally {
<span class="nc" id="L410">      networkTransaction.closeAll();</span>
<span class="nc" id="L411">      System.exit(0);//NOSONAR</span>
    }
<span class="nc" id="L413">  }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>