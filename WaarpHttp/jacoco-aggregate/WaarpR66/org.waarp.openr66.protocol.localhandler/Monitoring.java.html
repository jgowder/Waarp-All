<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>Monitoring.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Waarp Http</a> &gt; <a href="../index.html" class="el_bundle">WaarpR66</a> &gt; <a href="index.source.html" class="el_package">org.waarp.openr66.protocol.localhandler</a> &gt; <span class="el_source">Monitoring.java</span></div><h1>Monitoring.java</h1><pre class="source lang-java linenums">/*
 * This file is part of Waarp Project (named also Waarp or GG).
 *
 *  Copyright (c) 2019, Waarp SAS, and individual contributors by the @author
 *  tags. See the COPYRIGHT.txt in the distribution for a full listing of
 * individual contributors.
 *
 *  All Waarp Project is free software: you can redistribute it and/or
 * modify it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or (at your
 * option) any later version.
 *
 * Waarp is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along with
 * Waarp . If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package org.waarp.openr66.protocol.localhandler;

import com.fasterxml.jackson.databind.node.ObjectNode;
import io.netty.handler.traffic.TrafficCounter;
import org.joda.time.DateTime;
import org.waarp.common.database.DbAdmin;
import org.waarp.common.database.DbPreparedStatement;
import org.waarp.common.database.DbSession;
import org.waarp.common.database.data.AbstractDbData.UpdatedInfo;
import org.waarp.common.database.exception.WaarpDatabaseNoConnectionException;
import org.waarp.common.database.exception.WaarpDatabaseSqlException;
import org.waarp.common.json.JsonHandler;
import org.waarp.common.logging.WaarpLogger;
import org.waarp.common.logging.WaarpLoggerFactory;
import org.waarp.openr66.commander.CommanderNoDb;
import org.waarp.openr66.context.ErrorCode;
import org.waarp.openr66.database.data.DbTaskRunner;
import org.waarp.openr66.database.data.DbTaskRunner.TASKSTEP;
import org.waarp.openr66.protocol.configuration.Configuration;
import org.waarp.openr66.protocol.snmp.R66PrivateMib;
import org.waarp.snmp.WaarpSnmpAgent;
import org.waarp.snmp.interf.WaarpInterfaceMonitor;
import org.waarp.snmp.r66.WaarpPrivateMib.MibLevel;
import org.waarp.snmp.r66.WaarpPrivateMib.WaarpDetailedValuesIndex;
import org.waarp.snmp.r66.WaarpPrivateMib.WaarpErrorValuesIndex;
import org.waarp.snmp.r66.WaarpPrivateMib.WaarpGlobalValuesIndex;

import static org.waarp.common.database.DbConstant.*;

/**
 * Monitoring class as an helper to get values of interest. Also used by SNMP
 * support.
 */
public class Monitoring implements WaarpInterfaceMonitor {
  /**
   * Internal Logger
   */
<span class="fc" id="L57">  private static final WaarpLogger logger =</span>
<span class="fc" id="L58">      WaarpLoggerFactory.getLogger(Monitoring.class);</span>

  public WaarpSnmpAgent agent;

  // global informations
  public long nbNetworkConnection;
  public long secondsRunning;
  public long nbThread;
  public long bandwidthIn;
  public long bandwidthOut;

  // Internal data
<span class="fc" id="L70">  private final long startMonitor = System.currentTimeMillis();</span>
  private final long pastLimit;
  private long currentLimit;
  private final long minimalDelay;
  private long lastTry;
  private DbSession dbSession;
<span class="fc" id="L76">  private final TrafficCounter trafficCounter =</span>
<span class="fc" id="L77">      Configuration.configuration.getGlobalTrafficShapingHandler()</span>
<span class="fc" id="L78">                                 .trafficCounter();</span>

  // Overall status including past, future and current transfers
  private DbPreparedStatement countInfo;

  // Current situation of all transfers, running or not
  private DbPreparedStatement countInActiveTransfer;
  private DbPreparedStatement countOutActiveTransfer;
  private DbPreparedStatement countInTotalTransfer;
  private DbPreparedStatement countOutTotalTransfer;
  private DbPreparedStatement countInErrorTransfer;
  private DbPreparedStatement countOutErrorTransfer;
  private DbPreparedStatement countStepAllTransfer;
  private DbPreparedStatement countStepNotask;
  private DbPreparedStatement countStepPretask;
  private DbPreparedStatement countStepTransfer;
  private DbPreparedStatement countStepPosttask;
  private DbPreparedStatement countStepAllDone;
  private DbPreparedStatement countStepError;

  // First on Running Transfers only
  private DbPreparedStatement countAllRunningStep;
  private DbPreparedStatement countRunningStep;
  private DbPreparedStatement countInitOkStep;
  private DbPreparedStatement countPreProcessingOkStep;
  private DbPreparedStatement countTransferOkStep;
  private DbPreparedStatement countPostProcessingOkStep;
  private DbPreparedStatement countCompleteOkStep;

  // Error Status on all transfers
  private DbPreparedStatement countStatus;

  // Overall status including past, future and current transfers
  public long nbCountInfoUnknown;
  public long nbCountInfoNotUpdated;
  public long nbCountInfoInterrupted;
  public long nbCountInfoToSubmit;
  public long nbCountInfoError;
  public long nbCountInfoRunning;
  public long nbCountInfoDone;

  public long nbInActiveTransfer;
  public long nbOutActiveTransfer;
<span class="fc" id="L121">  public long lastInActiveTransfer = System.currentTimeMillis();</span>
<span class="fc" id="L122">  public long lastOutActiveTransfer = System.currentTimeMillis();</span>
  public long nbInTotalTransfer;
  public long nbOutTotalTransfer;
  public long nbInErrorTransfer;
  public long nbOutErrorTransfer;

  // Current situation of all transfers, running or not
  public long nbCountStepAllTransfer;
  public long nbCountStepNotask;
  public long nbCountStepPretask;
  public long nbCountStepTransfer;
  public long nbCountStepPosttask;
  public long nbCountStepAllDone;
  public long nbCountStepError;

  // First on Running Transfers only
  public long nbCountAllRunningStep;
  public long nbCountRunningStep;
  public long nbCountInitOkStep;
  public long nbCountPreProcessingOkStep;
  public long nbCountTransferOkStep;
  public long nbCountPostProcessingOkStep;
  public long nbCountCompleteOkStep;

  // Error Status on all transfers
  public long nbCountStatusConnectionImpossible;
  public long nbCountStatusServerOverloaded;
  public long nbCountStatusBadAuthent;
  public long nbCountStatusExternalOp;
  public long nbCountStatusTransferError;
  public long nbCountStatusMD5Error;
  public long nbCountStatusDisconnection;
  public long nbCountStatusFinalOp;
  public long nbCountStatusUnimplemented;
  public long nbCountStatusInternal;
  public long nbCountStatusWarning;
  public long nbCountStatusQueryAlreadyFinished;
  public long nbCountStatusQueryStillRunning;
  public long nbCountStatusNotKnownHost;
  public long nbCountStatusQueryRemotelyUnknown;
  public long nbCountStatusCommandNotFound;
  public long nbCountStatusPassThroughMode;
  public long nbCountStatusRemoteShutdown;
  public long nbCountStatusShutdown;
  public long nbCountStatusRemoteError;
  public long nbCountStatusStopped;
  public long nbCountStatusCanceled;
  public long nbCountStatusFileNotFound;
  public long nbCountStatusUnknown;

  /**
   * @param pastLimit
   * @param minimalDelay
   * @param session
   */
<span class="fc" id="L177">  public Monitoring(long pastLimit, long minimalDelay, DbSession session) {</span>
<span class="fc" id="L178">    this.pastLimit = pastLimit;</span>
<span class="fc" id="L179">    this.minimalDelay = minimalDelay;</span>
<span class="pc bpc" id="L180" title="1 of 2 branches missed.">    if (session != null) {</span>
<span class="nc" id="L181">      dbSession = session;</span>
    } else {
      try {
<span class="fc" id="L184">        dbSession = new DbSession(admin, false);</span>
<span class="fc" id="L185">      } catch (final WaarpDatabaseNoConnectionException e) {</span>
<span class="fc" id="L186">        dbSession = admin.getSession();</span>
<span class="fc" id="L187">      }</span>
    }
<span class="fc" id="L189">    initialize();</span>
<span class="fc" id="L190">  }</span>

  /**
   * Initialize the Db Requests after constructor or after use of
   * releaseResources
   */
  @Override
  public void initialize() {
<span class="pc bpc" id="L198" title="1 of 4 branches missed.">    if (dbSession == null || dbSession.isDisActive()) {</span>
<span class="fc" id="L199">      logger.warn(&quot;Cannot Initialize monitoring&quot;);</span>
<span class="fc" id="L200">      return;</span>
    }
    try {
<span class="fc" id="L203">      logger.debug(&quot;Initialize monitoring&quot;);</span>
      // Overall status including past, future and current transfers
<span class="fc" id="L205">      countInfo = DbTaskRunner.getCountInfoPrepareStatement(dbSession);</span>
      // Count of Active/All In/Out transfers
<span class="fc" id="L207">      countInActiveTransfer = DbTaskRunner</span>
<span class="fc" id="L208">          .getCountInOutRunningPrepareStatement(dbSession, true, true);</span>
<span class="fc" id="L209">      countOutActiveTransfer = DbTaskRunner</span>
<span class="fc" id="L210">          .getCountInOutRunningPrepareStatement(dbSession, false, true);</span>
<span class="fc" id="L211">      countInTotalTransfer = DbTaskRunner</span>
<span class="fc" id="L212">          .getCountInOutRunningPrepareStatement(dbSession, true, false);</span>
<span class="fc" id="L213">      countOutTotalTransfer = DbTaskRunner</span>
<span class="fc" id="L214">          .getCountInOutRunningPrepareStatement(dbSession, false, false);</span>

<span class="fc" id="L216">      countInErrorTransfer =</span>
<span class="fc" id="L217">          DbTaskRunner.getCountInOutErrorPrepareStatement(dbSession, true);</span>
<span class="fc" id="L218">      countOutErrorTransfer =</span>
<span class="fc" id="L219">          DbTaskRunner.getCountInOutErrorPrepareStatement(dbSession, false);</span>

      // Current situation of all transfers, running or not
<span class="fc" id="L222">      countStepAllTransfer =</span>
<span class="fc" id="L223">          DbTaskRunner.getCountStepPrepareStatement(dbSession, null);</span>
<span class="fc" id="L224">      countStepNotask =</span>
<span class="fc" id="L225">          DbTaskRunner.getCountStepPrepareStatement(dbSession, TASKSTEP.NOTASK);</span>
<span class="fc" id="L226">      countStepPretask = DbTaskRunner</span>
<span class="fc" id="L227">          .getCountStepPrepareStatement(dbSession, TASKSTEP.PRETASK);</span>
<span class="fc" id="L228">      countStepTransfer = DbTaskRunner</span>
<span class="fc" id="L229">          .getCountStepPrepareStatement(dbSession, TASKSTEP.TRANSFERTASK);</span>
<span class="fc" id="L230">      countStepPosttask = DbTaskRunner</span>
<span class="fc" id="L231">          .getCountStepPrepareStatement(dbSession, TASKSTEP.POSTTASK);</span>
<span class="fc" id="L232">      countStepAllDone = DbTaskRunner</span>
<span class="fc" id="L233">          .getCountStepPrepareStatement(dbSession, TASKSTEP.ALLDONETASK);</span>
<span class="fc" id="L234">      countStepError = DbTaskRunner</span>
<span class="fc" id="L235">          .getCountStepPrepareStatement(dbSession, TASKSTEP.ERRORTASK);</span>

      // First on Running Transfers only
<span class="fc" id="L238">      countAllRunningStep =</span>
<span class="fc" id="L239">          DbTaskRunner.getCountStatusRunningPrepareStatement(dbSession, null);</span>
<span class="fc" id="L240">      countRunningStep = DbTaskRunner</span>
<span class="fc" id="L241">          .getCountStatusRunningPrepareStatement(dbSession, ErrorCode.Running);</span>
<span class="fc" id="L242">      countInitOkStep = DbTaskRunner</span>
<span class="fc" id="L243">          .getCountStatusRunningPrepareStatement(dbSession, ErrorCode.InitOk);</span>
<span class="fc" id="L244">      countPreProcessingOkStep = DbTaskRunner</span>
<span class="fc" id="L245">          .getCountStatusRunningPrepareStatement(dbSession,</span>
                                                 ErrorCode.PreProcessingOk);
<span class="fc" id="L247">      countTransferOkStep = DbTaskRunner</span>
<span class="fc" id="L248">          .getCountStatusRunningPrepareStatement(dbSession,</span>
                                                 ErrorCode.TransferOk);
<span class="fc" id="L250">      countPostProcessingOkStep = DbTaskRunner</span>
<span class="fc" id="L251">          .getCountStatusRunningPrepareStatement(dbSession,</span>
                                                 ErrorCode.PostProcessingOk);
<span class="fc" id="L253">      countCompleteOkStep = DbTaskRunner</span>
<span class="fc" id="L254">          .getCountStatusRunningPrepareStatement(dbSession,</span>
                                                 ErrorCode.CompleteOk);

      // Error Status on all transfers
<span class="fc" id="L258">      countStatus = DbTaskRunner.getCountStatusPrepareStatement(dbSession);</span>
<span class="nc" id="L259">    } catch (final WaarpDatabaseNoConnectionException ignored) {</span>
      // ignore
<span class="nc" id="L261">    } catch (final WaarpDatabaseSqlException ignored) {</span>
      // ignore
<span class="pc" id="L263">    }</span>
<span class="fc" id="L264">  }</span>

  /**
   * Release all Db Requests
   */
  @Override
  public void releaseResources() {
<span class="pc bpc" id="L271" title="1 of 4 branches missed.">    if (dbSession == null || dbSession.isDisActive()) {</span>
<span class="fc" id="L272">      return;</span>
    }
    try {
<span class="fc" id="L275">      logger.debug(&quot;Release monitoring&quot;);</span>
      // Overall status including past, future and current transfers
<span class="fc" id="L277">      countInfo.realClose();</span>

<span class="fc" id="L279">      countInActiveTransfer.realClose();</span>
<span class="fc" id="L280">      countOutActiveTransfer.realClose();</span>
<span class="fc" id="L281">      countInTotalTransfer.realClose();</span>
<span class="fc" id="L282">      countOutTotalTransfer.realClose();</span>
<span class="fc" id="L283">      countInErrorTransfer.realClose();</span>
<span class="fc" id="L284">      countOutErrorTransfer.realClose();</span>

      // Current situation of all transfers, running or not
<span class="fc" id="L287">      countStepAllTransfer.realClose();</span>
<span class="fc" id="L288">      countStepNotask.realClose();</span>
<span class="fc" id="L289">      countStepPretask.realClose();</span>
<span class="fc" id="L290">      countStepTransfer.realClose();</span>
<span class="fc" id="L291">      countStepPosttask.realClose();</span>
<span class="fc" id="L292">      countStepAllDone.realClose();</span>
<span class="fc" id="L293">      countStepError.realClose();</span>

      // First on Running Transfers only
<span class="fc" id="L296">      countAllRunningStep.realClose();</span>
<span class="fc" id="L297">      countRunningStep.realClose();</span>
<span class="fc" id="L298">      countInitOkStep.realClose();</span>
<span class="fc" id="L299">      countPreProcessingOkStep.realClose();</span>
<span class="fc" id="L300">      countTransferOkStep.realClose();</span>
<span class="fc" id="L301">      countPostProcessingOkStep.realClose();</span>
<span class="fc" id="L302">      countCompleteOkStep.realClose();</span>

      // Error Status on all transfers
<span class="fc" id="L305">      countStatus.realClose();</span>
<span class="nc" id="L306">    } catch (final Exception ignored) {</span>
      // nothing
<span class="fc" id="L308">    }</span>
<span class="pc bpc" id="L309" title="1 of 2 branches missed.">    if (!dbSession.equals(admin.getSession())) {</span>
<span class="pc bpc" id="L310" title="1 of 2 branches missed.">      if (DbAdmin.getNbConnection() &gt; 0) {</span>
<span class="nc" id="L311">        dbSession.forceDisconnect();</span>
      }
<span class="fc" id="L313">      dbSession = null;</span>
    }
<span class="fc" id="L315">  }</span>

  /**
   * @return the last Time in ms of the execution
   */
  public long lastRunTimeMs() {
<span class="nc" id="L321">    return lastTry;</span>
  }

  /**
   * Default execution of testing with default pastLimit
   */
  public void run() {
<span class="nc" id="L328">    run(-1, false);</span>
<span class="nc" id="L329">  }</span>

  /**
   * @param nbSecond as specific PastLimit
   */
  public void run(long nbSecond) {
<span class="nc" id="L335">    run(nbSecond, false);</span>
<span class="nc" id="L336">  }</span>

  /**
   * Default execution of testing with default pastLimit
   *
   * @param detail as to get detailed information
   */
  public void run(boolean detail) {
<span class="nc" id="L344">    run(-1, detail);</span>
<span class="nc" id="L345">  }</span>

  /**
   * @return False if too early, else return True
   */
  private boolean reCompute() {
<span class="fc" id="L351">    final long limitDate = System.currentTimeMillis();</span>
<span class="fc bfc" id="L352" title="All 2 branches covered.">    if (limitDate &lt; lastTry + minimalDelay) {</span>
      // too early
<span class="fc" id="L354">      return false;</span>
    }
<span class="fc" id="L356">    lastTry = limitDate;</span>
<span class="fc" id="L357">    return true;</span>
  }

  /**
   * @param nbSecond as specific PastLimit
   * @param detail as to get detailed information
   */
  public void run(long nbSecond, boolean detail) {
<span class="fc" id="L365">    synchronized (trafficCounter) {</span>
<span class="fc" id="L366">      long limitDate = System.currentTimeMillis();</span>
      long nbMs;
<span class="fc bfc" id="L368" title="All 2 branches covered.">      if (nbSecond &lt;= 0) {</span>
<span class="fc" id="L369">        nbMs = pastLimit;</span>
      } else {
<span class="fc" id="L371">        nbMs = nbSecond * 1000;</span>
      }
<span class="pc bpc" id="L373" title="2 of 4 branches missed.">      if (dbSession != null &amp;&amp; dbSession.isDisActive()) {</span>
<span class="nc" id="L374">        dbSession.checkConnectionNoException();</span>
      }
<span class="pc bpc" id="L376" title="2 of 4 branches missed.">      if (dbSession == null || dbSession.isDisActive()) {</span>
<span class="nc" id="L377">        nbNetworkConnection =</span>
<span class="nc" id="L378">            Configuration.configuration.getHttpChannelGroup().size() +</span>
<span class="nc" id="L379">            Configuration.configuration.getServerChannelGroup().size();</span>
<span class="nc" id="L380">        bandwidthIn = trafficCounter.lastReadThroughput() &gt;&gt; 7;// B/s -&gt; Kb/s</span>
<span class="nc" id="L381">        bandwidthOut = trafficCounter.lastWriteThroughput() &gt;&gt; 7;</span>
<span class="nc" id="L382">        nbThread = Thread.activeCount();</span>
<span class="nc" id="L383">        secondsRunning = (limitDate - startMonitor) / 1000;</span>

<span class="nc bnc" id="L385" title="All 2 branches missed.">        if (!reCompute()) {</span>
          // too early
<span class="nc" id="L387">          return;</span>
        }
<span class="nc" id="L389">        limitDate -= nbMs;</span>
<span class="nc" id="L390">        currentLimit = limitDate;</span>
        // Update value
        // Overall status including past, future and current transfers
<span class="nc" id="L393">        nbCountInfoToSubmit = CommanderNoDb.todoList.size();</span>
<span class="nc bnc" id="L394" title="All 2 branches missed.">        if (Configuration.configuration.getInternalRunner() != null) {</span>
<span class="nc" id="L395">          nbCountInfoRunning = Configuration.configuration.getInternalRunner()</span>
<span class="nc" id="L396">                                                          .nbInternalRunner();</span>
        } else {
<span class="nc" id="L398">          nbCountInfoRunning =</span>
<span class="nc" id="L399">              Configuration.configuration.getServerChannelGroup().size();</span>
        }
        // Current situation of all transfers, running or not
<span class="nc" id="L402">        nbCountAllRunningStep = nbCountInfoRunning;</span>
      } else {
<span class="fc" id="L404">        nbNetworkConnection = DbAdmin.getNbConnection();</span>
<span class="fc" id="L405">        bandwidthIn = trafficCounter.lastReadThroughput() &gt;&gt; 7;// B/s -&gt; Kb/s</span>
<span class="fc" id="L406">        bandwidthOut = trafficCounter.lastWriteThroughput() &gt;&gt; 7;</span>
<span class="fc" id="L407">        nbThread = Thread.activeCount();</span>
<span class="fc" id="L408">        secondsRunning = (limitDate - startMonitor) / 1000;</span>

<span class="fc bfc" id="L410" title="All 2 branches covered.">        if (!reCompute()) {</span>
          // too early
<span class="fc" id="L412">          return;</span>
        }
<span class="fc" id="L414">        limitDate -= nbMs;</span>
<span class="fc" id="L415">        currentLimit = limitDate;</span>
        // Update value
        try {
          // Overall status including past, future and current transfers
<span class="fc" id="L419">          nbCountInfoUnknown = DbTaskRunner</span>
<span class="fc" id="L420">              .getResultCountPrepareStatement(countInfo, UpdatedInfo.UNKNOWN,</span>
                                              limitDate);
<span class="fc" id="L422">          nbCountInfoNotUpdated = DbTaskRunner</span>
<span class="fc" id="L423">              .getResultCountPrepareStatement(countInfo, UpdatedInfo.NOTUPDATED,</span>
                                              limitDate);
<span class="fc" id="L425">          nbCountInfoInterrupted = DbTaskRunner</span>
<span class="fc" id="L426">              .getResultCountPrepareStatement(countInfo,</span>
                                              UpdatedInfo.INTERRUPTED,
                                              limitDate);
<span class="fc" id="L429">          nbCountInfoToSubmit = DbTaskRunner</span>
<span class="fc" id="L430">              .getResultCountPrepareStatement(countInfo, UpdatedInfo.TOSUBMIT,</span>
                                              limitDate);
<span class="fc" id="L432">          nbCountInfoError = DbTaskRunner</span>
<span class="fc" id="L433">              .getResultCountPrepareStatement(countInfo, UpdatedInfo.INERROR,</span>
                                              limitDate);
<span class="fc" id="L435">          nbCountInfoRunning = DbTaskRunner</span>
<span class="fc" id="L436">              .getResultCountPrepareStatement(countInfo, UpdatedInfo.RUNNING,</span>
                                              limitDate);
<span class="fc" id="L438">          nbCountInfoDone = DbTaskRunner</span>
<span class="fc" id="L439">              .getResultCountPrepareStatement(countInfo, UpdatedInfo.DONE,</span>
                                              limitDate);

          // Current situation of all transfers, running or not
<span class="fc" id="L443">          DbTaskRunner</span>
<span class="fc" id="L444">              .finishSelectOrCountPrepareStatement(countInActiveTransfer,</span>
                                                   limitDate);
<span class="fc" id="L446">          nbInActiveTransfer = DbTaskRunner</span>
<span class="fc" id="L447">              .getResultCountPrepareStatement(countInActiveTransfer);</span>
<span class="fc" id="L448">          DbTaskRunner</span>
<span class="fc" id="L449">              .finishSelectOrCountPrepareStatement(countOutActiveTransfer,</span>
                                                   limitDate);
<span class="fc" id="L451">          nbOutActiveTransfer = DbTaskRunner</span>
<span class="fc" id="L452">              .getResultCountPrepareStatement(countOutActiveTransfer);</span>
<span class="fc" id="L453">          DbTaskRunner.finishSelectOrCountPrepareStatement(countInTotalTransfer,</span>
                                                           limitDate);
<span class="fc" id="L455">          nbInTotalTransfer =</span>
<span class="fc" id="L456">              DbTaskRunner.getResultCountPrepareStatement(countInTotalTransfer);</span>
<span class="fc" id="L457">          DbTaskRunner</span>
<span class="fc" id="L458">              .finishSelectOrCountPrepareStatement(countOutTotalTransfer,</span>
                                                   limitDate);
<span class="fc" id="L460">          nbOutTotalTransfer = DbTaskRunner</span>
<span class="fc" id="L461">              .getResultCountPrepareStatement(countOutTotalTransfer);</span>

<span class="fc" id="L463">          DbTaskRunner</span>
<span class="fc" id="L464">              .finishSelectOrCountPrepareStatement(countOutErrorTransfer,</span>
                                                   limitDate);
<span class="fc" id="L466">          nbOutErrorTransfer = DbTaskRunner</span>
<span class="fc" id="L467">              .getResultCountPrepareStatement(countOutErrorTransfer);</span>
<span class="fc" id="L468">          DbTaskRunner.finishSelectOrCountPrepareStatement(countInErrorTransfer,</span>
                                                           limitDate);
<span class="fc" id="L470">          nbInErrorTransfer =</span>
<span class="fc" id="L471">              DbTaskRunner.getResultCountPrepareStatement(countInErrorTransfer);</span>

<span class="fc" id="L473">          DbTaskRunner.finishSelectOrCountPrepareStatement(countStepAllTransfer,</span>
                                                           limitDate);
<span class="fc" id="L475">          nbCountStepAllTransfer =</span>
<span class="fc" id="L476">              DbTaskRunner.getResultCountPrepareStatement(countStepAllTransfer);</span>
<span class="fc" id="L477">          DbTaskRunner</span>
<span class="fc" id="L478">              .finishSelectOrCountPrepareStatement(countStepNotask, limitDate);</span>
<span class="fc" id="L479">          nbCountStepNotask =</span>
<span class="fc" id="L480">              DbTaskRunner.getResultCountPrepareStatement(countStepNotask);</span>
<span class="fc" id="L481">          DbTaskRunner</span>
<span class="fc" id="L482">              .finishSelectOrCountPrepareStatement(countStepPretask, limitDate);</span>
<span class="fc" id="L483">          nbCountStepPretask =</span>
<span class="fc" id="L484">              DbTaskRunner.getResultCountPrepareStatement(countStepPretask);</span>
<span class="fc" id="L485">          DbTaskRunner.finishSelectOrCountPrepareStatement(countStepTransfer,</span>
                                                           limitDate);
<span class="fc" id="L487">          nbCountStepTransfer =</span>
<span class="fc" id="L488">              DbTaskRunner.getResultCountPrepareStatement(countStepTransfer);</span>
<span class="fc" id="L489">          DbTaskRunner.finishSelectOrCountPrepareStatement(countStepPosttask,</span>
                                                           limitDate);
<span class="fc" id="L491">          nbCountStepPosttask =</span>
<span class="fc" id="L492">              DbTaskRunner.getResultCountPrepareStatement(countStepPosttask);</span>
<span class="fc" id="L493">          DbTaskRunner</span>
<span class="fc" id="L494">              .finishSelectOrCountPrepareStatement(countStepAllDone, limitDate);</span>
<span class="fc" id="L495">          nbCountStepAllDone =</span>
<span class="fc" id="L496">              DbTaskRunner.getResultCountPrepareStatement(countStepAllDone);</span>
<span class="fc" id="L497">          DbTaskRunner</span>
<span class="fc" id="L498">              .finishSelectOrCountPrepareStatement(countStepError, limitDate);</span>
<span class="fc" id="L499">          nbCountStepError =</span>
<span class="fc" id="L500">              DbTaskRunner.getResultCountPrepareStatement(countStepError);</span>

<span class="fc" id="L502">          DbTaskRunner.finishSelectOrCountPrepareStatement(countAllRunningStep,</span>
                                                           limitDate);
<span class="fc" id="L504">          nbCountAllRunningStep =</span>
<span class="fc" id="L505">              DbTaskRunner.getResultCountPrepareStatement(countAllRunningStep);</span>

<span class="fc bfc" id="L507" title="All 2 branches covered.">          if (detail) {</span>
            // First on Running Transfers only
<span class="fc" id="L509">            DbTaskRunner.finishSelectOrCountPrepareStatement(countRunningStep,</span>
                                                             limitDate);
<span class="fc" id="L511">            nbCountRunningStep =</span>
<span class="fc" id="L512">                DbTaskRunner.getResultCountPrepareStatement(countRunningStep);</span>
<span class="fc" id="L513">            DbTaskRunner.finishSelectOrCountPrepareStatement(countInitOkStep,</span>
                                                             limitDate);
<span class="fc" id="L515">            nbCountInitOkStep =</span>
<span class="fc" id="L516">                DbTaskRunner.getResultCountPrepareStatement(countInitOkStep);</span>
<span class="fc" id="L517">            DbTaskRunner</span>
<span class="fc" id="L518">                .finishSelectOrCountPrepareStatement(countPreProcessingOkStep,</span>
                                                     limitDate);
<span class="fc" id="L520">            nbCountPreProcessingOkStep = DbTaskRunner</span>
<span class="fc" id="L521">                .getResultCountPrepareStatement(countPreProcessingOkStep);</span>
<span class="fc" id="L522">            DbTaskRunner</span>
<span class="fc" id="L523">                .finishSelectOrCountPrepareStatement(countTransferOkStep,</span>
                                                     limitDate);
<span class="fc" id="L525">            nbCountTransferOkStep = DbTaskRunner</span>
<span class="fc" id="L526">                .getResultCountPrepareStatement(countTransferOkStep);</span>
<span class="fc" id="L527">            DbTaskRunner</span>
<span class="fc" id="L528">                .finishSelectOrCountPrepareStatement(countPostProcessingOkStep,</span>
                                                     limitDate);
<span class="fc" id="L530">            nbCountPostProcessingOkStep = DbTaskRunner</span>
<span class="fc" id="L531">                .getResultCountPrepareStatement(countPostProcessingOkStep);</span>
<span class="fc" id="L532">            DbTaskRunner</span>
<span class="fc" id="L533">                .finishSelectOrCountPrepareStatement(countCompleteOkStep,</span>
                                                     limitDate);
<span class="fc" id="L535">            nbCountCompleteOkStep = DbTaskRunner</span>
<span class="fc" id="L536">                .getResultCountPrepareStatement(countCompleteOkStep);</span>

            // Error Status on all transfers
<span class="fc" id="L539">            nbCountStatusConnectionImpossible = DbTaskRunner</span>
<span class="fc" id="L540">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.ConnectionImpossible,
                                                limitDate);
<span class="fc" id="L543">            nbCountStatusServerOverloaded = DbTaskRunner</span>
<span class="fc" id="L544">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.ServerOverloaded,
                                                limitDate);
<span class="fc" id="L547">            nbCountStatusBadAuthent = DbTaskRunner</span>
<span class="fc" id="L548">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.BadAuthent,
                                                limitDate);
<span class="fc" id="L551">            nbCountStatusExternalOp = DbTaskRunner</span>
<span class="fc" id="L552">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.ExternalOp,
                                                limitDate);
<span class="fc" id="L555">            nbCountStatusTransferError = DbTaskRunner</span>
<span class="fc" id="L556">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.TransferError,
                                                limitDate);
<span class="fc" id="L559">            nbCountStatusMD5Error = DbTaskRunner</span>
<span class="fc" id="L560">                .getResultCountPrepareStatement(countStatus, ErrorCode.MD5Error,</span>
                                                limitDate);
<span class="fc" id="L562">            nbCountStatusDisconnection = DbTaskRunner</span>
<span class="fc" id="L563">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.Disconnection,
                                                limitDate);
<span class="fc" id="L566">            nbCountStatusFinalOp = DbTaskRunner</span>
<span class="fc" id="L567">                .getResultCountPrepareStatement(countStatus, ErrorCode.FinalOp,</span>
                                                limitDate);
<span class="fc" id="L569">            nbCountStatusUnimplemented = DbTaskRunner</span>
<span class="fc" id="L570">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.Unimplemented,
                                                limitDate);
<span class="fc" id="L573">            nbCountStatusInternal = DbTaskRunner</span>
<span class="fc" id="L574">                .getResultCountPrepareStatement(countStatus, ErrorCode.Internal,</span>
                                                limitDate);
<span class="fc" id="L576">            nbCountStatusWarning = DbTaskRunner</span>
<span class="fc" id="L577">                .getResultCountPrepareStatement(countStatus, ErrorCode.Warning,</span>
                                                limitDate);
<span class="fc" id="L579">            nbCountStatusQueryAlreadyFinished = DbTaskRunner</span>
<span class="fc" id="L580">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.QueryAlreadyFinished,
                                                limitDate);
<span class="fc" id="L583">            nbCountStatusQueryStillRunning = DbTaskRunner</span>
<span class="fc" id="L584">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.QueryStillRunning,
                                                limitDate);
<span class="fc" id="L587">            nbCountStatusNotKnownHost = DbTaskRunner</span>
<span class="fc" id="L588">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.NotKnownHost,
                                                limitDate);
<span class="fc" id="L591">            nbCountStatusQueryRemotelyUnknown = DbTaskRunner</span>
<span class="fc" id="L592">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.QueryRemotelyUnknown,
                                                limitDate);
<span class="fc" id="L595">            nbCountStatusCommandNotFound = DbTaskRunner</span>
<span class="fc" id="L596">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.CommandNotFound,
                                                limitDate);
<span class="fc" id="L599">            nbCountStatusPassThroughMode = DbTaskRunner</span>
<span class="fc" id="L600">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.PassThroughMode,
                                                limitDate);
<span class="fc" id="L603">            nbCountStatusRemoteShutdown = DbTaskRunner</span>
<span class="fc" id="L604">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.RemoteShutdown,
                                                limitDate);
<span class="fc" id="L607">            nbCountStatusShutdown = DbTaskRunner</span>
<span class="fc" id="L608">                .getResultCountPrepareStatement(countStatus, ErrorCode.Shutdown,</span>
                                                limitDate);
<span class="fc" id="L610">            nbCountStatusRemoteError = DbTaskRunner</span>
<span class="fc" id="L611">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.RemoteError,
                                                limitDate);
<span class="fc" id="L614">            nbCountStatusStopped = DbTaskRunner</span>
<span class="fc" id="L615">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.StoppedTransfer,
                                                limitDate);
<span class="fc" id="L618">            nbCountStatusCanceled = DbTaskRunner</span>
<span class="fc" id="L619">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.CanceledTransfer,
                                                limitDate);
<span class="fc" id="L622">            nbCountStatusFileNotFound = DbTaskRunner</span>
<span class="fc" id="L623">                .getResultCountPrepareStatement(countStatus,</span>
                                                ErrorCode.FileNotFound,
                                                limitDate);
<span class="fc" id="L626">            nbCountStatusUnknown = DbTaskRunner</span>
<span class="fc" id="L627">                .getResultCountPrepareStatement(countStatus, ErrorCode.Unknown,</span>
                                                limitDate);
          }
<span class="nc" id="L630">        } catch (final WaarpDatabaseNoConnectionException ignored) {</span>
          // ignore
<span class="nc" id="L632">        } catch (final WaarpDatabaseSqlException ignored) {</span>
          // ignore
<span class="pc" id="L634">        }</span>
      }
<span class="fc" id="L636">    }</span>
<span class="fc" id="L637">  }</span>

  /**
   * @param detail
   *
   * @return The XML representation of the current status
   */
  public String exportXml(boolean detail) {
<span class="fc" id="L645">    final StringBuilder builder = new StringBuilder(&quot;&lt;STATUS&gt;&quot;)</span>
        // Global Informations
<span class="fc" id="L647">        .append(&quot;&lt;HostID&gt;&quot;).append(Configuration.configuration.getHostId())</span>
<span class="fc" id="L648">        .append(&quot;&lt;/HostID&gt;&quot;).append(&quot;&lt;Date&gt;&quot;).append(new DateTime())</span>
<span class="fc" id="L649">        .append(&quot;&lt;/Date&gt;&quot;).append(&quot;&lt;LastRun&gt;&quot;).append(new DateTime(lastTry))</span>
<span class="fc" id="L650">        .append(&quot;&lt;/LastRun&gt;&quot;).append(&quot;&lt;FromDate&gt;&quot;)</span>
<span class="fc" id="L651">        .append(new DateTime(currentLimit)).append(&quot;&lt;/FromDate&gt;&quot;)</span>
<span class="fc" id="L652">        .append(&quot;&lt;SecondsRunning&gt;&quot;).append(secondsRunning)</span>
<span class="fc" id="L653">        .append(&quot;&lt;/SecondsRunning&gt;&quot;).append(&quot;&lt;NetworkConnections&gt;&quot;)</span>
<span class="fc" id="L654">        .append(nbNetworkConnection).append(&quot;&lt;/NetworkConnections&gt;&quot;)</span>
<span class="fc" id="L655">        .append(&quot;&lt;NbThreads&gt;&quot;).append(nbThread).append(&quot;&lt;/NbThreads&gt;&quot;)</span>
<span class="fc" id="L656">        .append(&quot;&lt;InBandwidth&gt;&quot;).append(bandwidthIn).append(&quot;&lt;/InBandwidth&gt;&quot;)</span>
<span class="fc" id="L657">        .append(&quot;&lt;OutBandwidth&gt;&quot;).append(bandwidthOut).append(&quot;&lt;/OutBandwidth&gt;&quot;)</span>

        // Overall status including past, future and current transfers
<span class="fc" id="L660">        .append(&quot;&lt;OVERALL&gt;&quot;).append(&quot;&lt;AllTransfer&gt;&quot;)</span>
<span class="fc" id="L661">        .append(nbCountStepAllTransfer).append(&quot;&lt;/AllTransfer&gt;&quot;)</span>
<span class="fc" id="L662">        .append(&quot;&lt;Unknown&gt;&quot;).append(nbCountInfoUnknown).append(&quot;&lt;/Unknown&gt;&quot;)</span>
<span class="fc" id="L663">        .append(&quot;&lt;NotUpdated&gt;&quot;).append(nbCountInfoNotUpdated)</span>
<span class="fc" id="L664">        .append(&quot;&lt;/NotUpdated&gt;&quot;).append(&quot;&lt;Interrupted&gt;&quot;)</span>
<span class="fc" id="L665">        .append(nbCountInfoInterrupted).append(&quot;&lt;/Interrupted&gt;&quot;)</span>
<span class="fc" id="L666">        .append(&quot;&lt;ToSubmit&gt;&quot;).append(nbCountInfoToSubmit).append(&quot;&lt;/ToSubmit&gt;&quot;)</span>
<span class="fc" id="L667">        .append(&quot;&lt;Error&gt;&quot;).append(nbCountInfoError).append(&quot;&lt;/Error&gt;&quot;)</span>
<span class="fc" id="L668">        .append(&quot;&lt;Running&gt;&quot;).append(nbCountInfoRunning).append(&quot;&lt;/Running&gt;&quot;)</span>
<span class="fc" id="L669">        .append(&quot;&lt;Done&gt;&quot;).append(nbCountInfoDone).append(&quot;&lt;/Done&gt;&quot;)</span>
<span class="fc" id="L670">        .append(&quot;&lt;InRunning&gt;&quot;).append(nbInActiveTransfer).append(&quot;&lt;/InRunning&gt;&quot;)</span>
<span class="fc" id="L671">        .append(&quot;&lt;OutRunning&gt;&quot;).append(nbOutActiveTransfer)</span>
<span class="fc" id="L672">        .append(&quot;&lt;/OutRunning&gt;&quot;).append(&quot;&lt;LastInRunning&gt;&quot;)</span>
<span class="fc" id="L673">        .append(new DateTime(lastInActiveTransfer)).append(&quot;&lt;/LastInRunning&gt;&quot;)</span>
<span class="fc" id="L674">        .append(&quot;&lt;LastOutRunning&gt;&quot;).append(new DateTime(lastOutActiveTransfer))</span>
<span class="fc" id="L675">        .append(&quot;&lt;/LastOutRunning&gt;&quot;).append(&quot;&lt;InAll&gt;&quot;).append(nbInTotalTransfer)</span>
<span class="fc" id="L676">        .append(&quot;&lt;/InAll&gt;&quot;).append(&quot;&lt;OutAll&gt;&quot;).append(nbOutTotalTransfer)</span>
<span class="fc" id="L677">        .append(&quot;&lt;/OutAll&gt;&quot;).append(&quot;&lt;InError&gt;&quot;).append(nbInErrorTransfer)</span>
<span class="fc" id="L678">        .append(&quot;&lt;/InError&gt;&quot;).append(&quot;&lt;OutError&gt;&quot;).append(nbOutErrorTransfer)</span>
<span class="fc" id="L679">        .append(&quot;&lt;/OutError&gt;&quot;).append(&quot;&lt;/OVERALL&gt;&quot;)</span>

        // Current situation of all transfers, running or not
<span class="fc" id="L682">        .append(&quot;&lt;STEPS&gt;&quot;).append(&quot;&lt;Notask&gt;&quot;).append(nbCountStepNotask)</span>
<span class="fc" id="L683">        .append(&quot;&lt;/Notask&gt;&quot;).append(&quot;&lt;Pretask&gt;&quot;).append(nbCountStepPretask)</span>
<span class="fc" id="L684">        .append(&quot;&lt;/Pretask&gt;&quot;).append(&quot;&lt;Transfer&gt;&quot;).append(nbCountStepTransfer)</span>
<span class="fc" id="L685">        .append(&quot;&lt;/Transfer&gt;&quot;).append(&quot;&lt;Posttask&gt;&quot;).append(nbCountStepPosttask)</span>
<span class="fc" id="L686">        .append(&quot;&lt;/Posttask&gt;&quot;).append(&quot;&lt;AllDone&gt;&quot;).append(nbCountStepAllDone)</span>
<span class="fc" id="L687">        .append(&quot;&lt;/AllDone&gt;&quot;).append(&quot;&lt;Error&gt;&quot;).append(nbCountStepError)</span>
<span class="fc" id="L688">        .append(&quot;&lt;/Error&gt;&quot;).append(&quot;&lt;/STEPS&gt;&quot;)</span>

        // On Running Transfers only
<span class="fc" id="L691">        .append(&quot;&lt;RUNNINGSTEPS&gt;&quot;).append(&quot;&lt;AllRunning&gt;&quot;)</span>
<span class="fc" id="L692">        .append(nbCountAllRunningStep).append(&quot;&lt;/AllRunning&gt;&quot;);</span>
<span class="pc bpc" id="L693" title="1 of 2 branches missed.">    if (detail) {</span>
<span class="nc" id="L694">      builder.append(&quot;&lt;Running&gt;&quot;).append(nbCountRunningStep)</span>
<span class="nc" id="L695">             .append(&quot;&lt;/Running&gt;&quot;).append(&quot;&lt;InitOk&gt;&quot;).append(nbCountInitOkStep)</span>
<span class="nc" id="L696">             .append(&quot;&lt;/InitOk&gt;&quot;).append(&quot;&lt;PreProcessingOk&gt;&quot;)</span>
<span class="nc" id="L697">             .append(nbCountPreProcessingOkStep).append(&quot;&lt;/PreProcessingOk&gt;&quot;)</span>
<span class="nc" id="L698">             .append(&quot;&lt;TransferOk&gt;&quot;).append(nbCountTransferOkStep)</span>
<span class="nc" id="L699">             .append(&quot;&lt;/TransferOk&gt;&quot;).append(&quot;&lt;PostProcessingOk&gt;&quot;)</span>
<span class="nc" id="L700">             .append(nbCountPostProcessingOkStep).append(&quot;&lt;/PostProcessingOk&gt;&quot;)</span>
<span class="nc" id="L701">             .append(&quot;&lt;CompleteOk&gt;&quot;).append(nbCountCompleteOkStep)</span>
<span class="nc" id="L702">             .append(&quot;&lt;/CompleteOk&gt;&quot;);</span>
    }
<span class="fc" id="L704">    builder.append(&quot;&lt;/RUNNINGSTEPS&gt;&quot;);</span>

<span class="pc bpc" id="L706" title="1 of 2 branches missed.">    if (detail) {</span>
      // Error Status on all transfers
<span class="nc" id="L708">      builder.append(&quot;&lt;ERRORTYPES&gt;&quot;).append(&quot;&lt;ConnectionImpossible&gt;&quot;)</span>
<span class="nc" id="L709">             .append(nbCountStatusConnectionImpossible)</span>
<span class="nc" id="L710">             .append(&quot;&lt;/ConnectionImpossible&gt;&quot;).append(&quot;&lt;ServerOverloaded&gt;&quot;)</span>
<span class="nc" id="L711">             .append(nbCountStatusServerOverloaded)</span>
<span class="nc" id="L712">             .append(&quot;&lt;/ServerOverloaded&gt;&quot;).append(&quot;&lt;BadAuthent&gt;&quot;)</span>
<span class="nc" id="L713">             .append(nbCountStatusBadAuthent).append(&quot;&lt;/BadAuthent&gt;&quot;)</span>
<span class="nc" id="L714">             .append(&quot;&lt;ExternalOp&gt;&quot;).append(nbCountStatusExternalOp)</span>
<span class="nc" id="L715">             .append(&quot;&lt;/ExternalOp&gt;&quot;).append(&quot;&lt;TransferError&gt;&quot;)</span>
<span class="nc" id="L716">             .append(nbCountStatusTransferError).append(&quot;&lt;/TransferError&gt;&quot;)</span>
<span class="nc" id="L717">             .append(&quot;&lt;MD5Error&gt;&quot;).append(nbCountStatusMD5Error)</span>
<span class="nc" id="L718">             .append(&quot;&lt;/MD5Error&gt;&quot;).append(&quot;&lt;Disconnection&gt;&quot;)</span>
<span class="nc" id="L719">             .append(nbCountStatusDisconnection).append(&quot;&lt;/Disconnection&gt;&quot;)</span>
<span class="nc" id="L720">             .append(&quot;&lt;FinalOp&gt;&quot;).append(nbCountStatusFinalOp)</span>
<span class="nc" id="L721">             .append(&quot;&lt;/FinalOp&gt;&quot;).append(&quot;&lt;Unimplemented&gt;&quot;)</span>
<span class="nc" id="L722">             .append(nbCountStatusUnimplemented).append(&quot;&lt;/Unimplemented&gt;&quot;)</span>
<span class="nc" id="L723">             .append(&quot;&lt;Internal&gt;&quot;).append(nbCountStatusInternal)</span>
<span class="nc" id="L724">             .append(&quot;&lt;/Internal&gt;&quot;).append(&quot;&lt;Warning&gt;&quot;)</span>
<span class="nc" id="L725">             .append(nbCountStatusWarning).append(&quot;&lt;/Warning&gt;&quot;)</span>
<span class="nc" id="L726">             .append(&quot;&lt;QueryAlreadyFinished&gt;&quot;)</span>
<span class="nc" id="L727">             .append(nbCountStatusQueryAlreadyFinished)</span>
<span class="nc" id="L728">             .append(&quot;&lt;/QueryAlreadyFinished&gt;&quot;).append(&quot;&lt;QueryStillRunning&gt;&quot;)</span>
<span class="nc" id="L729">             .append(nbCountStatusQueryStillRunning)</span>
<span class="nc" id="L730">             .append(&quot;&lt;/QueryStillRunning&gt;&quot;).append(&quot;&lt;KnownHost&gt;&quot;)</span>
<span class="nc" id="L731">             .append(nbCountStatusNotKnownHost).append(&quot;&lt;/KnownHost&gt;&quot;)</span>
<span class="nc" id="L732">             .append(&quot;&lt;RemotelyUnknown&gt;&quot;)</span>
<span class="nc" id="L733">             .append(nbCountStatusQueryRemotelyUnknown)</span>
<span class="nc" id="L734">             .append(&quot;&lt;/RemotelyUnknown&gt;&quot;).append(&quot;&lt;CommandNotFound&gt;&quot;)</span>
<span class="nc" id="L735">             .append(nbCountStatusCommandNotFound).append(&quot;&lt;/CommandNotFound&gt;&quot;)</span>
<span class="nc" id="L736">             .append(&quot;&lt;PassThroughMode&gt;&quot;).append(nbCountStatusPassThroughMode)</span>
<span class="nc" id="L737">             .append(&quot;&lt;/PassThroughMode&gt;&quot;).append(&quot;&lt;RemoteShutdown&gt;&quot;)</span>
<span class="nc" id="L738">             .append(nbCountStatusRemoteShutdown).append(&quot;&lt;/RemoteShutdown&gt;&quot;)</span>
<span class="nc" id="L739">             .append(&quot;&lt;Shutdown&gt;&quot;).append(nbCountStatusShutdown)</span>
<span class="nc" id="L740">             .append(&quot;&lt;/Shutdown&gt;&quot;).append(&quot;&lt;RemoteError&gt;&quot;)</span>
<span class="nc" id="L741">             .append(nbCountStatusRemoteError).append(&quot;&lt;/RemoteError&gt;&quot;)</span>
<span class="nc" id="L742">             .append(&quot;&lt;Stopped&gt;&quot;).append(nbCountStatusStopped)</span>
<span class="nc" id="L743">             .append(&quot;&lt;/Stopped&gt;&quot;).append(&quot;&lt;Canceled&gt;&quot;)</span>
<span class="nc" id="L744">             .append(nbCountStatusCanceled).append(&quot;&lt;/Canceled&gt;&quot;)</span>
<span class="nc" id="L745">             .append(&quot;&lt;FileNotFound&gt;&quot;).append(nbCountStatusFileNotFound)</span>
<span class="nc" id="L746">             .append(&quot;&lt;/FileNotFound&gt;&quot;).append(&quot;&lt;Unknown&gt;&quot;)</span>
<span class="nc" id="L747">             .append(nbCountStatusUnknown).append(&quot;&lt;/Unknown&gt;&quot;)</span>
<span class="nc" id="L748">             .append(&quot;&lt;/ERRORTYPES&gt;&quot;);</span>
    }
<span class="fc" id="L750">    builder.append(&quot;&lt;/STATUS&gt;&quot;);</span>
<span class="fc" id="L751">    return builder.toString();</span>
  }

  /**
   * @param detail
   *
   * @return The Json representation of the current status
   */
  public String exportJson(boolean detail) {
<span class="fc" id="L760">    return JsonHandler.prettyPrint(exportAsJson(detail));</span>
  }

  /**
   * @param detail
   *
   * @return The Json representation of the current status
   */
  public ObjectNode exportAsJson(boolean detail) {
<span class="fc" id="L769">    ObjectNode node = JsonHandler.createObjectNode();</span>
<span class="fc" id="L770">    node = node.putObject(&quot;STATUS&quot;);</span>
    // Global Informations
<span class="fc" id="L772">    node.put(&quot;HostID&quot;, Configuration.configuration.getHostId());</span>
<span class="fc" id="L773">    node.put(&quot;Date&quot;, new DateTime().toString());</span>
<span class="fc" id="L774">    node.put(&quot;LastRun&quot;, new DateTime(lastTry).toString());</span>
<span class="fc" id="L775">    node.put(&quot;FromDate&quot;, new DateTime(currentLimit).toString());</span>
<span class="fc" id="L776">    node.put(&quot;SecondsRunning&quot;, secondsRunning);</span>
<span class="fc" id="L777">    node.put(&quot;NetworkConnections&quot;, nbNetworkConnection);</span>
<span class="fc" id="L778">    node.put(&quot;NbThreads&quot;, nbThread);</span>
<span class="fc" id="L779">    node.put(&quot;InBandwidth&quot;, bandwidthIn);</span>
<span class="fc" id="L780">    node.put(&quot;OutBandwidth&quot;, bandwidthOut);</span>

    // Overall status including past, future and current transfers
<span class="fc" id="L783">    ObjectNode node2 = node.putObject(&quot;OVERALL&quot;);</span>
<span class="fc" id="L784">    node2.put(&quot;AllTransfer&quot;, nbCountStepAllTransfer);</span>
<span class="fc" id="L785">    node2.put(&quot;Unknown&quot;, nbCountInfoUnknown);</span>
<span class="fc" id="L786">    node2.put(&quot;NotUpdated&quot;, nbCountInfoNotUpdated);</span>
<span class="fc" id="L787">    node2.put(&quot;Interrupted&quot;, nbCountInfoInterrupted);</span>
<span class="fc" id="L788">    node2.put(&quot;ToSubmit&quot;, nbCountInfoToSubmit);</span>
<span class="fc" id="L789">    node2.put(&quot;Error&quot;, nbCountInfoError);</span>
<span class="fc" id="L790">    node2.put(&quot;Running&quot;, nbCountInfoRunning);</span>
<span class="fc" id="L791">    node2.put(&quot;Done&quot;, nbCountInfoDone);</span>
<span class="fc" id="L792">    node2.put(&quot;InRunning&quot;, nbInActiveTransfer);</span>
<span class="fc" id="L793">    node2.put(&quot;OutRunning&quot;, nbOutActiveTransfer);</span>
<span class="fc" id="L794">    node2.put(&quot;LastInRunning&quot;, new DateTime(lastInActiveTransfer).toString());</span>
<span class="fc" id="L795">    node2.put(&quot;LastOutRunning&quot;, new DateTime(lastOutActiveTransfer).toString());</span>
<span class="fc" id="L796">    node2.put(&quot;InAll&quot;, nbInTotalTransfer);</span>
<span class="fc" id="L797">    node2.put(&quot;OutAll&quot;, nbOutTotalTransfer);</span>
<span class="fc" id="L798">    node2.put(&quot;InError&quot;, nbInErrorTransfer);</span>
<span class="fc" id="L799">    node2.put(&quot;OutError&quot;, nbOutErrorTransfer);</span>

    // Current situation of all transfers, running or not
<span class="fc" id="L802">    node2 = node.putObject(&quot;STEPS&quot;);</span>
<span class="fc" id="L803">    node2.put(&quot;Notask&quot;, nbCountStepNotask);</span>
<span class="fc" id="L804">    node2.put(&quot;Pretask&quot;, nbCountStepPretask);</span>
<span class="fc" id="L805">    node2.put(&quot;Transfer&quot;, nbCountStepTransfer);</span>
<span class="fc" id="L806">    node2.put(&quot;Posttask&quot;, nbCountStepPosttask);</span>
<span class="fc" id="L807">    node2.put(&quot;AllDone&quot;, nbCountStepAllDone);</span>
<span class="fc" id="L808">    node2.put(&quot;Error&quot;, nbCountStepError);</span>

    // On Running Transfers only
<span class="fc" id="L811">    node2 = node.putObject(&quot;RUNNINGSTEPS&quot;);</span>
<span class="fc" id="L812">    node2.put(&quot;AllRunning&quot;, nbCountAllRunningStep);</span>
<span class="fc bfc" id="L813" title="All 2 branches covered.">    if (detail) {</span>
<span class="fc" id="L814">      node2.put(&quot;Running&quot;, nbCountRunningStep);</span>
<span class="fc" id="L815">      node2.put(&quot;InitOk&quot;, nbCountInitOkStep);</span>
<span class="fc" id="L816">      node2.put(&quot;PreProcessingOk&quot;, nbCountPreProcessingOkStep);</span>
<span class="fc" id="L817">      node2.put(&quot;TransferOk&quot;, nbCountTransferOkStep);</span>
<span class="fc" id="L818">      node2.put(&quot;PostProcessingOk&quot;, nbCountPostProcessingOkStep);</span>
<span class="fc" id="L819">      node2.put(&quot;CompleteOk&quot;, nbCountCompleteOkStep);</span>
    }

<span class="fc bfc" id="L822" title="All 2 branches covered.">    if (detail) {</span>
      // Error Status on all transfers
<span class="fc" id="L824">      node2 = node.putObject(&quot;ERRORTYPES&quot;);</span>
<span class="fc" id="L825">      node2.put(&quot;ConnectionImpossible&quot;, nbCountStatusConnectionImpossible);</span>
<span class="fc" id="L826">      node2.put(&quot;ServerOverloaded&quot;, nbCountStatusServerOverloaded);</span>
<span class="fc" id="L827">      node2.put(&quot;BadAuthent&quot;, nbCountStatusBadAuthent);</span>
<span class="fc" id="L828">      node2.put(&quot;ExternalOp&quot;, nbCountStatusExternalOp);</span>
<span class="fc" id="L829">      node2.put(&quot;TransferError&quot;, nbCountStatusTransferError);</span>
<span class="fc" id="L830">      node2.put(&quot;MD5Error&quot;, nbCountStatusMD5Error);</span>
<span class="fc" id="L831">      node2.put(&quot;Disconnection&quot;, nbCountStatusDisconnection);</span>
<span class="fc" id="L832">      node2.put(&quot;FinalOp&quot;, nbCountStatusFinalOp);</span>
<span class="fc" id="L833">      node2.put(&quot;Unimplemented&quot;, nbCountStatusUnimplemented);</span>
<span class="fc" id="L834">      node2.put(&quot;Internal&quot;, nbCountStatusInternal);</span>
<span class="fc" id="L835">      node2.put(&quot;Warning&quot;, nbCountStatusWarning);</span>
<span class="fc" id="L836">      node2.put(&quot;QueryAlreadyFinished&quot;, nbCountStatusQueryAlreadyFinished);</span>
<span class="fc" id="L837">      node2.put(&quot;QueryStillRunning&quot;, nbCountStatusQueryStillRunning);</span>
<span class="fc" id="L838">      node2.put(&quot;KnownHost&quot;, nbCountStatusNotKnownHost);</span>
<span class="fc" id="L839">      node2.put(&quot;RemotelyUnknown&quot;, nbCountStatusQueryRemotelyUnknown);</span>
<span class="fc" id="L840">      node2.put(&quot;CommandNotFound&quot;, nbCountStatusCommandNotFound);</span>
<span class="fc" id="L841">      node2.put(&quot;PassThroughMode&quot;, nbCountStatusPassThroughMode);</span>
<span class="fc" id="L842">      node2.put(&quot;RemoteShutdown&quot;, nbCountStatusRemoteShutdown);</span>
<span class="fc" id="L843">      node2.put(&quot;Shutdown&quot;, nbCountStatusShutdown);</span>
<span class="fc" id="L844">      node2.put(&quot;RemoteError&quot;, nbCountStatusRemoteError);</span>
<span class="fc" id="L845">      node2.put(&quot;Stopped&quot;, nbCountStatusStopped);</span>
<span class="fc" id="L846">      node2.put(&quot;Canceled&quot;, nbCountStatusCanceled);</span>
<span class="fc" id="L847">      node2.put(&quot;FileNotFound&quot;, nbCountStatusFileNotFound);</span>
<span class="fc" id="L848">      node2.put(&quot;Unknown&quot;, nbCountStatusUnknown);</span>
    }
<span class="fc" id="L850">    return node;</span>
  }

  @Override
  public void setAgent(WaarpSnmpAgent agent) {
<span class="fc" id="L855">    this.agent = agent;</span>
<span class="fc" id="L856">    lastInActiveTransfer = this.agent.getUptimeSystemTime();</span>
<span class="fc" id="L857">    lastOutActiveTransfer = this.agent.getUptimeSystemTime();</span>
<span class="fc" id="L858">  }</span>

  /**
   * Update the value for one particular MIB entry
   *
   * @param type
   * @param entry
   */
  public void run(int type, int entry) {
<span class="fc" id="L867">    final long nbMs =</span>
<span class="fc" id="L868">        Configuration.configuration.getAgentSnmp().getUptime() + 100;</span>
<span class="fc" id="L869">    final MibLevel level = MibLevel.values()[type];</span>
<span class="fc bfc" id="L870" title="All 4 branches covered.">    switch (level) {</span>
      case globalInfo:// Global
<span class="pc bpc" id="L872" title="1 of 2 branches missed.">        if (((R66PrivateMib) agent.getMib()).rowGlobal != null) {</span>
<span class="nc" id="L873">          run(nbMs, WaarpGlobalValuesIndex.values()[entry]);</span>
        }
<span class="fc" id="L875">        return;</span>
      case detailedInfo:// Detailed
<span class="pc bpc" id="L877" title="1 of 2 branches missed.">        if (((R66PrivateMib) agent.getMib()).rowDetailed != null) {</span>
<span class="nc" id="L878">          run(nbMs, WaarpDetailedValuesIndex.values()[entry]);</span>
        }
<span class="fc" id="L880">        return;</span>
      case errorInfo:// Error
<span class="pc bpc" id="L882" title="1 of 2 branches missed.">        if (((R66PrivateMib) agent.getMib()).rowError != null) {</span>
<span class="nc" id="L883">          run(nbMs, WaarpErrorValuesIndex.values()[entry]);</span>
        }
<span class="fc" id="L885">        return;</span>
      case trapInfo:
      case staticInfo:
      default:
        break;
    }
<span class="fc" id="L891">  }</span>

  /**
   * Update a value in Global MIB part
   *
   * @param rank
   * @param value
   */
  protected void updateGlobalValue(int rank, long value) {
<span class="nc" id="L900">    ((R66PrivateMib) agent.getMib()).rowGlobal.setValue(rank, value);</span>
<span class="nc" id="L901">  }</span>

  /**
   * Update a value in Detailed MIB part
   *
   * @param rank
   * @param value
   */
  protected void updateDetailedValue(int rank, long value) {
<span class="nc" id="L910">    ((R66PrivateMib) agent.getMib()).rowDetailed.setValue(rank, value);</span>
<span class="nc" id="L911">  }</span>

  /**
   * Update a value in Error MIB part
   *
   * @param rank
   * @param value
   */
  protected void updateErrorValue(int rank, long value) {
<span class="nc" id="L920">    ((R66PrivateMib) agent.getMib()).rowError.setValue(rank, value);</span>
<span class="nc" id="L921">  }</span>

  /**
   * Update a value in Global MIB part
   *
   * @param nbMs
   * @param entry
   */
  protected void run(long nbMs, WaarpGlobalValuesIndex entry) {
<span class="nc" id="L930">    synchronized (trafficCounter) {</span>
      long val;
<span class="nc" id="L932">      final long limitDate = System.currentTimeMillis() - nbMs;</span>
<span class="nc bnc" id="L933" title="All 4 branches missed.">      if (dbSession == null || dbSession.isDisActive()) {</span>
<span class="nc bnc" id="L934" title="All 22 branches missed.">        switch (entry) {</span>
          case applUptime:
          case memoryUsed:
          case memoryFree:
          case memoryTotal:
          case applLastChange:
          case applOperStatus:
<span class="nc" id="L941">            return;</span>
          case applInboundAssociations:
<span class="nc" id="L943">            updateGlobalValue(entry.ordinal(), nbInActiveTransfer);</span>
<span class="nc" id="L944">            return;</span>
          case applOutboundAssociations:
<span class="nc" id="L946">            updateGlobalValue(entry.ordinal(), nbOutActiveTransfer);</span>
<span class="nc" id="L947">            return;</span>
          case applAccumInboundAssociations:
<span class="nc" id="L949">            updateGlobalValue(entry.ordinal(), nbInTotalTransfer);</span>
<span class="nc" id="L950">            return;</span>
          case applAccumOutboundAssociations:
<span class="nc" id="L952">            updateGlobalValue(entry.ordinal(), nbOutTotalTransfer);</span>
<span class="nc" id="L953">            return;</span>
          case applLastInboundActivity:
<span class="nc" id="L955">            val = (lastInActiveTransfer - agent.getUptimeSystemTime()) / 10;</span>
<span class="nc bnc" id="L956" title="All 2 branches missed.">            if (val &lt; 0) {</span>
<span class="nc" id="L957">              val = 0;</span>
            }
<span class="nc" id="L959">            updateGlobalValue(entry.ordinal(), val);</span>
<span class="nc" id="L960">            return;</span>
          case applLastOutboundActivity:
<span class="nc" id="L962">            val = (lastOutActiveTransfer - agent.getUptimeSystemTime()) / 10;</span>
<span class="nc bnc" id="L963" title="All 2 branches missed.">            if (val &lt; 0) {</span>
<span class="nc" id="L964">              val = 0;</span>
            }
<span class="nc" id="L966">            updateGlobalValue(entry.ordinal(), val);</span>
<span class="nc" id="L967">            return;</span>
          case applRejectedInboundAssociations:
<span class="nc" id="L969">            updateGlobalValue(entry.ordinal(), nbInErrorTransfer);</span>
<span class="nc" id="L970">            return;</span>
          case applFailedOutboundAssociations:
<span class="nc" id="L972">            updateGlobalValue(entry.ordinal(), nbOutErrorTransfer);</span>
<span class="nc" id="L973">            return;</span>
          case applInboundBandwidthKBS:
<span class="nc" id="L975">            val = trafficCounter.lastReadThroughput() &gt;&gt; 10;// B/s -&gt; KB/s</span>
<span class="nc" id="L976">            updateGlobalValue(entry.ordinal(), val);</span>
<span class="nc" id="L977">            return;</span>
          case applOutboundBandwidthKBS:
<span class="nc" id="L979">            val = trafficCounter.lastWriteThroughput() &gt;&gt; 10;</span>
<span class="nc" id="L980">            updateGlobalValue(entry.ordinal(), val);</span>
<span class="nc" id="L981">            return;</span>
          case nbInfoUnknown:
<span class="nc" id="L983">            updateGlobalValue(entry.ordinal(), nbCountInfoUnknown);</span>
<span class="nc" id="L984">            return;</span>
          case nbInfoNotUpdated:
<span class="nc" id="L986">            updateGlobalValue(entry.ordinal(), nbCountInfoNotUpdated);</span>
<span class="nc" id="L987">            return;</span>
          case nbInfoInterrupted:
<span class="nc" id="L989">            updateGlobalValue(entry.ordinal(), nbCountInfoInterrupted);</span>
<span class="nc" id="L990">            return;</span>
          case nbInfoToSubmit:
<span class="nc" id="L992">            nbCountInfoToSubmit = CommanderNoDb.todoList.size();</span>
<span class="nc" id="L993">            updateGlobalValue(entry.ordinal(), nbCountInfoToSubmit);</span>
<span class="nc" id="L994">            return;</span>
          case nbInfoError:
<span class="nc" id="L996">            updateGlobalValue(entry.ordinal(), nbCountInfoError);</span>
<span class="nc" id="L997">            return;</span>
          case nbInfoRunning:
<span class="nc" id="L999">            nbCountInfoRunning = Configuration.configuration.getInternalRunner()</span>
<span class="nc" id="L1000">                                                            .nbInternalRunner();</span>
<span class="nc" id="L1001">            updateGlobalValue(entry.ordinal(), nbCountInfoRunning);</span>
<span class="nc" id="L1002">            return;</span>
          case nbInfoDone:
<span class="nc" id="L1004">            updateGlobalValue(entry.ordinal(), nbCountInfoDone);</span>
<span class="nc" id="L1005">            return;</span>
          case nbStepAllTransfer:
<span class="nc" id="L1007">            updateGlobalValue(entry.ordinal(), nbCountStepAllTransfer);</span>
<span class="nc" id="L1008">            return;</span>
          case nbThreads:
<span class="nc" id="L1010">            nbThread = Thread.activeCount();</span>
<span class="nc" id="L1011">            updateGlobalValue(entry.ordinal(), nbThread);</span>
<span class="nc" id="L1012">            return;</span>
          case nbNetworkConnection:
<span class="nc" id="L1014">            nbNetworkConnection =</span>
<span class="nc" id="L1015">                Configuration.configuration.getHttpChannelGroup().size() +</span>
<span class="nc" id="L1016">                Configuration.configuration.getServerChannelGroup().size();</span>
<span class="nc" id="L1017">            updateGlobalValue(entry.ordinal(), nbNetworkConnection);</span>
<span class="nc" id="L1018">            return;</span>
        }
<span class="nc" id="L1020">        return;</span>
      }
      // Global
      try {
<span class="nc bnc" id="L1024" title="All 22 branches missed.">        switch (entry) {</span>
          case applUptime:
          case memoryUsed:
          case memoryFree:
          case memoryTotal:
          case applLastChange:
          case applOperStatus:
<span class="nc" id="L1031">            return;</span>
          case applInboundAssociations:
<span class="nc" id="L1033">            DbTaskRunner</span>
<span class="nc" id="L1034">                .finishSelectOrCountPrepareStatement(countInActiveTransfer,</span>
                                                     limitDate);
<span class="nc" id="L1036">            nbInActiveTransfer = DbTaskRunner</span>
<span class="nc" id="L1037">                .getResultCountPrepareStatement(countInActiveTransfer);</span>
<span class="nc" id="L1038">            updateGlobalValue(entry.ordinal(), nbInActiveTransfer);</span>
<span class="nc" id="L1039">            return;</span>
          case applOutboundAssociations:
<span class="nc" id="L1041">            DbTaskRunner</span>
<span class="nc" id="L1042">                .finishSelectOrCountPrepareStatement(countOutActiveTransfer,</span>
                                                     limitDate);
<span class="nc" id="L1044">            nbOutActiveTransfer = DbTaskRunner</span>
<span class="nc" id="L1045">                .getResultCountPrepareStatement(countOutActiveTransfer);</span>
<span class="nc" id="L1046">            updateGlobalValue(entry.ordinal(), nbOutActiveTransfer);</span>
<span class="nc" id="L1047">            return;</span>
          case applAccumInboundAssociations:
<span class="nc" id="L1049">            DbTaskRunner</span>
<span class="nc" id="L1050">                .finishSelectOrCountPrepareStatement(countInTotalTransfer,</span>
                                                     limitDate);
<span class="nc" id="L1052">            nbInTotalTransfer = DbTaskRunner</span>
<span class="nc" id="L1053">                .getResultCountPrepareStatement(countInTotalTransfer);</span>
<span class="nc" id="L1054">            updateGlobalValue(entry.ordinal(), nbInTotalTransfer);</span>
<span class="nc" id="L1055">            return;</span>
          case applAccumOutboundAssociations:
<span class="nc" id="L1057">            DbTaskRunner</span>
<span class="nc" id="L1058">                .finishSelectOrCountPrepareStatement(countOutTotalTransfer,</span>
                                                     limitDate);
<span class="nc" id="L1060">            nbOutTotalTransfer = DbTaskRunner</span>
<span class="nc" id="L1061">                .getResultCountPrepareStatement(countOutTotalTransfer);</span>
<span class="nc" id="L1062">            updateGlobalValue(entry.ordinal(), nbOutTotalTransfer);</span>
<span class="nc" id="L1063">            return;</span>
          case applLastInboundActivity:
<span class="nc" id="L1065">            val = (lastInActiveTransfer - agent.getUptimeSystemTime()) / 10;</span>
<span class="nc bnc" id="L1066" title="All 2 branches missed.">            if (val &lt; 0) {</span>
<span class="nc" id="L1067">              val = 0;</span>
            }
<span class="nc" id="L1069">            updateGlobalValue(entry.ordinal(), val);</span>
<span class="nc" id="L1070">            return;</span>
          case applLastOutboundActivity:
<span class="nc" id="L1072">            val = (lastOutActiveTransfer - agent.getUptimeSystemTime()) / 10;</span>
<span class="nc bnc" id="L1073" title="All 2 branches missed.">            if (val &lt; 0) {</span>
<span class="nc" id="L1074">              val = 0;</span>
            }
<span class="nc" id="L1076">            updateGlobalValue(entry.ordinal(), val);</span>
<span class="nc" id="L1077">            return;</span>
          case applRejectedInboundAssociations:
<span class="nc" id="L1079">            DbTaskRunner</span>
<span class="nc" id="L1080">                .finishSelectOrCountPrepareStatement(countInErrorTransfer,</span>
                                                     limitDate);
<span class="nc" id="L1082">            nbInErrorTransfer = DbTaskRunner</span>
<span class="nc" id="L1083">                .getResultCountPrepareStatement(countInErrorTransfer);</span>
<span class="nc" id="L1084">            updateGlobalValue(entry.ordinal(), nbInErrorTransfer);</span>
<span class="nc" id="L1085">            return;</span>
          case applFailedOutboundAssociations:
<span class="nc" id="L1087">            DbTaskRunner</span>
<span class="nc" id="L1088">                .finishSelectOrCountPrepareStatement(countOutErrorTransfer,</span>
                                                     limitDate);
<span class="nc" id="L1090">            nbOutErrorTransfer = DbTaskRunner</span>
<span class="nc" id="L1091">                .getResultCountPrepareStatement(countOutErrorTransfer);</span>
<span class="nc" id="L1092">            updateGlobalValue(entry.ordinal(), nbOutErrorTransfer);</span>
<span class="nc" id="L1093">            return;</span>
          case applInboundBandwidthKBS:
<span class="nc" id="L1095">            val = trafficCounter.lastReadThroughput() &gt;&gt; 10;// B/s -&gt; KB/s</span>
<span class="nc" id="L1096">            updateGlobalValue(entry.ordinal(), val);</span>
<span class="nc" id="L1097">            return;</span>
          case applOutboundBandwidthKBS:
<span class="nc" id="L1099">            val = trafficCounter.lastWriteThroughput() &gt;&gt; 10;</span>
<span class="nc" id="L1100">            updateGlobalValue(entry.ordinal(), val);</span>
<span class="nc" id="L1101">            return;</span>
          case nbInfoUnknown:
<span class="nc" id="L1103">            nbCountInfoUnknown = DbTaskRunner</span>
<span class="nc" id="L1104">                .getResultCountPrepareStatement(countInfo, UpdatedInfo.UNKNOWN,</span>
                                                limitDate);
<span class="nc" id="L1106">            updateGlobalValue(entry.ordinal(), nbCountInfoUnknown);</span>
<span class="nc" id="L1107">            return;</span>
          case nbInfoNotUpdated:
<span class="nc" id="L1109">            nbCountInfoNotUpdated = DbTaskRunner</span>
<span class="nc" id="L1110">                .getResultCountPrepareStatement(countInfo,</span>
                                                UpdatedInfo.NOTUPDATED,
                                                limitDate);
<span class="nc" id="L1113">            updateGlobalValue(entry.ordinal(), nbCountInfoNotUpdated);</span>
<span class="nc" id="L1114">            return;</span>
          case nbInfoInterrupted:
<span class="nc" id="L1116">            nbCountInfoInterrupted = DbTaskRunner</span>
<span class="nc" id="L1117">                .getResultCountPrepareStatement(countInfo,</span>
                                                UpdatedInfo.INTERRUPTED,
                                                limitDate);
<span class="nc" id="L1120">            updateGlobalValue(entry.ordinal(), nbCountInfoInterrupted);</span>
<span class="nc" id="L1121">            return;</span>
          case nbInfoToSubmit:
<span class="nc" id="L1123">            nbCountInfoToSubmit = DbTaskRunner</span>
<span class="nc" id="L1124">                .getResultCountPrepareStatement(countInfo, UpdatedInfo.TOSUBMIT,</span>
                                                limitDate);
<span class="nc" id="L1126">            updateGlobalValue(entry.ordinal(), nbCountInfoToSubmit);</span>
<span class="nc" id="L1127">            return;</span>
          case nbInfoError:
<span class="nc" id="L1129">            nbCountInfoError = DbTaskRunner</span>
<span class="nc" id="L1130">                .getResultCountPrepareStatement(countInfo, UpdatedInfo.INERROR,</span>
                                                limitDate);
<span class="nc" id="L1132">            updateGlobalValue(entry.ordinal(), nbCountInfoError);</span>
<span class="nc" id="L1133">            return;</span>
          case nbInfoRunning:
<span class="nc" id="L1135">            nbCountInfoRunning = DbTaskRunner</span>
<span class="nc" id="L1136">                .getResultCountPrepareStatement(countInfo, UpdatedInfo.RUNNING,</span>
                                                limitDate);
<span class="nc" id="L1138">            updateGlobalValue(entry.ordinal(), nbCountInfoRunning);</span>
<span class="nc" id="L1139">            return;</span>
          case nbInfoDone:
<span class="nc" id="L1141">            nbCountInfoDone = DbTaskRunner</span>
<span class="nc" id="L1142">                .getResultCountPrepareStatement(countInfo, UpdatedInfo.DONE,</span>
                                                limitDate);
<span class="nc" id="L1144">            updateGlobalValue(entry.ordinal(), nbCountInfoDone);</span>
<span class="nc" id="L1145">            return;</span>
          case nbStepAllTransfer:
<span class="nc" id="L1147">            DbTaskRunner</span>
<span class="nc" id="L1148">                .finishSelectOrCountPrepareStatement(countStepAllTransfer,</span>
                                                     limitDate);
<span class="nc" id="L1150">            nbCountStepAllTransfer = DbTaskRunner</span>
<span class="nc" id="L1151">                .getResultCountPrepareStatement(countStepAllTransfer);</span>
<span class="nc" id="L1152">            updateGlobalValue(entry.ordinal(), nbCountStepAllTransfer);</span>
<span class="nc" id="L1153">            return;</span>
          case nbThreads:
<span class="nc" id="L1155">            nbThread = Thread.activeCount();</span>
<span class="nc" id="L1156">            updateGlobalValue(entry.ordinal(), nbThread);</span>
<span class="nc" id="L1157">            return;</span>
          case nbNetworkConnection:
<span class="nc" id="L1159">            nbNetworkConnection = DbAdmin.getNbConnection();</span>
<span class="nc" id="L1160">            updateGlobalValue(entry.ordinal(), nbNetworkConnection);</span>
        }
<span class="nc" id="L1162">      } catch (final WaarpDatabaseNoConnectionException ignored) {</span>
        // ignore
<span class="nc" id="L1164">      } catch (final WaarpDatabaseSqlException ignored) {</span>
        // ignore
<span class="nc" id="L1166">      }</span>
<span class="nc" id="L1167">    }</span>
<span class="nc" id="L1168">  }</span>

  /**
   * Update a value in Detailed MIB part
   *
   * @param nbMs
   * @param entry
   */
  protected void run(long nbMs, WaarpDetailedValuesIndex entry) {
<span class="nc" id="L1177">    synchronized (trafficCounter) {</span>
<span class="nc" id="L1178">      final long limitDate = System.currentTimeMillis() - nbMs;</span>
<span class="nc bnc" id="L1179" title="All 4 branches missed.">      if (dbSession == null || dbSession.isDisActive()) {</span>
<span class="nc bnc" id="L1180" title="All 14 branches missed.">        switch (entry) {</span>
          case nbStepNotask:
<span class="nc" id="L1182">            updateDetailedValue(entry.ordinal(), nbCountStepNotask);</span>
<span class="nc" id="L1183">            return;</span>
          case nbStepPretask:
<span class="nc" id="L1185">            updateDetailedValue(entry.ordinal(), nbCountStepPretask);</span>
<span class="nc" id="L1186">            return;</span>
          case nbStepTransfer:
<span class="nc" id="L1188">            updateDetailedValue(entry.ordinal(), nbCountStepTransfer);</span>
<span class="nc" id="L1189">            return;</span>
          case nbStepPosttask:
<span class="nc" id="L1191">            updateDetailedValue(entry.ordinal(), nbCountStepPosttask);</span>
<span class="nc" id="L1192">            return;</span>
          case nbStepAllDone:
<span class="nc" id="L1194">            updateDetailedValue(entry.ordinal(), nbCountStepAllDone);</span>
<span class="nc" id="L1195">            return;</span>
          case nbStepError:
<span class="nc" id="L1197">            updateDetailedValue(entry.ordinal(), nbCountStepError);</span>
<span class="nc" id="L1198">            return;</span>
          case nbAllRunningStep:
<span class="nc" id="L1200">            nbCountAllRunningStep =</span>
<span class="nc" id="L1201">                Configuration.configuration.getInternalRunner()</span>
<span class="nc" id="L1202">                                           .nbInternalRunner();</span>
<span class="nc" id="L1203">            updateDetailedValue(entry.ordinal(), nbCountAllRunningStep);</span>
<span class="nc" id="L1204">            return;</span>
          case nbRunningStep:
<span class="nc" id="L1206">            updateDetailedValue(entry.ordinal(), nbCountRunningStep);</span>
<span class="nc" id="L1207">            return;</span>
          case nbInitOkStep:
<span class="nc" id="L1209">            updateDetailedValue(entry.ordinal(), nbCountInitOkStep);</span>
<span class="nc" id="L1210">            return;</span>
          case nbPreProcessingOkStep:
<span class="nc" id="L1212">            updateDetailedValue(entry.ordinal(), nbCountPreProcessingOkStep);</span>
<span class="nc" id="L1213">            return;</span>
          case nbTransferOkStep:
<span class="nc" id="L1215">            updateDetailedValue(entry.ordinal(), nbCountTransferOkStep);</span>
<span class="nc" id="L1216">            return;</span>
          case nbPostProcessingOkStep:
<span class="nc" id="L1218">            updateDetailedValue(entry.ordinal(), nbCountPostProcessingOkStep);</span>
<span class="nc" id="L1219">            return;</span>
          case nbCompleteOkStep:
<span class="nc" id="L1221">            updateDetailedValue(entry.ordinal(), nbCountCompleteOkStep);</span>
<span class="nc" id="L1222">            return;</span>
        }
<span class="nc" id="L1224">        return;</span>
      }
      // Detailed
      try {
<span class="nc bnc" id="L1228" title="All 14 branches missed.">        switch (entry) {</span>
          case nbStepNotask:
<span class="nc" id="L1230">            DbTaskRunner.finishSelectOrCountPrepareStatement(countStepNotask,</span>
                                                             limitDate);
<span class="nc" id="L1232">            nbCountStepNotask =</span>
<span class="nc" id="L1233">                DbTaskRunner.getResultCountPrepareStatement(countStepNotask);</span>
<span class="nc" id="L1234">            updateDetailedValue(entry.ordinal(), nbCountStepNotask);</span>
<span class="nc" id="L1235">            return;</span>
          case nbStepPretask:
<span class="nc" id="L1237">            DbTaskRunner.finishSelectOrCountPrepareStatement(countStepPretask,</span>
                                                             limitDate);
<span class="nc" id="L1239">            nbCountStepPretask =</span>
<span class="nc" id="L1240">                DbTaskRunner.getResultCountPrepareStatement(countStepPretask);</span>
<span class="nc" id="L1241">            updateDetailedValue(entry.ordinal(), nbCountStepPretask);</span>
<span class="nc" id="L1242">            return;</span>
          case nbStepTransfer:
<span class="nc" id="L1244">            DbTaskRunner.finishSelectOrCountPrepareStatement(countStepTransfer,</span>
                                                             limitDate);
<span class="nc" id="L1246">            nbCountStepTransfer =</span>
<span class="nc" id="L1247">                DbTaskRunner.getResultCountPrepareStatement(countStepTransfer);</span>
<span class="nc" id="L1248">            updateDetailedValue(entry.ordinal(), nbCountStepTransfer);</span>
<span class="nc" id="L1249">            return;</span>
          case nbStepPosttask:
<span class="nc" id="L1251">            DbTaskRunner.finishSelectOrCountPrepareStatement(countStepPosttask,</span>
                                                             limitDate);
<span class="nc" id="L1253">            nbCountStepPosttask =</span>
<span class="nc" id="L1254">                DbTaskRunner.getResultCountPrepareStatement(countStepPosttask);</span>
<span class="nc" id="L1255">            updateDetailedValue(entry.ordinal(), nbCountStepPosttask);</span>
<span class="nc" id="L1256">            return;</span>
          case nbStepAllDone:
<span class="nc" id="L1258">            DbTaskRunner.finishSelectOrCountPrepareStatement(countStepAllDone,</span>
                                                             limitDate);
<span class="nc" id="L1260">            nbCountStepAllDone =</span>
<span class="nc" id="L1261">                DbTaskRunner.getResultCountPrepareStatement(countStepAllDone);</span>
<span class="nc" id="L1262">            updateDetailedValue(entry.ordinal(), nbCountStepAllDone);</span>
<span class="nc" id="L1263">            return;</span>
          case nbStepError:
<span class="nc" id="L1265">            DbTaskRunner</span>
<span class="nc" id="L1266">                .finishSelectOrCountPrepareStatement(countStepError, limitDate);</span>
<span class="nc" id="L1267">            nbCountStepError =</span>
<span class="nc" id="L1268">                DbTaskRunner.getResultCountPrepareStatement(countStepError);</span>
<span class="nc" id="L1269">            updateDetailedValue(entry.ordinal(), nbCountStepError);</span>
<span class="nc" id="L1270">            return;</span>
          case nbAllRunningStep:
<span class="nc" id="L1272">            DbTaskRunner</span>
<span class="nc" id="L1273">                .finishSelectOrCountPrepareStatement(countAllRunningStep,</span>
                                                     limitDate);
<span class="nc" id="L1275">            nbCountAllRunningStep = DbTaskRunner</span>
<span class="nc" id="L1276">                .getResultCountPrepareStatement(countAllRunningStep);</span>
<span class="nc" id="L1277">            updateDetailedValue(entry.ordinal(), nbCountAllRunningStep);</span>
<span class="nc" id="L1278">            return;</span>
          case nbRunningStep:
<span class="nc" id="L1280">            DbTaskRunner.finishSelectOrCountPrepareStatement(countRunningStep,</span>
                                                             limitDate);
<span class="nc" id="L1282">            nbCountRunningStep =</span>
<span class="nc" id="L1283">                DbTaskRunner.getResultCountPrepareStatement(countRunningStep);</span>
<span class="nc" id="L1284">            updateDetailedValue(entry.ordinal(), nbCountRunningStep);</span>
<span class="nc" id="L1285">            return;</span>
          case nbInitOkStep:
<span class="nc" id="L1287">            DbTaskRunner.finishSelectOrCountPrepareStatement(countInitOkStep,</span>
                                                             limitDate);
<span class="nc" id="L1289">            nbCountInitOkStep =</span>
<span class="nc" id="L1290">                DbTaskRunner.getResultCountPrepareStatement(countInitOkStep);</span>
<span class="nc" id="L1291">            updateDetailedValue(entry.ordinal(), nbCountInitOkStep);</span>
<span class="nc" id="L1292">            return;</span>
          case nbPreProcessingOkStep:
<span class="nc" id="L1294">            DbTaskRunner</span>
<span class="nc" id="L1295">                .finishSelectOrCountPrepareStatement(countPreProcessingOkStep,</span>
                                                     limitDate);
<span class="nc" id="L1297">            nbCountPreProcessingOkStep = DbTaskRunner</span>
<span class="nc" id="L1298">                .getResultCountPrepareStatement(countPreProcessingOkStep);</span>
<span class="nc" id="L1299">            updateDetailedValue(entry.ordinal(), nbCountPreProcessingOkStep);</span>
<span class="nc" id="L1300">            return;</span>
          case nbTransferOkStep:
<span class="nc" id="L1302">            DbTaskRunner</span>
<span class="nc" id="L1303">                .finishSelectOrCountPrepareStatement(countTransferOkStep,</span>
                                                     limitDate);
<span class="nc" id="L1305">            nbCountTransferOkStep = DbTaskRunner</span>
<span class="nc" id="L1306">                .getResultCountPrepareStatement(countTransferOkStep);</span>
<span class="nc" id="L1307">            updateDetailedValue(entry.ordinal(), nbCountTransferOkStep);</span>
<span class="nc" id="L1308">            return;</span>
          case nbPostProcessingOkStep:
<span class="nc" id="L1310">            DbTaskRunner</span>
<span class="nc" id="L1311">                .finishSelectOrCountPrepareStatement(countPostProcessingOkStep,</span>
                                                     limitDate);
<span class="nc" id="L1313">            nbCountPostProcessingOkStep = DbTaskRunner</span>
<span class="nc" id="L1314">                .getResultCountPrepareStatement(countPostProcessingOkStep);</span>
<span class="nc" id="L1315">            updateDetailedValue(entry.ordinal(), nbCountPostProcessingOkStep);</span>
<span class="nc" id="L1316">            return;</span>
          case nbCompleteOkStep:
<span class="nc" id="L1318">            DbTaskRunner</span>
<span class="nc" id="L1319">                .finishSelectOrCountPrepareStatement(countCompleteOkStep,</span>
                                                     limitDate);
<span class="nc" id="L1321">            nbCountCompleteOkStep = DbTaskRunner</span>
<span class="nc" id="L1322">                .getResultCountPrepareStatement(countCompleteOkStep);</span>
<span class="nc" id="L1323">            updateDetailedValue(entry.ordinal(), nbCountCompleteOkStep);</span>
        }
<span class="nc" id="L1325">      } catch (final WaarpDatabaseNoConnectionException e) {</span>
<span class="nc" id="L1326">        logger</span>
<span class="nc" id="L1327">            .info(&quot;Database No Connection Error: Cannot execute Monitoring&quot;, e);</span>
        try {
<span class="nc" id="L1329">          dbSession.getAdmin().getDbModel().validConnection(dbSession);</span>
<span class="nc" id="L1330">        } catch (final WaarpDatabaseNoConnectionException ignored) {</span>
          // ignore
<span class="nc" id="L1332">        }</span>
<span class="nc" id="L1333">      } catch (final WaarpDatabaseSqlException e) {</span>
<span class="nc" id="L1334">        logger</span>
<span class="nc" id="L1335">            .info(&quot;Database No Connection Error: Cannot execute Monitoring&quot;, e);</span>
        try {
<span class="nc" id="L1337">          dbSession.getAdmin().getDbModel().validConnection(dbSession);</span>
<span class="nc" id="L1338">        } catch (final WaarpDatabaseNoConnectionException ignored) {</span>
          // ignore
<span class="nc" id="L1340">        }</span>
<span class="nc" id="L1341">      }</span>
<span class="nc" id="L1342">    }</span>
<span class="nc" id="L1343">  }</span>

  /**
   * Update a value in Error MIB part
   *
   * @param nbMs
   * @param entry
   */
  protected void run(long nbMs, WaarpErrorValuesIndex entry) {
<span class="nc" id="L1352">    synchronized (trafficCounter) {</span>
<span class="nc" id="L1353">      final long limitDate = System.currentTimeMillis() - nbMs;</span>
<span class="nc bnc" id="L1354" title="All 4 branches missed.">      if (dbSession == null || dbSession.isDisActive()) {</span>
<span class="nc" id="L1355">        return;</span>
      }
      // Error
<span class="nc bnc" id="L1358" title="All 25 branches missed.">      switch (entry) {</span>
        case nbStatusConnectionImpossible:
<span class="nc" id="L1360">          nbCountStatusConnectionImpossible = DbTaskRunner</span>
<span class="nc" id="L1361">              .getResultCountPrepareStatement(countStatus,</span>
                                              ErrorCode.ConnectionImpossible,
                                              limitDate);
<span class="nc" id="L1364">          updateErrorValue(entry.ordinal(), nbCountStatusConnectionImpossible);</span>
<span class="nc" id="L1365">          return;</span>
        case nbStatusServerOverloaded:
<span class="nc" id="L1367">          nbCountStatusServerOverloaded = DbTaskRunner</span>
<span class="nc" id="L1368">              .getResultCountPrepareStatement(countStatus,</span>
                                              ErrorCode.ServerOverloaded,
                                              limitDate);
<span class="nc" id="L1371">          updateErrorValue(entry.ordinal(), nbCountStatusServerOverloaded);</span>
<span class="nc" id="L1372">          return;</span>
        case nbStatusBadAuthent:
<span class="nc" id="L1374">          nbCountStatusBadAuthent = DbTaskRunner</span>
<span class="nc" id="L1375">              .getResultCountPrepareStatement(countStatus, ErrorCode.BadAuthent,</span>
                                              limitDate);
<span class="nc" id="L1377">          updateErrorValue(entry.ordinal(), nbCountStatusBadAuthent);</span>
<span class="nc" id="L1378">          return;</span>
        case nbStatusExternalOp:
<span class="nc" id="L1380">          nbCountStatusExternalOp = DbTaskRunner</span>
<span class="nc" id="L1381">              .getResultCountPrepareStatement(countStatus, ErrorCode.ExternalOp,</span>
                                              limitDate);
<span class="nc" id="L1383">          updateErrorValue(entry.ordinal(), nbCountStatusExternalOp);</span>
<span class="nc" id="L1384">          return;</span>
        case nbStatusTransferError:
<span class="nc" id="L1386">          nbCountStatusTransferError = DbTaskRunner</span>
<span class="nc" id="L1387">              .getResultCountPrepareStatement(countStatus,</span>
                                              ErrorCode.TransferError,
                                              limitDate);
<span class="nc" id="L1390">          updateErrorValue(entry.ordinal(), nbCountStatusTransferError);</span>
<span class="nc" id="L1391">          return;</span>
        case nbStatusMD5Error:
<span class="nc" id="L1393">          nbCountStatusMD5Error = DbTaskRunner</span>
<span class="nc" id="L1394">              .getResultCountPrepareStatement(countStatus, ErrorCode.MD5Error,</span>
                                              limitDate);
<span class="nc" id="L1396">          updateErrorValue(entry.ordinal(), nbCountStatusMD5Error);</span>
<span class="nc" id="L1397">          return;</span>
        case nbStatusDisconnection:
<span class="nc" id="L1399">          nbCountStatusDisconnection = DbTaskRunner</span>
<span class="nc" id="L1400">              .getResultCountPrepareStatement(countStatus,</span>
                                              ErrorCode.Disconnection,
                                              limitDate);
<span class="nc" id="L1403">          updateErrorValue(entry.ordinal(), nbCountStatusDisconnection);</span>
<span class="nc" id="L1404">          return;</span>
        case nbStatusFinalOp:
<span class="nc" id="L1406">          nbCountStatusFinalOp = DbTaskRunner</span>
<span class="nc" id="L1407">              .getResultCountPrepareStatement(countStatus, ErrorCode.FinalOp,</span>
                                              limitDate);
<span class="nc" id="L1409">          updateErrorValue(entry.ordinal(), nbCountStatusFinalOp);</span>
<span class="nc" id="L1410">          return;</span>
        case nbStatusUnimplemented:
<span class="nc" id="L1412">          nbCountStatusUnimplemented = DbTaskRunner</span>
<span class="nc" id="L1413">              .getResultCountPrepareStatement(countStatus,</span>
                                              ErrorCode.Unimplemented,
                                              limitDate);
<span class="nc" id="L1416">          updateErrorValue(entry.ordinal(), nbCountStatusUnimplemented);</span>
<span class="nc" id="L1417">          return;</span>
        case nbStatusInternal:
<span class="nc" id="L1419">          nbCountStatusInternal = DbTaskRunner</span>
<span class="nc" id="L1420">              .getResultCountPrepareStatement(countStatus, ErrorCode.Internal,</span>
                                              limitDate);
<span class="nc" id="L1422">          updateErrorValue(entry.ordinal(), nbCountStatusInternal);</span>
<span class="nc" id="L1423">          return;</span>
        case nbStatusWarning:
<span class="nc" id="L1425">          nbCountStatusWarning = DbTaskRunner</span>
<span class="nc" id="L1426">              .getResultCountPrepareStatement(countStatus, ErrorCode.Warning,</span>
                                              limitDate);
<span class="nc" id="L1428">          updateErrorValue(entry.ordinal(), nbCountStatusWarning);</span>
<span class="nc" id="L1429">          return;</span>
        case nbStatusQueryAlreadyFinished:
<span class="nc" id="L1431">          nbCountStatusQueryAlreadyFinished = DbTaskRunner</span>
<span class="nc" id="L1432">              .getResultCountPrepareStatement(countStatus,</span>
                                              ErrorCode.QueryAlreadyFinished,
                                              limitDate);
<span class="nc" id="L1435">          updateErrorValue(entry.ordinal(), nbCountStatusQueryAlreadyFinished);</span>
<span class="nc" id="L1436">          return;</span>
        case nbStatusQueryStillRunning:
<span class="nc" id="L1438">          nbCountStatusQueryStillRunning = DbTaskRunner</span>
<span class="nc" id="L1439">              .getResultCountPrepareStatement(countStatus,</span>
                                              ErrorCode.QueryStillRunning,
                                              limitDate);
<span class="nc" id="L1442">          updateErrorValue(entry.ordinal(), nbCountStatusQueryStillRunning);</span>
<span class="nc" id="L1443">          return;</span>
        case nbStatusNotKnownHost:
<span class="nc" id="L1445">          nbCountStatusNotKnownHost = DbTaskRunner</span>
<span class="nc" id="L1446">              .getResultCountPrepareStatement(countStatus,</span>
                                              ErrorCode.NotKnownHost,
                                              limitDate);
<span class="nc" id="L1449">          updateErrorValue(entry.ordinal(), nbCountStatusNotKnownHost);</span>
<span class="nc" id="L1450">          return;</span>
        case nbStatusQueryRemotelyUnknown:
<span class="nc" id="L1452">          nbCountStatusQueryRemotelyUnknown = DbTaskRunner</span>
<span class="nc" id="L1453">              .getResultCountPrepareStatement(countStatus,</span>
                                              ErrorCode.QueryRemotelyUnknown,
                                              limitDate);
<span class="nc" id="L1456">          updateErrorValue(entry.ordinal(), nbCountStatusQueryRemotelyUnknown);</span>
<span class="nc" id="L1457">          return;</span>
        case nbStatusCommandNotFound:
<span class="nc" id="L1459">          nbCountStatusCommandNotFound = DbTaskRunner</span>
<span class="nc" id="L1460">              .getResultCountPrepareStatement(countStatus,</span>
                                              ErrorCode.CommandNotFound,
                                              limitDate);
<span class="nc" id="L1463">          updateErrorValue(entry.ordinal(), nbCountStatusCommandNotFound);</span>
<span class="nc" id="L1464">          return;</span>
        case nbStatusPassThroughMode:
<span class="nc" id="L1466">          nbCountStatusPassThroughMode = DbTaskRunner</span>
<span class="nc" id="L1467">              .getResultCountPrepareStatement(countStatus,</span>
                                              ErrorCode.PassThroughMode,
                                              limitDate);
<span class="nc" id="L1470">          updateErrorValue(entry.ordinal(), nbCountStatusPassThroughMode);</span>
<span class="nc" id="L1471">          return;</span>
        case nbStatusRemoteShutdown:
<span class="nc" id="L1473">          nbCountStatusRemoteShutdown = DbTaskRunner</span>
<span class="nc" id="L1474">              .getResultCountPrepareStatement(countStatus,</span>
                                              ErrorCode.RemoteShutdown,
                                              limitDate);
<span class="nc" id="L1477">          updateErrorValue(entry.ordinal(), nbCountStatusRemoteShutdown);</span>
<span class="nc" id="L1478">          return;</span>
        case nbStatusShutdown:
<span class="nc" id="L1480">          nbCountStatusShutdown = DbTaskRunner</span>
<span class="nc" id="L1481">              .getResultCountPrepareStatement(countStatus, ErrorCode.Shutdown,</span>
                                              limitDate);
<span class="nc" id="L1483">          updateErrorValue(entry.ordinal(), nbCountStatusShutdown);</span>
<span class="nc" id="L1484">          return;</span>
        case nbStatusRemoteError:
<span class="nc" id="L1486">          nbCountStatusRemoteError = DbTaskRunner</span>
<span class="nc" id="L1487">              .getResultCountPrepareStatement(countStatus,</span>
                                              ErrorCode.RemoteError, limitDate);
<span class="nc" id="L1489">          updateErrorValue(entry.ordinal(), nbCountStatusRemoteError);</span>
<span class="nc" id="L1490">          return;</span>
        case nbStatusStopped:
<span class="nc" id="L1492">          nbCountStatusStopped = DbTaskRunner</span>
<span class="nc" id="L1493">              .getResultCountPrepareStatement(countStatus,</span>
                                              ErrorCode.StoppedTransfer,
                                              limitDate);
<span class="nc" id="L1496">          updateErrorValue(entry.ordinal(), nbCountStatusStopped);</span>
<span class="nc" id="L1497">          return;</span>
        case nbStatusCanceled:
<span class="nc" id="L1499">          nbCountStatusCanceled = DbTaskRunner</span>
<span class="nc" id="L1500">              .getResultCountPrepareStatement(countStatus,</span>
                                              ErrorCode.CanceledTransfer,
                                              limitDate);
<span class="nc" id="L1503">          updateErrorValue(entry.ordinal(), nbCountStatusCanceled);</span>
<span class="nc" id="L1504">          return;</span>
        case nbStatusFileNotFound:
<span class="nc" id="L1506">          nbCountStatusFileNotFound = DbTaskRunner</span>
<span class="nc" id="L1507">              .getResultCountPrepareStatement(countStatus,</span>
                                              ErrorCode.FileNotFound,
                                              limitDate);
<span class="nc" id="L1510">          updateErrorValue(entry.ordinal(), nbCountStatusFileNotFound);</span>
<span class="nc" id="L1511">          return;</span>
        case nbStatusUnknown:
<span class="nc" id="L1513">          nbCountStatusUnknown = DbTaskRunner</span>
<span class="nc" id="L1514">              .getResultCountPrepareStatement(countStatus, ErrorCode.Unknown,</span>
                                              limitDate);
<span class="nc" id="L1516">          updateErrorValue(entry.ordinal(), nbCountStatusUnknown);</span>
      }
<span class="nc" id="L1518">    }</span>
<span class="nc" id="L1519">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>