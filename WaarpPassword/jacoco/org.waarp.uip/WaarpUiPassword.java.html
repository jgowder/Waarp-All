<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WaarpUiPassword.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Waarp Password Management GUI and Console</a> &gt; <a href="index.source.html" class="el_package">org.waarp.uip</a> &gt; <span class="el_source">WaarpUiPassword.java</span></div><h1>WaarpUiPassword.java</h1><pre class="source lang-java linenums">/*
 * This file is part of Waarp Project (named also Waarp or GG).
 *
 *  Copyright (c) 2019, Waarp SAS, and individual contributors by the @author
 *  tags. See the COPYRIGHT.txt in the distribution for a full listing of
 * individual contributors.
 *
 *  All Waarp Project is free software: you can redistribute it and/or
 * modify it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or (at your
 * option) any later version.
 *
 * Waarp is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along with
 * Waarp . If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package org.waarp.uip;

import org.waarp.common.crypto.Blowfish;
import org.waarp.common.crypto.Des;
import org.waarp.common.exception.CryptoException;
import org.waarp.common.logging.SysErrLogger;

import javax.swing.AbstractAction;
import javax.swing.BorderFactory;
import javax.swing.GroupLayout;
import javax.swing.JButton;
import javax.swing.JDialog;
import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JMenu;
import javax.swing.JMenuBar;
import javax.swing.JMenuItem;
import javax.swing.JPanel;
import javax.swing.JPasswordField;
import javax.swing.JSeparator;
import javax.swing.JTextField;
import javax.swing.JTextPane;
import javax.swing.LayoutStyle;
import javax.swing.SwingUtilities;
import javax.swing.WindowConstants;
import javax.swing.border.BevelBorder;
import javax.swing.filechooser.FileNameExtensionFilter;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.event.ActionEvent;
import java.awt.event.FocusAdapter;
import java.awt.event.FocusEvent;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.io.File;
import java.io.IOException;
import java.util.Locale;

/**
 * GUI for GoldenGate Password Management for GoldenGate products.
 */
public class WaarpUiPassword extends JFrame {

  /**
   *
   */
  private static final long serialVersionUID = -4276191288898099362L;
  protected WaarpUiPassword myself;
  private JMenuItem helpMenuItem;
  private JMenu jMenu5;
  private AbstractAction saveAsKeyAction;
  private AbstractAction saveKeyAction;
  private AbstractAction newKeyAction;
  private AbstractAction openKeyAction;
  private AbstractAction loadPswdAction;
  private AbstractAction exitAction;
  private JPanel jPanel1;
  private JTextField jTextFieldPasswordFile;
  private JPasswordField jPasswordField;
  private JTextField jPasswordFieldTxt;
  private JTextField jTextFieldCryptedPassword;
  private JTextField jTextFieldKeyFile;
  private JMenuItem savePasswordMenuItem;
  private AbstractAction helpAction;
  private AbstractAction savePaswdAction;
  private JMenuItem loadPasswordMenuItem;
  private JMenu jMenuPassword;
  private JMenuItem exitMenuItem;
  private JSeparator jSeparator2;
  private JMenuItem saveAsMenuItem;
  private JMenuItem saveMenuItem;
  private JMenuItem openFileMenuItem;
  private JMenuItem newFileMenuItem;
  private JMenu jMenu3;
  private JMenuBar jMenuBar1;

  private final JFileChooser chooserKeyFile;
  private transient final FileNameExtensionFilter filterKey;
  private final JFileChooser chooserPwdFile;
  private transient final FileNameExtensionFilter filterPwdKey;

  private AbstractAction closeHelpAction;
  private JTextPane jTextPaneHelp;
  private JButton jButtonHelp;
  private JDialog jDialogHelp;
  private transient WaarpPassword waarpPassword;
  boolean passwordModified;
  boolean extended;

  /**
   * Auto-generated main method to display this JFrame
   */
  public static void main(final String[] args) {
<span class="nc bnc" id="L113" title="All 2 branches missed.">    if (!WaarpPassword.loadOptions(args)) {</span>
      // Bad options
<span class="nc" id="L115">      System.exit(2);//NOSONAR</span>
    }
<span class="nc" id="L117">    SwingUtilities.invokeLater(new Runnable() {</span>
      @Override
      public void run() {
<span class="nc" id="L120">        final WaarpUiPassword inst = new WaarpUiPassword();</span>
<span class="nc" id="L121">        inst.setLocationRelativeTo(null);</span>
<span class="nc" id="L122">        inst.setVisible(true);</span>
<span class="nc" id="L123">      }</span>
    });
<span class="nc" id="L125">  }</span>

<span class="nc" id="L127">  protected WaarpUiPassword(final boolean extended_ignore) throws Exception {</span>
<span class="nc" id="L128">    extended = true;</span>
<span class="nc" id="L129">    chooserKeyFile = new JFileChooser();</span>
<span class="nc" id="L130">    filterKey = new FileNameExtensionFilter(</span>
        &quot;DES or Blowfish Key (&quot; + Des.EXTENSION + &quot;, &quot; + Blowfish.EXTENSION +
        ')', Des.EXTENSION, Blowfish.EXTENSION);
<span class="nc" id="L133">    chooserKeyFile.setFileFilter(filterKey);</span>
<span class="nc" id="L134">    chooserKeyFile.setFileSelectionMode(JFileChooser.FILES_ONLY);</span>

<span class="nc" id="L136">    chooserPwdFile = new JFileChooser();</span>
<span class="nc" id="L137">    filterPwdKey = new FileNameExtensionFilter(</span>
        &quot;GoldenGate Password Files (&quot; + WaarpPassword.GGPEXTENSION + ')',
        WaarpPassword.GGPEXTENSION);
<span class="nc" id="L140">    chooserPwdFile.setFileFilter(filterPwdKey);</span>
<span class="nc" id="L141">    chooserPwdFile.setFileSelectionMode(JFileChooser.FILES_ONLY);</span>

<span class="nc" id="L143">    waarpPassword = new WaarpPassword();</span>

<span class="nc" id="L145">    initGUI();</span>
<span class="nc" id="L146">    initFromGgPassword();</span>
<span class="nc" id="L147">  }</span>

<span class="nc" id="L149">  public WaarpUiPassword() {</span>
<span class="nc" id="L150">    myself = this;</span>
<span class="nc" id="L151">    chooserKeyFile = new JFileChooser();</span>
<span class="nc" id="L152">    filterKey = new FileNameExtensionFilter(</span>
        &quot;DES or Blowfish Key (&quot; + Des.EXTENSION + &quot;, &quot; + Blowfish.EXTENSION +
        ')', Des.EXTENSION, Blowfish.EXTENSION);
<span class="nc" id="L155">    chooserKeyFile.setFileFilter(filterKey);</span>
<span class="nc" id="L156">    chooserKeyFile.setFileSelectionMode(JFileChooser.FILES_ONLY);</span>

<span class="nc" id="L158">    chooserPwdFile = new JFileChooser();</span>
<span class="nc" id="L159">    filterPwdKey = new FileNameExtensionFilter(</span>
        &quot;GoldenGate Password Files (&quot; + WaarpPassword.GGPEXTENSION + ')',
        WaarpPassword.GGPEXTENSION);
<span class="nc" id="L162">    chooserPwdFile.setFileFilter(filterPwdKey);</span>
<span class="nc" id="L163">    chooserPwdFile.setFileSelectionMode(JFileChooser.FILES_ONLY);</span>

    try {
<span class="nc" id="L166">      waarpPassword = new WaarpPassword();</span>
<span class="nc" id="L167">    } catch (final Exception e) {</span>
<span class="nc" id="L168">      SysErrLogger.FAKE_LOGGER.syserr(e);</span>
<span class="nc" id="L169">      System.exit(3);//NOSONAR</span>
<span class="nc" id="L170">    }</span>

<span class="nc" id="L172">    initGUI();</span>
<span class="nc" id="L173">    initFromGgPassword();</span>
<span class="nc" id="L174">  }</span>

  private void initFromGgPassword() {
<span class="nc" id="L177">    final File keyFile = waarpPassword.getKeyFile();</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">    if (keyFile != null) {</span>
<span class="nc" id="L179">      jTextFieldKeyFile.setText(keyFile.getAbsolutePath());</span>
<span class="nc" id="L180">      enableMenuWithKey();</span>
    }
<span class="nc" id="L182">    final File pFile = waarpPassword.getPasswordFile();</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">    if (pFile != null) {</span>
<span class="nc" id="L184">      jTextFieldPasswordFile.setText(pFile.getAbsolutePath());</span>
    }
<span class="nc" id="L186">    String clpwd = waarpPassword.getClearPassword();</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">    if (clpwd != null) {</span>
<span class="nc" id="L188">      setUncryptedPassword(clpwd);</span>
<span class="nc" id="L189">      clpwd = waarpPassword.getCryptedPassword();</span>
<span class="nc" id="L190">      jTextFieldCryptedPassword.setText(clpwd);</span>
    }
<span class="nc" id="L192">  }</span>

  public void exit(final ActionEvent evt) {
<span class="nc bnc" id="L195" title="All 2 branches missed.">    if (passwordModified) {</span>
<span class="nc" id="L196">      getSavePaswdAction().actionPerformed(evt);</span>
    }
<span class="nc bnc" id="L198" title="All 2 branches missed.">    if (extended) {</span>
<span class="nc" id="L199">      myself.dispose();</span>
    } else {
<span class="nc" id="L201">      System.exit(1);//NOSONAR</span>
    }
<span class="nc" id="L203">  }</span>

  private void initGUI() {
    try {
<span class="nc" id="L207">      final GroupLayout thisLayout = new GroupLayout(getContentPane());</span>
<span class="nc" id="L208">      getContentPane().setLayout(thisLayout);</span>
<span class="nc" id="L209">      addWindowListener(new WindowAdapter() {</span>
        @Override
        public void windowClosing(final WindowEvent evt) {
<span class="nc" id="L212">          myself.exit(null);</span>
<span class="nc" id="L213">        }</span>

        @Override
        public void windowClosed(final WindowEvent evt) {
<span class="nc" id="L217">          myself.exit(null);</span>
<span class="nc" id="L218">        }</span>
      });
<span class="nc" id="L220">      setDefaultCloseOperation(WindowConstants.DO_NOTHING_ON_CLOSE);</span>
<span class="nc" id="L221">      setTitle(&quot;Waarp Password GUI&quot;);</span>
<span class="nc" id="L222">      setLocale(new Locale(&quot;en&quot;, &quot;GB&quot;));</span>
      {
<span class="nc" id="L224">        jTextFieldKeyFile = new JTextField();</span>
<span class="nc" id="L225">        jTextFieldKeyFile.setText(&quot;Key File&quot;);</span>
<span class="nc" id="L226">        jTextFieldKeyFile.setEditable(false);</span>
<span class="nc" id="L227">        jTextFieldKeyFile.setBorder(BorderFactory.createCompoundBorder(</span>
<span class="nc" id="L228">            BorderFactory.createMatteBorder(1, 1, 1, 1, new Color(0, 0, 0)),</span>
<span class="nc" id="L229">            BorderFactory.createCompoundBorder(null, null)));</span>
      }
      {
<span class="nc" id="L232">        jPanel1 = new JPanel();</span>
<span class="nc" id="L233">        final GroupLayout jPanel1Layout = new GroupLayout(jPanel1);</span>
<span class="nc" id="L234">        jPanel1.setLayout(jPanel1Layout);</span>
<span class="nc" id="L235">        jPanel1.setBorder(BorderFactory.createBevelBorder(BevelBorder.LOWERED));</span>
        {
<span class="nc" id="L237">          jTextFieldPasswordFile = new JTextField();</span>
<span class="nc" id="L238">          jTextFieldPasswordFile.setText(&quot;Password File&quot;);</span>
<span class="nc" id="L239">          jTextFieldPasswordFile.setEditable(false);</span>
<span class="nc" id="L240">          jTextFieldPasswordFile.setBorder(BorderFactory.createCompoundBorder(</span>
<span class="nc" id="L241">              BorderFactory.createMatteBorder(1, 1, 1, 1, new Color(0, 0, 0)),</span>
<span class="nc" id="L242">              BorderFactory.createCompoundBorder(null, null)));</span>
        }
        {
<span class="nc bnc" id="L245" title="All 2 branches missed.">          if (WaarpPassword.clearPasswordView) {</span>
<span class="nc" id="L246">            jPasswordFieldTxt = new JTextField();</span>
<span class="nc" id="L247">            jPasswordFieldTxt.addFocusListener(new FocusAdapter() {</span>
              @Override
              public void focusLost(final FocusEvent evt) {
<span class="nc" id="L250">                final String paswd = jPasswordFieldTxt.getText();</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">                if (!paswd.equals(waarpPassword.getClearPassword())) {</span>
                  try {
<span class="nc" id="L253">                    waarpPassword.setClearPassword(paswd);</span>
<span class="nc" id="L254">                  } catch (final Exception e) {</span>
<span class="nc" id="L255">                    SysErrLogger.FAKE_LOGGER.syserr(e);</span>
<span class="nc" id="L256">                  }</span>
<span class="nc" id="L257">                  jTextFieldCryptedPassword</span>
<span class="nc" id="L258">                      .setText(waarpPassword.getCryptedPassword());</span>
<span class="nc" id="L259">                  passwordModified = true;</span>
                }
<span class="nc" id="L261">              }</span>
            });
          } else {
<span class="nc" id="L264">            jPasswordField = new JPasswordField();</span>
<span class="nc" id="L265">            jPasswordField.addFocusListener(new FocusAdapter() {</span>
              @Override
              public void focusLost(final FocusEvent evt) {
<span class="nc" id="L268">                final String paswd = new String(jPasswordField.getPassword());</span>
<span class="nc bnc" id="L269" title="All 2 branches missed.">                if (!paswd.equals(waarpPassword.getClearPassword())) {</span>
                  try {
<span class="nc" id="L271">                    waarpPassword.setClearPassword(paswd);</span>
<span class="nc" id="L272">                  } catch (final Exception e) {</span>
<span class="nc" id="L273">                    SysErrLogger.FAKE_LOGGER.syserr(e);</span>
<span class="nc" id="L274">                  }</span>
<span class="nc" id="L275">                  jTextFieldCryptedPassword</span>
<span class="nc" id="L276">                      .setText(waarpPassword.getCryptedPassword());</span>
<span class="nc" id="L277">                  passwordModified = true;</span>
                }
<span class="nc" id="L279">              }</span>
            });
          }
        }
        {
<span class="nc" id="L284">          jTextFieldCryptedPassword = new JTextField();</span>
<span class="nc" id="L285">          jTextFieldCryptedPassword.addFocusListener(new FocusAdapter() {</span>
            @Override
            public void focusLost(final FocusEvent evt) {
<span class="nc" id="L288">              final String paswd = jTextFieldCryptedPassword.getText();</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">              if (!paswd.equals(waarpPassword.getCryptedPassword())) {</span>
                try {
<span class="nc" id="L291">                  waarpPassword.setCryptedPassword(paswd);</span>
<span class="nc" id="L292">                } catch (final Exception e1) {</span>
<span class="nc" id="L293">                  SysErrLogger.FAKE_LOGGER.syserr(e1);</span>
<span class="nc" id="L294">                }</span>
<span class="nc" id="L295">                setUncryptedPassword(waarpPassword.getClearPassword());</span>
<span class="nc" id="L296">                jTextFieldCryptedPassword</span>
<span class="nc" id="L297">                    .setText(waarpPassword.getCryptedPassword());</span>
<span class="nc" id="L298">                passwordModified = true;</span>
              }
<span class="nc" id="L300">            }</span>
          });
        }
<span class="nc bnc" id="L303" title="All 2 branches missed.">        if (WaarpPassword.clearPasswordView) {</span>
<span class="nc" id="L304">          jPanel1Layout.setHorizontalGroup(</span>
<span class="nc" id="L305">              jPanel1Layout.createSequentialGroup().addContainerGap().addGroup(</span>
<span class="nc" id="L306">                  jPanel1Layout.createParallelGroup().addGroup(</span>
<span class="nc" id="L307">                      jPanel1Layout.createSequentialGroup()</span>
<span class="nc" id="L308">                                   .addComponent(jTextFieldPasswordFile,</span>
                                                 GroupLayout.PREFERRED_SIZE,
                                                 340,
                                                 GroupLayout.PREFERRED_SIZE)
<span class="nc" id="L312">                                   .addGap(0, 0, Short.MAX_VALUE))</span>
<span class="nc" id="L313">                               .addComponent(jPasswordFieldTxt,</span>
                                             GroupLayout.Alignment.LEADING, 0,
                                             341, Short.MAX_VALUE)
<span class="nc" id="L316">                               .addComponent(jTextFieldCryptedPassword,</span>
                                             GroupLayout.Alignment.LEADING, 0,
                                             338, Short.MAX_VALUE))
<span class="nc" id="L319">                           .addContainerGap());</span>
<span class="nc" id="L320">          jPanel1Layout.setVerticalGroup(</span>
<span class="nc" id="L321">              jPanel1Layout.createSequentialGroup().addContainerGap()</span>
<span class="nc" id="L322">                           .addComponent(jTextFieldPasswordFile,</span>
                                         GroupLayout.PREFERRED_SIZE, 28,
<span class="nc" id="L324">                                         GroupLayout.PREFERRED_SIZE).addGap(18)</span>
<span class="nc" id="L325">                           .addComponent(jPasswordFieldTxt,</span>
                                         GroupLayout.PREFERRED_SIZE, 26,
                                         GroupLayout.PREFERRED_SIZE)
<span class="nc" id="L328">                           .addPreferredGap(</span>
                               LayoutStyle.ComponentPlacement.UNRELATED, 1,
                               Short.MAX_VALUE)
<span class="nc" id="L331">                           .addComponent(jTextFieldCryptedPassword,</span>
                                         GroupLayout.PREFERRED_SIZE, 28,
                                         GroupLayout.PREFERRED_SIZE)
<span class="nc" id="L334">                           .addContainerGap());</span>
        } else {
<span class="nc" id="L336">          jPanel1Layout.setHorizontalGroup(</span>
<span class="nc" id="L337">              jPanel1Layout.createSequentialGroup().addContainerGap().addGroup(</span>
<span class="nc" id="L338">                  jPanel1Layout.createParallelGroup().addGroup(</span>
<span class="nc" id="L339">                      jPanel1Layout.createSequentialGroup()</span>
<span class="nc" id="L340">                                   .addComponent(jTextFieldPasswordFile,</span>
                                                 GroupLayout.PREFERRED_SIZE,
                                                 340,
                                                 GroupLayout.PREFERRED_SIZE)
<span class="nc" id="L344">                                   .addGap(0, 0, Short.MAX_VALUE))</span>
<span class="nc" id="L345">                               .addComponent(jPasswordField,</span>
                                             GroupLayout.Alignment.LEADING, 0,
                                             341, Short.MAX_VALUE)
<span class="nc" id="L348">                               .addComponent(jTextFieldCryptedPassword,</span>
                                             GroupLayout.Alignment.LEADING, 0,
                                             338, Short.MAX_VALUE))
<span class="nc" id="L351">                           .addContainerGap());</span>
<span class="nc" id="L352">          jPanel1Layout.setVerticalGroup(</span>
<span class="nc" id="L353">              jPanel1Layout.createSequentialGroup().addContainerGap()</span>
<span class="nc" id="L354">                           .addComponent(jTextFieldPasswordFile,</span>
                                         GroupLayout.PREFERRED_SIZE, 28,
<span class="nc" id="L356">                                         GroupLayout.PREFERRED_SIZE).addGap(18)</span>
<span class="nc" id="L357">                           .addComponent(jPasswordField,</span>
                                         GroupLayout.PREFERRED_SIZE, 26,
                                         GroupLayout.PREFERRED_SIZE)
<span class="nc" id="L360">                           .addPreferredGap(</span>
                               LayoutStyle.ComponentPlacement.UNRELATED, 1,
                               Short.MAX_VALUE)
<span class="nc" id="L363">                           .addComponent(jTextFieldCryptedPassword,</span>
                                         GroupLayout.PREFERRED_SIZE, 28,
                                         GroupLayout.PREFERRED_SIZE)
<span class="nc" id="L366">                           .addContainerGap());</span>
        }
      }
<span class="nc" id="L369">      thisLayout.setVerticalGroup(</span>
<span class="nc" id="L370">          thisLayout.createSequentialGroup().addContainerGap()</span>
<span class="nc" id="L371">                    .addComponent(jTextFieldKeyFile, GroupLayout.PREFERRED_SIZE,</span>
<span class="nc" id="L372">                                  28, GroupLayout.PREFERRED_SIZE).addGap(21)</span>
<span class="nc" id="L373">                    .addComponent(jPanel1, GroupLayout.PREFERRED_SIZE, 143,</span>
                                  GroupLayout.PREFERRED_SIZE)
<span class="nc" id="L375">                    .addContainerGap(31, Short.MAX_VALUE));</span>
<span class="nc" id="L376">      thisLayout.setHorizontalGroup(</span>
<span class="nc" id="L377">          thisLayout.createSequentialGroup().addContainerGap().addGroup(</span>
<span class="nc" id="L378">              thisLayout.createParallelGroup()</span>
<span class="nc" id="L379">                        .addComponent(jPanel1, GroupLayout.Alignment.LEADING, 0,</span>
                                      366, Short.MAX_VALUE)
<span class="nc" id="L381">                        .addGroup(GroupLayout.Alignment.LEADING,</span>
<span class="nc" id="L382">                                  thisLayout.createSequentialGroup().addGap(7)</span>
<span class="nc" id="L383">                                            .addComponent(jTextFieldKeyFile, 0,</span>
                                                          353, Short.MAX_VALUE)
<span class="nc" id="L385">                                            .addGap(6))).addGap(6));</span>
<span class="nc" id="L386">      setSize(400, 300);</span>
      {
<span class="nc" id="L388">        jMenuBar1 = new JMenuBar();</span>
<span class="nc" id="L389">        setJMenuBar(jMenuBar1);</span>
        {
<span class="nc" id="L391">          jMenu3 = new JMenu();</span>
<span class="nc" id="L392">          jMenuBar1.add(jMenu3);</span>
<span class="nc" id="L393">          jMenu3.setText(&quot;File&quot;);</span>
          {
<span class="nc" id="L395">            openFileMenuItem = new JMenuItem();</span>
<span class="nc" id="L396">            jMenu3.add(openFileMenuItem);</span>
<span class="nc" id="L397">            openFileMenuItem.setText(&quot;Open Key&quot;);</span>
<span class="nc" id="L398">            openFileMenuItem.setAction(getOpenKeyAction());</span>
          }
          {
<span class="nc" id="L401">            newFileMenuItem = new JMenuItem();</span>
<span class="nc" id="L402">            jMenu3.add(newFileMenuItem);</span>
<span class="nc" id="L403">            newFileMenuItem.setText(&quot;New Key&quot;);</span>
<span class="nc" id="L404">            newFileMenuItem.setAction(getNewKeyAction());</span>
          }
          {
<span class="nc" id="L407">            saveMenuItem = new JMenuItem();</span>
<span class="nc" id="L408">            jMenu3.add(saveMenuItem);</span>
<span class="nc" id="L409">            saveMenuItem.setText(&quot;Save Key&quot;);</span>
<span class="nc" id="L410">            saveMenuItem.setAction(getSaveKeyAction());</span>
<span class="nc" id="L411">            saveMenuItem.setEnabled(false);</span>
          }
          {
<span class="nc" id="L414">            saveAsMenuItem = new JMenuItem();</span>
<span class="nc" id="L415">            jMenu3.add(saveAsMenuItem);</span>
<span class="nc" id="L416">            saveAsMenuItem.setText(&quot;Save Key As ...&quot;);</span>
<span class="nc" id="L417">            saveAsMenuItem.setAction(getSaveAsKeyAction());</span>
<span class="nc" id="L418">            saveAsMenuItem.setEnabled(false);</span>
          }
          {
<span class="nc" id="L421">            jSeparator2 = new JSeparator();</span>
<span class="nc" id="L422">            jMenu3.add(jSeparator2);</span>
          }
          {
<span class="nc" id="L425">            exitMenuItem = new JMenuItem();</span>
<span class="nc" id="L426">            jMenu3.add(exitMenuItem);</span>
<span class="nc" id="L427">            exitMenuItem.setText(&quot;Exit&quot;);</span>
<span class="nc" id="L428">            exitMenuItem.setAction(getExitAction());</span>
          }
        }
        {
<span class="nc" id="L432">          jMenuPassword = new JMenu();</span>
<span class="nc" id="L433">          jMenuBar1.add(jMenuPassword);</span>
<span class="nc" id="L434">          jMenuPassword.setText(&quot;Password&quot;);</span>
<span class="nc" id="L435">          jMenuPassword.setEnabled(false);</span>
          {
<span class="nc" id="L437">            loadPasswordMenuItem = new JMenuItem();</span>
<span class="nc" id="L438">            jMenuPassword.add(loadPasswordMenuItem);</span>
<span class="nc" id="L439">            loadPasswordMenuItem.setText(&quot;Load&quot;);</span>
<span class="nc" id="L440">            loadPasswordMenuItem.setAction(getLoadPswdAction());</span>
          }
          {
<span class="nc" id="L443">            savePasswordMenuItem = new JMenuItem();</span>
<span class="nc" id="L444">            jMenuPassword.add(savePasswordMenuItem);</span>
<span class="nc" id="L445">            savePasswordMenuItem.setText(&quot;Save&quot;);</span>
<span class="nc" id="L446">            savePasswordMenuItem.setAction(getSavePaswdAction());</span>
          }
        }
        {
<span class="nc" id="L450">          jMenu5 = new JMenu();</span>
<span class="nc" id="L451">          jMenuBar1.add(jMenu5);</span>
<span class="nc" id="L452">          jMenu5.setText(&quot;Help&quot;);</span>
          {
<span class="nc" id="L454">            helpMenuItem = new JMenuItem();</span>
<span class="nc" id="L455">            jMenu5.add(helpMenuItem);</span>
<span class="nc" id="L456">            helpMenuItem.setText(&quot;Help&quot;);</span>
<span class="nc" id="L457">            helpMenuItem.setAction(getHelpAction());</span>
          }
        }
      }
<span class="nc" id="L461">    } catch (final Exception e) {</span>
<span class="nc" id="L462">      SysErrLogger.FAKE_LOGGER.syserr(e);</span>
<span class="nc" id="L463">    }</span>
<span class="nc" id="L464">  }</span>

  private AbstractAction getExitAction() {
<span class="nc bnc" id="L467" title="All 2 branches missed.">    if (exitAction == null) {</span>
<span class="nc" id="L468">      exitAction = new AbstractAction(&quot;Exit&quot;, null) {</span>
        /**
         *
         */
        private static final long serialVersionUID = 7484447837851868127L;

        @Override
        public void actionPerformed(final ActionEvent evt) {
<span class="nc" id="L476">          myself.exit(evt);</span>
<span class="nc" id="L477">        }</span>
      };
    }
<span class="nc" id="L480">    return exitAction;</span>
  }

  private String getUncryptedPassword() {
<span class="nc bnc" id="L484" title="All 2 branches missed.">    if (WaarpPassword.clearPasswordView) {</span>
<span class="nc" id="L485">      return jPasswordFieldTxt.getText();</span>
    } else {
<span class="nc" id="L487">      return new String(jPasswordField.getPassword());</span>
    }
  }

  private void setUncryptedPassword(final String passwd) {
<span class="nc bnc" id="L492" title="All 2 branches missed.">    if (WaarpPassword.clearPasswordView) {</span>
<span class="nc" id="L493">      jPasswordFieldTxt.setText(passwd);</span>
    } else {
<span class="nc" id="L495">      jPasswordField.setText(passwd);</span>
    }
<span class="nc" id="L497">  }</span>

  private void updateCryptedPassword() {
    try {
<span class="nc" id="L501">      waarpPassword.setClearPassword(getUncryptedPassword());</span>
<span class="nc" id="L502">    } catch (final Exception e) {</span>
<span class="nc" id="L503">      SysErrLogger.FAKE_LOGGER.syserr(e);</span>
<span class="nc" id="L504">    }</span>
<span class="nc" id="L505">    jTextFieldCryptedPassword.setText(waarpPassword.getCryptedPassword());</span>
<span class="nc" id="L506">    passwordModified = true;</span>
<span class="nc" id="L507">  }</span>

  private void enableMenuWithKey() {
<span class="nc" id="L510">    saveAsMenuItem.setEnabled(true);</span>
<span class="nc" id="L511">    saveMenuItem.setEnabled(true);</span>
<span class="nc" id="L512">    jMenuPassword.setEnabled(true);</span>
<span class="nc" id="L513">  }</span>

  private AbstractAction getOpenKeyAction() {
<span class="nc bnc" id="L516" title="All 2 branches missed.">    if (openKeyAction == null) {</span>
<span class="nc" id="L517">      openKeyAction = new AbstractAction(&quot;Open Key&quot;, null) {</span>
        /**
         *
         */
        private static final long serialVersionUID = -3840578648343599999L;

        @Override
        public void actionPerformed(final ActionEvent evt) {
<span class="nc" id="L525">          jTextFieldPasswordFile.setText(&quot;&quot;);</span>
<span class="nc" id="L526">          jTextFieldCryptedPassword.setText(&quot;&quot;);</span>
<span class="nc" id="L527">          chooserKeyFile.setDialogType(JFileChooser.OPEN_DIALOG);</span>
<span class="nc" id="L528">          final int response = chooserKeyFile.showOpenDialog(rootPane);</span>
<span class="nc bnc" id="L529" title="All 2 branches missed.">          if (response == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L530">            final File file = chooserKeyFile.getSelectedFile();</span>
<span class="nc" id="L531">            jTextFieldKeyFile.setText(file.getAbsolutePath());</span>
            try {
<span class="nc" id="L533">              waarpPassword.loadKey(file);</span>
<span class="nc" id="L534">              updateCryptedPassword();</span>
<span class="nc" id="L535">              enableMenuWithKey();</span>
<span class="nc" id="L536">            } catch (final CryptoException e) {</span>
<span class="nc" id="L537">              SysErrLogger.FAKE_LOGGER.syserr(e);</span>
<span class="nc" id="L538">            }</span>
          }
<span class="nc" id="L540">        }</span>
      };
    }
<span class="nc" id="L543">    return openKeyAction;</span>
  }

  private AbstractAction getNewKeyAction() {
<span class="nc bnc" id="L547" title="All 2 branches missed.">    if (newKeyAction == null) {</span>
<span class="nc" id="L548">      newKeyAction = new AbstractAction(&quot;New Key&quot;, null) {</span>
        /**
         *
         */
        private static final long serialVersionUID = 10107370851157816L;

        @Override
        public void actionPerformed(final ActionEvent evt) {
          try {
<span class="nc" id="L557">            waarpPassword.createNewKey();</span>
<span class="nc" id="L558">          } catch (final Exception e) {</span>
<span class="nc" id="L559">            SysErrLogger.FAKE_LOGGER.syserr(e);</span>
<span class="nc" id="L560">          }</span>
<span class="nc" id="L561">          updateCryptedPassword();</span>
<span class="nc" id="L562">          enableMenuWithKey();</span>
<span class="nc" id="L563">        }</span>
      };
    }
<span class="nc" id="L566">    return newKeyAction;</span>
  }

  private AbstractAction getSaveKeyAction() {
<span class="nc bnc" id="L570" title="All 2 branches missed.">    if (saveKeyAction == null) {</span>
<span class="nc" id="L571">      saveKeyAction = new AbstractAction(&quot;Save Key&quot;, null) {</span>
        /**
         *
         */
        private static final long serialVersionUID = 4400661431842092244L;

        @Override
        public void actionPerformed(final ActionEvent evt) {
          try {
<span class="nc" id="L580">            waarpPassword.saveKey(null);</span>
<span class="nc" id="L581">          } catch (final CryptoException e) {</span>
<span class="nc" id="L582">            SysErrLogger.FAKE_LOGGER.syserr(e);</span>
<span class="nc" id="L583">          }</span>
<span class="nc" id="L584">          passwordModified = false;</span>
<span class="nc" id="L585">        }</span>
      };
    }
<span class="nc" id="L588">    return saveKeyAction;</span>
  }

  private AbstractAction getSaveAsKeyAction() {
<span class="nc bnc" id="L592" title="All 2 branches missed.">    if (saveAsKeyAction == null) {</span>
<span class="nc" id="L593">      saveAsKeyAction = new AbstractAction(&quot;Save Key As...&quot;, null) {</span>
        /**
         *
         */
        private static final long serialVersionUID = 565842888109816432L;

        @Override
        public void actionPerformed(final ActionEvent evt) {
<span class="nc" id="L601">          chooserKeyFile.setDialogType(JFileChooser.SAVE_DIALOG);</span>
<span class="nc" id="L602">          final int response = chooserKeyFile.showSaveDialog(rootPane);</span>
<span class="nc bnc" id="L603" title="All 2 branches missed.">          if (response == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L604">            File file = chooserKeyFile.getSelectedFile();</span>
<span class="nc bnc" id="L605" title="All 2 branches missed.">            if (!filterKey.accept(file)) {</span>
<span class="nc bnc" id="L606" title="All 2 branches missed.">              if (WaarpPassword.desModel) {</span>
<span class="nc" id="L607">                file = new File(file.getAbsoluteFile() + &quot;.&quot; + Des.EXTENSION);</span>
              } else {
<span class="nc" id="L609">                file =</span>
<span class="nc" id="L610">                    new File(file.getAbsoluteFile() + &quot;.&quot; + Blowfish.EXTENSION);</span>
              }
            }
<span class="nc" id="L613">            jTextFieldKeyFile.setText(file.getAbsolutePath());</span>
            try {
<span class="nc" id="L615">              waarpPassword.saveKey(file);</span>
<span class="nc" id="L616">            } catch (final CryptoException e) {</span>
<span class="nc" id="L617">              SysErrLogger.FAKE_LOGGER.syserr(e);</span>
<span class="nc" id="L618">            }</span>
<span class="nc" id="L619">            passwordModified = false;</span>
          }
<span class="nc" id="L621">        }</span>
      };
    }
<span class="nc" id="L624">    return saveAsKeyAction;</span>
  }

  private AbstractAction getLoadPswdAction() {
<span class="nc bnc" id="L628" title="All 2 branches missed.">    if (loadPswdAction == null) {</span>
<span class="nc" id="L629">      loadPswdAction = new AbstractAction(&quot;Load&quot;, null) {</span>
        /**
         *
         */
        private static final long serialVersionUID = -3100726446117809610L;

        @Override
        public void actionPerformed(final ActionEvent evt) {
<span class="nc" id="L637">          chooserPwdFile.setDialogType(JFileChooser.OPEN_DIALOG);</span>
<span class="nc" id="L638">          final int response = chooserPwdFile.showOpenDialog(rootPane);</span>
<span class="nc bnc" id="L639" title="All 2 branches missed.">          if (response == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L640">            final File file = chooserPwdFile.getSelectedFile();</span>
<span class="nc" id="L641">            jTextFieldPasswordFile.setText(file.getAbsolutePath());</span>
<span class="nc" id="L642">            waarpPassword.setPasswordFile(file);</span>
            try {
<span class="nc" id="L644">              waarpPassword.loadPasswordFile();</span>
<span class="nc" id="L645">            } catch (final CryptoException e) {</span>
<span class="nc" id="L646">              SysErrLogger.FAKE_LOGGER.syserr(e);</span>
<span class="nc" id="L647">            } catch (final Exception e) {</span>
<span class="nc" id="L648">              SysErrLogger.FAKE_LOGGER.syserr(e);</span>
<span class="nc" id="L649">            }</span>
<span class="nc" id="L650">            setUncryptedPassword(waarpPassword.getClearPassword());</span>
<span class="nc" id="L651">            jTextFieldCryptedPassword</span>
<span class="nc" id="L652">                .setText(waarpPassword.getCryptedPassword());</span>
<span class="nc" id="L653">            passwordModified = false;</span>
          }
<span class="nc" id="L655">        }</span>
      };
    }
<span class="nc" id="L658">    return loadPswdAction;</span>
  }

  private AbstractAction getSavePaswdAction() {
<span class="nc bnc" id="L662" title="All 2 branches missed.">    if (savePaswdAction == null) {</span>
<span class="nc" id="L663">      savePaswdAction = new AbstractAction(&quot;Save&quot;, null) {</span>
        /**
         *
         */
        private static final long serialVersionUID = -5712120697650940845L;

        @Override
        public void actionPerformed(final ActionEvent evt) {
<span class="nc" id="L671">          chooserPwdFile.setDialogType(JFileChooser.SAVE_DIALOG);</span>
<span class="nc" id="L672">          final int response = chooserPwdFile.showSaveDialog(rootPane);</span>
<span class="nc bnc" id="L673" title="All 2 branches missed.">          if (response == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L674">            File file = chooserPwdFile.getSelectedFile();</span>
<span class="nc bnc" id="L675" title="All 2 branches missed.">            if (!filterPwdKey.accept(file)) {</span>
<span class="nc" id="L676">              file = new File(</span>
<span class="nc" id="L677">                  file.getAbsoluteFile() + &quot;.&quot; + WaarpPassword.GGPEXTENSION);</span>
            }
<span class="nc" id="L679">            jTextFieldPasswordFile.setText(file.getAbsolutePath());</span>
<span class="nc" id="L680">            waarpPassword.setPasswordFile(file);</span>
            try {
<span class="nc" id="L682">              waarpPassword.savePasswordFile();</span>
<span class="nc" id="L683">            } catch (final IOException e) {</span>
<span class="nc" id="L684">              SysErrLogger.FAKE_LOGGER.syserr(e);</span>
<span class="nc" id="L685">            }</span>
<span class="nc" id="L686">            passwordModified = false;</span>
          }
<span class="nc" id="L688">        }</span>
      };
    }
<span class="nc" id="L691">    return savePaswdAction;</span>
  }

  private AbstractAction getHelpAction() {
<span class="nc bnc" id="L695" title="All 2 branches missed.">    if (helpAction == null) {</span>
<span class="nc" id="L696">      helpAction = new AbstractAction(&quot;Help&quot;, null) {</span>
        /**
         *
         */
        private static final long serialVersionUID = -8528091873190483826L;

        @Override
        public void actionPerformed(final ActionEvent evt) {
<span class="nc" id="L704">          getJDialogHelp().setVisible(true);</span>
<span class="nc" id="L705">        }</span>
      };
    }
<span class="nc" id="L708">    return helpAction;</span>
  }

  private JDialog getJDialogHelp() {
<span class="nc bnc" id="L712" title="All 2 branches missed.">    if (jDialogHelp == null) {</span>
<span class="nc" id="L713">      jDialogHelp = new JDialog(this);</span>
<span class="nc" id="L714">      final GroupLayout jDialogHelpLayout =</span>
<span class="nc" id="L715">          new GroupLayout(jDialogHelp.getContentPane());</span>
<span class="nc" id="L716">      jDialogHelp.getContentPane().setLayout(jDialogHelpLayout);</span>
<span class="nc" id="L717">      jDialogHelp.getContentPane().setBackground(new Color(255, 255, 255));</span>
<span class="nc" id="L718">      jDialogHelp.setPreferredSize(new Dimension(670, 479));</span>
<span class="nc" id="L719">      jDialogHelp.setSize(670, 479);</span>
<span class="nc" id="L720">      jDialogHelpLayout.setHorizontalGroup(</span>
<span class="nc" id="L721">          jDialogHelpLayout.createSequentialGroup().addContainerGap(27, 27)</span>
<span class="nc" id="L722">                           .addGroup(jDialogHelpLayout.createParallelGroup()</span>
<span class="nc" id="L723">                                                      .addComponent(</span>
<span class="nc" id="L724">                                                          getJTextPaneHelp(),</span>
                                                          GroupLayout.Alignment.LEADING,
                                                          0, 604,
                                                          Short.MAX_VALUE)
<span class="nc" id="L728">                                                      .addGroup(</span>
                                                          GroupLayout.Alignment.LEADING,
                                                          jDialogHelpLayout
<span class="nc" id="L731">                                                              .createSequentialGroup()</span>
<span class="nc" id="L732">                                                              .addGap(254)</span>
<span class="nc" id="L733">                                                              .addComponent(</span>
<span class="nc" id="L734">                                                                  getJButtonHelp(),</span>
                                                                  GroupLayout.PREFERRED_SIZE,
                                                                  111,
                                                                  GroupLayout.PREFERRED_SIZE)
<span class="nc" id="L738">                                                              .addGap(0, 239,</span>
                                                                      Short.MAX_VALUE)))
<span class="nc" id="L740">                           .addContainerGap(23, 23));</span>
<span class="nc" id="L741">      jDialogHelpLayout.setVerticalGroup(</span>
<span class="nc" id="L742">          jDialogHelpLayout.createSequentialGroup().addContainerGap()</span>
<span class="nc" id="L743">                           .addComponent(getJTextPaneHelp(), 0, 395,</span>
                                         Short.MAX_VALUE)
<span class="nc" id="L745">                           .addComponent(getJButtonHelp(),</span>
                                         GroupLayout.PREFERRED_SIZE,
                                         GroupLayout.PREFERRED_SIZE,
                                         GroupLayout.PREFERRED_SIZE)
<span class="nc" id="L749">                           .addContainerGap());</span>
    }
<span class="nc" id="L751">    return jDialogHelp;</span>
  }

  private JButton getJButtonHelp() {
<span class="nc bnc" id="L755" title="All 2 branches missed.">    if (jButtonHelp == null) {</span>
<span class="nc" id="L756">      jButtonHelp = new JButton();</span>
<span class="nc" id="L757">      jButtonHelp.setText(&quot;OK&quot;);</span>
<span class="nc" id="L758">      jButtonHelp.setAction(getCloseHelpAction());</span>
    }
<span class="nc" id="L760">    return jButtonHelp;</span>
  }

  private JTextPane getJTextPaneHelp() {
<span class="nc bnc" id="L764" title="All 2 branches missed.">    if (jTextPaneHelp == null) {</span>
<span class="nc" id="L765">      jTextPaneHelp = new JTextPane();</span>
<span class="nc" id="L766">      jTextPaneHelp.setText(&quot;                                            &quot; +</span>
                            &quot;                            GoldenGate GUI Password Tool\r\n\r\n&quot; +
                            &quot;A) Key for crypto support\r\n\r\n&quot; +
                            &quot;* First you need to open a Key File (Open) or to create a &quot; +
                            &quot;New Key File (New Key) and to save it (Save Key As...)\r\n&quot; +
                            &quot;* You can at any moment save the Key File to a new &quot; +
                            &quot;Key File (Save Key As...)\r\n\r\n&quot; +
                            &quot;B) Password with Crypto Key\r\n&quot; +
                            &quot;* Then you need to get a Password:\r\n&quot; +
                            &quot;1) Enter a password in the Password field\r\n&quot; +
                            &quot;2) Load a password from a Password file (compatible with &quot; +
                            &quot;the current Key) (Load)\r\n&quot; +
                            &quot;* Then you need to save this password (encrypted) to &quot; +
                            &quot;a File (Save)\r\n\r\n&quot; + &quot;C) &quot; +
                            WaarpPassword.HELPOPTIONS);
<span class="nc" id="L781">      jTextPaneHelp.setEditable(false);</span>
<span class="nc" id="L782">      jTextPaneHelp.setBackground(new Color(255, 255, 255));</span>
    }
<span class="nc" id="L784">    return jTextPaneHelp;</span>
  }

  private AbstractAction getCloseHelpAction() {
<span class="nc bnc" id="L788" title="All 2 branches missed.">    if (closeHelpAction == null) {</span>
<span class="nc" id="L789">      closeHelpAction = new AbstractAction(&quot;Close&quot;, null) {</span>
        /**
         *
         */
        private static final long serialVersionUID = -2310092372166868386L;

        @Override
        public void actionPerformed(final ActionEvent evt) {
<span class="nc" id="L797">          getJDialogHelp().dispose();</span>
<span class="nc" id="L798">        }</span>
      };
    }
<span class="nc" id="L801">    return closeHelpAction;</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>