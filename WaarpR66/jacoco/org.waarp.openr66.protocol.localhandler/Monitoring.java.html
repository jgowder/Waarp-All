<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Monitoring.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Waarp OpenR66</a> &gt; <a href="index.source.html" class="el_package">org.waarp.openr66.protocol.localhandler</a> &gt; <span class="el_source">Monitoring.java</span></div><h1>Monitoring.java</h1><pre class="source lang-java linenums">/*
 * This file is part of Waarp Project (named also Waarp or GG).
 *
 *  Copyright (c) 2019, Waarp SAS, and individual contributors by the @author
 *  tags. See the COPYRIGHT.txt in the distribution for a full listing of
 * individual contributors.
 *
 *  All Waarp Project is free software: you can redistribute it and/or
 * modify it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or (at your
 * option) any later version.
 *
 * Waarp is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along with
 * Waarp . If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package org.waarp.openr66.protocol.localhandler;

import com.fasterxml.jackson.databind.node.ObjectNode;
import io.netty.handler.traffic.TrafficCounter;
import org.joda.time.DateTime;
import org.waarp.common.database.DbAdmin;
import org.waarp.common.database.DbPreparedStatement;
import org.waarp.common.database.DbSession;
import org.waarp.common.database.data.AbstractDbData.UpdatedInfo;
import org.waarp.common.database.exception.WaarpDatabaseNoConnectionException;
import org.waarp.common.database.exception.WaarpDatabaseSqlException;
import org.waarp.common.json.JsonHandler;
import org.waarp.common.logging.WaarpLogger;
import org.waarp.common.logging.WaarpLoggerFactory;
import org.waarp.openr66.commander.CommanderNoDb;
import org.waarp.openr66.context.ErrorCode;
import org.waarp.openr66.database.data.DbTaskRunner;
import org.waarp.openr66.database.data.DbTaskRunner.TASKSTEP;
import org.waarp.openr66.protocol.configuration.Configuration;
import org.waarp.openr66.protocol.snmp.R66PrivateMib;
import org.waarp.openr66.protocol.utils.ChannelUtils;
import org.waarp.snmp.WaarpSnmpAgent;
import org.waarp.snmp.interf.WaarpInterfaceMonitor;
import org.waarp.snmp.r66.WaarpPrivateMib.MibLevel;
import org.waarp.snmp.r66.WaarpPrivateMib.WaarpDetailedValuesIndex;
import org.waarp.snmp.r66.WaarpPrivateMib.WaarpErrorValuesIndex;
import org.waarp.snmp.r66.WaarpPrivateMib.WaarpGlobalValuesIndex;

import static org.waarp.common.database.DbConstant.*;

/**
 * Monitoring class as an helper to get values of interest. Also used by SNMP
 * support.
 */
public class Monitoring implements WaarpInterfaceMonitor {
  /**
   * Internal Logger
   */
<span class="fc" id="L58">  private static final WaarpLogger logger =</span>
<span class="fc" id="L59">      WaarpLoggerFactory.getLogger(Monitoring.class);</span>

  public WaarpSnmpAgent agent;

  // global informations
  public long nbNetworkConnection;
  public long secondsRunning;
  public long nbThread;
  public long bandwidthIn;
  public long bandwidthOut;

  // Internal data
<span class="fc" id="L71">  private final long startMonitor = System.currentTimeMillis();</span>
  private final long pastLimit;
  private long currentLimit;
  private final long minimalDelay;
  private long lastTry;
  private DbSession dbSession;
<span class="fc" id="L77">  private final TrafficCounter trafficCounter =</span>
<span class="fc" id="L78">      Configuration.configuration.getGlobalTrafficShapingHandler()</span>
<span class="fc" id="L79">                                 .trafficCounter();</span>

  // Overall status including past, future and current transfers
  private DbPreparedStatement countInfo;

  // Current situation of all transfers, running or not
  private DbPreparedStatement countInActiveTransfer;
  private DbPreparedStatement countOutActiveTransfer;
  private DbPreparedStatement countInTotalTransfer;
  private DbPreparedStatement countOutTotalTransfer;
  private DbPreparedStatement countInErrorTransfer;
  private DbPreparedStatement countOutErrorTransfer;
  private DbPreparedStatement countStepAllTransfer;
  private DbPreparedStatement countStepNotask;
  private DbPreparedStatement countStepPretask;
  private DbPreparedStatement countStepTransfer;
  private DbPreparedStatement countStepPosttask;
  private DbPreparedStatement countStepAllDone;
  private DbPreparedStatement countStepError;

  // First on Running Transfers only
  private DbPreparedStatement countAllRunningStep;
  private DbPreparedStatement countRunningStep;
  private DbPreparedStatement countInitOkStep;
  private DbPreparedStatement countPreProcessingOkStep;
  private DbPreparedStatement countTransferOkStep;
  private DbPreparedStatement countPostProcessingOkStep;
  private DbPreparedStatement countCompleteOkStep;

  // Error Status on all transfers
  private DbPreparedStatement countStatus;

  // Overall status including past, future and current transfers
  public long nbCountInfoUnknown;
  public long nbCountInfoNotUpdated;
  public long nbCountInfoInterrupted;
  public long nbCountInfoToSubmit;
  public long nbCountInfoError;
  public long nbCountInfoRunning;
  public long nbCountInfoDone;

  public long nbInActiveTransfer;
  public long nbOutActiveTransfer;
<span class="fc" id="L122">  public long lastInActiveTransfer = System.currentTimeMillis();</span>
<span class="fc" id="L123">  public long lastOutActiveTransfer = System.currentTimeMillis();</span>
  public long nbInTotalTransfer;
  public long nbOutTotalTransfer;
  public long nbInErrorTransfer;
  public long nbOutErrorTransfer;

  // Current situation of all transfers, running or not
  public long nbCountStepAllTransfer;
  public long nbCountStepNotask;
  public long nbCountStepPretask;
  public long nbCountStepTransfer;
  public long nbCountStepPosttask;
  public long nbCountStepAllDone;
  public long nbCountStepError;

  // First on Running Transfers only
  public long nbCountAllRunningStep;
  public long nbCountRunningStep;
  public long nbCountInitOkStep;
  public long nbCountPreProcessingOkStep;
  public long nbCountTransferOkStep;
  public long nbCountPostProcessingOkStep;
  public long nbCountCompleteOkStep;

  // Error Status on all transfers
  public long nbCountStatusConnectionImpossible;
  public long nbCountStatusServerOverloaded;
  public long nbCountStatusBadAuthent;
  public long nbCountStatusExternalOp;
  public long nbCountStatusTransferError;
  public long nbCountStatusMD5Error;
  public long nbCountStatusDisconnection;
  public long nbCountStatusFinalOp;
  public long nbCountStatusUnimplemented;
  public long nbCountStatusInternal;
  public long nbCountStatusWarning;
  public long nbCountStatusQueryAlreadyFinished;
  public long nbCountStatusQueryStillRunning;
  public long nbCountStatusNotKnownHost;
  public long nbCountStatusQueryRemotelyUnknown;
  public long nbCountStatusCommandNotFound;
  public long nbCountStatusPassThroughMode;
  public long nbCountStatusRemoteShutdown;
  public long nbCountStatusShutdown;
  public long nbCountStatusRemoteError;
  public long nbCountStatusStopped;
  public long nbCountStatusCanceled;
  public long nbCountStatusFileNotFound;
  public long nbCountStatusUnknown;

  /**
   * @param pastLimit
   * @param minimalDelay
   * @param session
   */
  public Monitoring(final long pastLimit, final long minimalDelay,
<span class="fc" id="L179">                    final DbSession session) {</span>
<span class="fc" id="L180">    this.pastLimit = pastLimit;</span>
<span class="fc" id="L181">    this.minimalDelay = minimalDelay;</span>
<span class="pc bpc" id="L182" title="1 of 2 branches missed.">    if (session != null) {</span>
<span class="nc" id="L183">      dbSession = session;</span>
    } else {
      try {
<span class="fc" id="L186">        dbSession = new DbSession(admin, false);</span>
<span class="fc" id="L187">      } catch (final WaarpDatabaseNoConnectionException e) {</span>
<span class="fc" id="L188">        dbSession = admin.getSession();</span>
<span class="fc" id="L189">      }</span>
    }
<span class="fc" id="L191">    initialize();</span>
<span class="fc" id="L192">  }</span>

  /**
   * Initialize the Db Requests after constructor or after use of
   * releaseResources
   */
  @Override
  public final void initialize() {
<span class="pc bpc" id="L200" title="1 of 4 branches missed.">    if (dbSession == null || dbSession.isDisActive()) {</span>
<span class="fc" id="L201">      logger.warn(&quot;Cannot Initialize monitoring&quot;);</span>
<span class="fc" id="L202">      return;</span>
    }
    try {
<span class="fc" id="L205">      logger.debug(&quot;Initialize monitoring&quot;);</span>
      // Overall status including past, future and current transfers
<span class="fc" id="L207">      countInfo = DbTaskRunner.getCountInfoPrepareStatement(dbSession);</span>
      // Count of Active/All In/Out transfers
<span class="fc" id="L209">      countInActiveTransfer =</span>
<span class="fc" id="L210">          DbTaskRunner.getCountInOutRunningPrepareStatement(dbSession, true,</span>
                                                            true);
<span class="fc" id="L212">      countOutActiveTransfer =</span>
<span class="fc" id="L213">          DbTaskRunner.getCountInOutRunningPrepareStatement(dbSession, false,</span>
                                                            true);
<span class="fc" id="L215">      countInTotalTransfer =</span>
<span class="fc" id="L216">          DbTaskRunner.getCountInOutRunningPrepareStatement(dbSession, true,</span>
                                                            false);
<span class="fc" id="L218">      countOutTotalTransfer =</span>
<span class="fc" id="L219">          DbTaskRunner.getCountInOutRunningPrepareStatement(dbSession, false,</span>
                                                            false);

<span class="fc" id="L222">      countInErrorTransfer =</span>
<span class="fc" id="L223">          DbTaskRunner.getCountInOutErrorPrepareStatement(dbSession, true);</span>
<span class="fc" id="L224">      countOutErrorTransfer =</span>
<span class="fc" id="L225">          DbTaskRunner.getCountInOutErrorPrepareStatement(dbSession, false);</span>

      // Current situation of all transfers, running or not
<span class="fc" id="L228">      countStepAllTransfer =</span>
<span class="fc" id="L229">          DbTaskRunner.getCountStepPrepareStatement(dbSession, null);</span>
<span class="fc" id="L230">      countStepNotask =</span>
<span class="fc" id="L231">          DbTaskRunner.getCountStepPrepareStatement(dbSession, TASKSTEP.NOTASK);</span>
<span class="fc" id="L232">      countStepPretask = DbTaskRunner.getCountStepPrepareStatement(dbSession,</span>
                                                                   TASKSTEP.PRETASK);
<span class="fc" id="L234">      countStepTransfer = DbTaskRunner.getCountStepPrepareStatement(dbSession,</span>
                                                                    TASKSTEP.TRANSFERTASK);
<span class="fc" id="L236">      countStepPosttask = DbTaskRunner.getCountStepPrepareStatement(dbSession,</span>
                                                                    TASKSTEP.POSTTASK);
<span class="fc" id="L238">      countStepAllDone = DbTaskRunner.getCountStepPrepareStatement(dbSession,</span>
                                                                   TASKSTEP.ALLDONETASK);
<span class="fc" id="L240">      countStepError = DbTaskRunner.getCountStepPrepareStatement(dbSession,</span>
                                                                 TASKSTEP.ERRORTASK);

      // First on Running Transfers only
<span class="fc" id="L244">      countAllRunningStep =</span>
<span class="fc" id="L245">          DbTaskRunner.getCountStatusRunningPrepareStatement(dbSession, null);</span>
<span class="fc" id="L246">      countRunningStep =</span>
<span class="fc" id="L247">          DbTaskRunner.getCountStatusRunningPrepareStatement(dbSession,</span>
                                                             ErrorCode.Running);
<span class="fc" id="L249">      countInitOkStep =</span>
<span class="fc" id="L250">          DbTaskRunner.getCountStatusRunningPrepareStatement(dbSession,</span>
                                                             ErrorCode.InitOk);
<span class="fc" id="L252">      countPreProcessingOkStep =</span>
<span class="fc" id="L253">          DbTaskRunner.getCountStatusRunningPrepareStatement(dbSession,</span>
                                                             ErrorCode.PreProcessingOk);
<span class="fc" id="L255">      countTransferOkStep =</span>
<span class="fc" id="L256">          DbTaskRunner.getCountStatusRunningPrepareStatement(dbSession,</span>
                                                             ErrorCode.TransferOk);
<span class="fc" id="L258">      countPostProcessingOkStep =</span>
<span class="fc" id="L259">          DbTaskRunner.getCountStatusRunningPrepareStatement(dbSession,</span>
                                                             ErrorCode.PostProcessingOk);
<span class="fc" id="L261">      countCompleteOkStep =</span>
<span class="fc" id="L262">          DbTaskRunner.getCountStatusRunningPrepareStatement(dbSession,</span>
                                                             ErrorCode.CompleteOk);

      // Error Status on all transfers
<span class="fc" id="L266">      countStatus = DbTaskRunner.getCountStatusPrepareStatement(dbSession);</span>
<span class="nc" id="L267">    } catch (final WaarpDatabaseNoConnectionException ignored) {</span>
      // ignore
<span class="nc" id="L269">    } catch (final WaarpDatabaseSqlException ignored) {</span>
      // ignore
<span class="pc" id="L271">    }</span>
<span class="fc" id="L272">  }</span>

  /**
   * Release all Db Requests
   */
  @Override
  public final void releaseResources() {
<span class="pc bpc" id="L279" title="1 of 4 branches missed.">    if (dbSession == null || dbSession.isDisActive()) {</span>
<span class="fc" id="L280">      return;</span>
    }
    try {
<span class="fc" id="L283">      logger.debug(&quot;Release monitoring&quot;);</span>
      // Overall status including past, future and current transfers
<span class="fc" id="L285">      countInfo.realClose();</span>

<span class="fc" id="L287">      countInActiveTransfer.realClose();</span>
<span class="fc" id="L288">      countOutActiveTransfer.realClose();</span>
<span class="fc" id="L289">      countInTotalTransfer.realClose();</span>
<span class="fc" id="L290">      countOutTotalTransfer.realClose();</span>
<span class="fc" id="L291">      countInErrorTransfer.realClose();</span>
<span class="fc" id="L292">      countOutErrorTransfer.realClose();</span>

      // Current situation of all transfers, running or not
<span class="fc" id="L295">      countStepAllTransfer.realClose();</span>
<span class="fc" id="L296">      countStepNotask.realClose();</span>
<span class="fc" id="L297">      countStepPretask.realClose();</span>
<span class="fc" id="L298">      countStepTransfer.realClose();</span>
<span class="fc" id="L299">      countStepPosttask.realClose();</span>
<span class="fc" id="L300">      countStepAllDone.realClose();</span>
<span class="fc" id="L301">      countStepError.realClose();</span>

      // First on Running Transfers only
<span class="fc" id="L304">      countAllRunningStep.realClose();</span>
<span class="fc" id="L305">      countRunningStep.realClose();</span>
<span class="fc" id="L306">      countInitOkStep.realClose();</span>
<span class="fc" id="L307">      countPreProcessingOkStep.realClose();</span>
<span class="fc" id="L308">      countTransferOkStep.realClose();</span>
<span class="fc" id="L309">      countPostProcessingOkStep.realClose();</span>
<span class="fc" id="L310">      countCompleteOkStep.realClose();</span>

      // Error Status on all transfers
<span class="fc" id="L313">      countStatus.realClose();</span>
<span class="nc" id="L314">    } catch (final Exception ignored) {</span>
      // nothing
<span class="fc" id="L316">    }</span>
<span class="pc bpc" id="L317" title="1 of 2 branches missed.">    if (!dbSession.equals(admin.getSession())) {</span>
<span class="pc bpc" id="L318" title="1 of 2 branches missed.">      if (DbAdmin.getNbConnection() &gt; 0) {</span>
<span class="nc" id="L319">        dbSession.forceDisconnect();</span>
      }
<span class="fc" id="L321">      dbSession = null;</span>
    }
<span class="fc" id="L323">  }</span>

  /**
   * @return the last Time in ms of the execution
   */
  public final long lastRunTimeMs() {
<span class="nc" id="L329">    return lastTry;</span>
  }

  /**
   * Default execution of testing with default pastLimit
   */
  public final void run() {
<span class="nc" id="L336">    run(-1, false);</span>
<span class="nc" id="L337">  }</span>

  /**
   * @param nbSecond as specific PastLimit
   */
  public final void run(final long nbSecond) {
<span class="nc" id="L343">    run(nbSecond, false);</span>
<span class="nc" id="L344">  }</span>

  /**
   * Default execution of testing with default pastLimit
   *
   * @param detail as to get detailed information
   */
  public final void run(final boolean detail) {
<span class="nc" id="L352">    run(-1, detail);</span>
<span class="nc" id="L353">  }</span>

  /**
   * @return False if too early, else return True
   */
  private boolean reCompute() {
<span class="fc" id="L359">    final long limitDate = System.currentTimeMillis();</span>
<span class="fc bfc" id="L360" title="All 2 branches covered.">    if (limitDate &lt; lastTry + minimalDelay) {</span>
      // too early
<span class="fc" id="L362">      return false;</span>
    }
<span class="fc" id="L364">    lastTry = limitDate;</span>
<span class="fc" id="L365">    return true;</span>
  }

  /**
   * @param nbSecond as specific PastLimit
   * @param detail as to get detailed information
   */
  public final void run(final long nbSecond, final boolean detail) {
<span class="fc" id="L373">    synchronized (trafficCounter) {</span>
<span class="fc" id="L374">      long limitDate = System.currentTimeMillis();</span>
      final long nbMs;
<span class="fc bfc" id="L376" title="All 2 branches covered.">      if (nbSecond &lt;= 0) {</span>
<span class="fc" id="L377">        nbMs = pastLimit;</span>
      } else {
<span class="fc" id="L379">        nbMs = nbSecond * 1000;</span>
      }
<span class="pc bpc" id="L381" title="2 of 4 branches missed.">      if (dbSession != null &amp;&amp; dbSession.isDisActive()) {</span>
<span class="nc" id="L382">        dbSession.checkConnectionNoException();</span>
      }
<span class="pc bpc" id="L384" title="2 of 4 branches missed.">      if (dbSession == null || dbSession.isDisActive()) {</span>
<span class="nc" id="L385">        nbNetworkConnection =</span>
<span class="nc" id="L386">            ChannelUtils.nbCommandChannels(Configuration.configuration);</span>
<span class="nc" id="L387">        bandwidthIn = trafficCounter.lastReadThroughput() &gt;&gt; 7;// B/s -&gt; Kb/s</span>
<span class="nc" id="L388">        bandwidthOut = trafficCounter.lastWriteThroughput() &gt;&gt; 7;</span>
<span class="nc" id="L389">        nbThread = Thread.activeCount();</span>
<span class="nc" id="L390">        secondsRunning = (limitDate - startMonitor) / 1000;</span>

<span class="nc bnc" id="L392" title="All 2 branches missed.">        if (!reCompute()) {</span>
          // too early
<span class="nc" id="L394">          return;</span>
        }
<span class="nc" id="L396">        limitDate -= nbMs;</span>
<span class="nc" id="L397">        currentLimit = limitDate;</span>
        // Update value
        // Overall status including past, future and current transfers
<span class="nc" id="L400">        nbCountInfoToSubmit = CommanderNoDb.todoList.size();</span>
<span class="nc bnc" id="L401" title="All 2 branches missed.">        if (Configuration.configuration.getInternalRunner() != null) {</span>
<span class="nc" id="L402">          nbCountInfoRunning = Configuration.configuration.getInternalRunner()</span>
<span class="nc" id="L403">                                                          .nbInternalRunner();</span>
        } else {
<span class="nc bnc" id="L405" title="All 2 branches missed.">          if (Configuration.configuration.getServerConnectedChannelGroup() !=</span>
              null) {
<span class="nc" id="L407">            nbCountInfoRunning =</span>
<span class="nc" id="L408">                Configuration.configuration.getServerConnectedChannelGroup()</span>
<span class="nc" id="L409">                                           .size();</span>
          } else {
<span class="nc" id="L411">            nbCountInfoRunning =</span>
<span class="nc" id="L412">                Configuration.configuration.getServerChannelGroup().size();</span>
          }
        }
        // Current situation of all transfers, running or not
<span class="nc" id="L416">        nbCountAllRunningStep = nbCountInfoRunning;</span>
      } else {
<span class="fc" id="L418">        nbNetworkConnection = DbAdmin.getNbConnection();</span>
<span class="fc" id="L419">        bandwidthIn = trafficCounter.lastReadThroughput() &gt;&gt; 7;// B/s -&gt; Kb/s</span>
<span class="fc" id="L420">        bandwidthOut = trafficCounter.lastWriteThroughput() &gt;&gt; 7;</span>
<span class="fc" id="L421">        nbThread = Thread.activeCount();</span>
<span class="fc" id="L422">        secondsRunning = (limitDate - startMonitor) / 1000;</span>

<span class="fc bfc" id="L424" title="All 2 branches covered.">        if (!reCompute()) {</span>
          // too early
<span class="fc" id="L426">          return;</span>
        }
<span class="fc" id="L428">        limitDate -= nbMs;</span>
<span class="fc" id="L429">        currentLimit = limitDate;</span>
        // Update value
        try {
          // Overall status including past, future and current transfers
<span class="fc" id="L433">          nbCountInfoUnknown =</span>
<span class="fc" id="L434">              DbTaskRunner.getResultCountPrepareStatement(countInfo,</span>
                                                          UpdatedInfo.UNKNOWN,
                                                          limitDate);
<span class="fc" id="L437">          nbCountInfoNotUpdated =</span>
<span class="fc" id="L438">              DbTaskRunner.getResultCountPrepareStatement(countInfo,</span>
                                                          UpdatedInfo.NOTUPDATED,
                                                          limitDate);
<span class="fc" id="L441">          nbCountInfoInterrupted =</span>
<span class="fc" id="L442">              DbTaskRunner.getResultCountPrepareStatement(countInfo,</span>
                                                          UpdatedInfo.INTERRUPTED,
                                                          limitDate);
<span class="fc" id="L445">          nbCountInfoToSubmit =</span>
<span class="fc" id="L446">              DbTaskRunner.getResultCountPrepareStatement(countInfo,</span>
                                                          UpdatedInfo.TOSUBMIT,
                                                          limitDate);
<span class="fc" id="L449">          nbCountInfoError =</span>
<span class="fc" id="L450">              DbTaskRunner.getResultCountPrepareStatement(countInfo,</span>
                                                          UpdatedInfo.INERROR,
                                                          limitDate);
<span class="fc" id="L453">          nbCountInfoRunning =</span>
<span class="fc" id="L454">              DbTaskRunner.getResultCountPrepareStatement(countInfo,</span>
                                                          UpdatedInfo.RUNNING,
                                                          limitDate);
<span class="fc" id="L457">          nbCountInfoDone =</span>
<span class="fc" id="L458">              DbTaskRunner.getResultCountPrepareStatement(countInfo,</span>
                                                          UpdatedInfo.DONE,
                                                          limitDate);

          // Current situation of all transfers, running or not
<span class="fc" id="L463">          DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
              countInActiveTransfer, limitDate);
<span class="fc" id="L465">          nbInActiveTransfer = DbTaskRunner.getResultCountPrepareStatement(</span>
              countInActiveTransfer);
<span class="fc" id="L467">          DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
              countOutActiveTransfer, limitDate);
<span class="fc" id="L469">          nbOutActiveTransfer = DbTaskRunner.getResultCountPrepareStatement(</span>
              countOutActiveTransfer);
<span class="fc" id="L471">          DbTaskRunner.finishSelectOrCountPrepareStatement(countInTotalTransfer,</span>
                                                           limitDate);
<span class="fc" id="L473">          nbInTotalTransfer =</span>
<span class="fc" id="L474">              DbTaskRunner.getResultCountPrepareStatement(countInTotalTransfer);</span>
<span class="fc" id="L475">          DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
              countOutTotalTransfer, limitDate);
<span class="fc" id="L477">          nbOutTotalTransfer = DbTaskRunner.getResultCountPrepareStatement(</span>
              countOutTotalTransfer);

<span class="fc" id="L480">          DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
              countOutErrorTransfer, limitDate);
<span class="fc" id="L482">          nbOutErrorTransfer = DbTaskRunner.getResultCountPrepareStatement(</span>
              countOutErrorTransfer);
<span class="fc" id="L484">          DbTaskRunner.finishSelectOrCountPrepareStatement(countInErrorTransfer,</span>
                                                           limitDate);
<span class="fc" id="L486">          nbInErrorTransfer =</span>
<span class="fc" id="L487">              DbTaskRunner.getResultCountPrepareStatement(countInErrorTransfer);</span>

<span class="fc" id="L489">          DbTaskRunner.finishSelectOrCountPrepareStatement(countStepAllTransfer,</span>
                                                           limitDate);
<span class="fc" id="L491">          nbCountStepAllTransfer =</span>
<span class="fc" id="L492">              DbTaskRunner.getResultCountPrepareStatement(countStepAllTransfer);</span>
<span class="fc" id="L493">          DbTaskRunner.finishSelectOrCountPrepareStatement(countStepNotask,</span>
                                                           limitDate);
<span class="fc" id="L495">          nbCountStepNotask =</span>
<span class="fc" id="L496">              DbTaskRunner.getResultCountPrepareStatement(countStepNotask);</span>
<span class="fc" id="L497">          DbTaskRunner.finishSelectOrCountPrepareStatement(countStepPretask,</span>
                                                           limitDate);
<span class="fc" id="L499">          nbCountStepPretask =</span>
<span class="fc" id="L500">              DbTaskRunner.getResultCountPrepareStatement(countStepPretask);</span>
<span class="fc" id="L501">          DbTaskRunner.finishSelectOrCountPrepareStatement(countStepTransfer,</span>
                                                           limitDate);
<span class="fc" id="L503">          nbCountStepTransfer =</span>
<span class="fc" id="L504">              DbTaskRunner.getResultCountPrepareStatement(countStepTransfer);</span>
<span class="fc" id="L505">          DbTaskRunner.finishSelectOrCountPrepareStatement(countStepPosttask,</span>
                                                           limitDate);
<span class="fc" id="L507">          nbCountStepPosttask =</span>
<span class="fc" id="L508">              DbTaskRunner.getResultCountPrepareStatement(countStepPosttask);</span>
<span class="fc" id="L509">          DbTaskRunner.finishSelectOrCountPrepareStatement(countStepAllDone,</span>
                                                           limitDate);
<span class="fc" id="L511">          nbCountStepAllDone =</span>
<span class="fc" id="L512">              DbTaskRunner.getResultCountPrepareStatement(countStepAllDone);</span>
<span class="fc" id="L513">          DbTaskRunner.finishSelectOrCountPrepareStatement(countStepError,</span>
                                                           limitDate);
<span class="fc" id="L515">          nbCountStepError =</span>
<span class="fc" id="L516">              DbTaskRunner.getResultCountPrepareStatement(countStepError);</span>

<span class="fc" id="L518">          DbTaskRunner.finishSelectOrCountPrepareStatement(countAllRunningStep,</span>
                                                           limitDate);
<span class="fc" id="L520">          nbCountAllRunningStep =</span>
<span class="fc" id="L521">              DbTaskRunner.getResultCountPrepareStatement(countAllRunningStep);</span>

<span class="fc bfc" id="L523" title="All 2 branches covered.">          if (detail) {</span>
            // First on Running Transfers only
<span class="fc" id="L525">            DbTaskRunner.finishSelectOrCountPrepareStatement(countRunningStep,</span>
                                                             limitDate);
<span class="fc" id="L527">            nbCountRunningStep =</span>
<span class="fc" id="L528">                DbTaskRunner.getResultCountPrepareStatement(countRunningStep);</span>
<span class="fc" id="L529">            DbTaskRunner.finishSelectOrCountPrepareStatement(countInitOkStep,</span>
                                                             limitDate);
<span class="fc" id="L531">            nbCountInitOkStep =</span>
<span class="fc" id="L532">                DbTaskRunner.getResultCountPrepareStatement(countInitOkStep);</span>
<span class="fc" id="L533">            DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
                countPreProcessingOkStep, limitDate);
<span class="fc" id="L535">            nbCountPreProcessingOkStep =</span>
<span class="fc" id="L536">                DbTaskRunner.getResultCountPrepareStatement(</span>
                    countPreProcessingOkStep);
<span class="fc" id="L538">            DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
                countTransferOkStep, limitDate);
<span class="fc" id="L540">            nbCountTransferOkStep = DbTaskRunner.getResultCountPrepareStatement(</span>
                countTransferOkStep);
<span class="fc" id="L542">            DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
                countPostProcessingOkStep, limitDate);
<span class="fc" id="L544">            nbCountPostProcessingOkStep =</span>
<span class="fc" id="L545">                DbTaskRunner.getResultCountPrepareStatement(</span>
                    countPostProcessingOkStep);
<span class="fc" id="L547">            DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
                countCompleteOkStep, limitDate);
<span class="fc" id="L549">            nbCountCompleteOkStep = DbTaskRunner.getResultCountPrepareStatement(</span>
                countCompleteOkStep);

            // Error Status on all transfers
<span class="fc" id="L553">            nbCountStatusConnectionImpossible =</span>
<span class="fc" id="L554">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.ConnectionImpossible,
                                                            limitDate);
<span class="fc" id="L557">            nbCountStatusServerOverloaded =</span>
<span class="fc" id="L558">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.ServerOverloaded,
                                                            limitDate);
<span class="fc" id="L561">            nbCountStatusBadAuthent =</span>
<span class="fc" id="L562">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.BadAuthent,
                                                            limitDate);
<span class="fc" id="L565">            nbCountStatusExternalOp =</span>
<span class="fc" id="L566">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.ExternalOp,
                                                            limitDate);
<span class="fc" id="L569">            nbCountStatusTransferError =</span>
<span class="fc" id="L570">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.TransferError,
                                                            limitDate);
<span class="fc" id="L573">            nbCountStatusMD5Error =</span>
<span class="fc" id="L574">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.MD5Error,
                                                            limitDate);
<span class="fc" id="L577">            nbCountStatusDisconnection =</span>
<span class="fc" id="L578">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.Disconnection,
                                                            limitDate);
<span class="fc" id="L581">            nbCountStatusFinalOp =</span>
<span class="fc" id="L582">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.FinalOp,
                                                            limitDate);
<span class="fc" id="L585">            nbCountStatusUnimplemented =</span>
<span class="fc" id="L586">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.Unimplemented,
                                                            limitDate);
<span class="fc" id="L589">            nbCountStatusInternal =</span>
<span class="fc" id="L590">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.Internal,
                                                            limitDate);
<span class="fc" id="L593">            nbCountStatusWarning =</span>
<span class="fc" id="L594">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.Warning,
                                                            limitDate);
<span class="fc" id="L597">            nbCountStatusQueryAlreadyFinished =</span>
<span class="fc" id="L598">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.QueryAlreadyFinished,
                                                            limitDate);
<span class="fc" id="L601">            nbCountStatusQueryStillRunning =</span>
<span class="fc" id="L602">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.QueryStillRunning,
                                                            limitDate);
<span class="fc" id="L605">            nbCountStatusNotKnownHost =</span>
<span class="fc" id="L606">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.NotKnownHost,
                                                            limitDate);
<span class="fc" id="L609">            nbCountStatusQueryRemotelyUnknown =</span>
<span class="fc" id="L610">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.QueryRemotelyUnknown,
                                                            limitDate);
<span class="fc" id="L613">            nbCountStatusCommandNotFound =</span>
<span class="fc" id="L614">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.CommandNotFound,
                                                            limitDate);
<span class="fc" id="L617">            nbCountStatusPassThroughMode =</span>
<span class="fc" id="L618">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.PassThroughMode,
                                                            limitDate);
<span class="fc" id="L621">            nbCountStatusRemoteShutdown =</span>
<span class="fc" id="L622">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.RemoteShutdown,
                                                            limitDate);
<span class="fc" id="L625">            nbCountStatusShutdown =</span>
<span class="fc" id="L626">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.Shutdown,
                                                            limitDate);
<span class="fc" id="L629">            nbCountStatusRemoteError =</span>
<span class="fc" id="L630">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.RemoteError,
                                                            limitDate);
<span class="fc" id="L633">            nbCountStatusStopped =</span>
<span class="fc" id="L634">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.StoppedTransfer,
                                                            limitDate);
<span class="fc" id="L637">            nbCountStatusCanceled =</span>
<span class="fc" id="L638">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.CanceledTransfer,
                                                            limitDate);
<span class="fc" id="L641">            nbCountStatusFileNotFound =</span>
<span class="fc" id="L642">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.FileNotFound,
                                                            limitDate);
<span class="fc" id="L645">            nbCountStatusUnknown =</span>
<span class="fc" id="L646">                DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                            ErrorCode.Unknown,
                                                            limitDate);
          }
<span class="nc" id="L650">        } catch (final WaarpDatabaseNoConnectionException ignored) {</span>
          // ignore
<span class="nc" id="L652">        } catch (final WaarpDatabaseSqlException ignored) {</span>
          // ignore
<span class="pc" id="L654">        }</span>
      }
<span class="fc" id="L656">    }</span>
<span class="fc" id="L657">  }</span>

  /**
   * @param detail
   *
   * @return The XML representation of the current status
   */
  public final String exportXml(final boolean detail) {
<span class="fc" id="L665">    final StringBuilder builder = new StringBuilder(&quot;&lt;STATUS&gt;&quot;)</span>
        // Global Informations
<span class="fc" id="L667">        .append(&quot;&lt;HostID&gt;&quot;).append(Configuration.configuration.getHostId())</span>
<span class="fc" id="L668">        .append(&quot;&lt;/HostID&gt;&quot;).append(&quot;&lt;Date&gt;&quot;).append(new DateTime())</span>
<span class="fc" id="L669">        .append(&quot;&lt;/Date&gt;&quot;).append(&quot;&lt;LastRun&gt;&quot;).append(new DateTime(lastTry))</span>
<span class="fc" id="L670">        .append(&quot;&lt;/LastRun&gt;&quot;).append(&quot;&lt;FromDate&gt;&quot;)</span>
<span class="fc" id="L671">        .append(new DateTime(currentLimit)).append(&quot;&lt;/FromDate&gt;&quot;)</span>
<span class="fc" id="L672">        .append(&quot;&lt;SecondsRunning&gt;&quot;).append(secondsRunning)</span>
<span class="fc" id="L673">        .append(&quot;&lt;/SecondsRunning&gt;&quot;).append(&quot;&lt;NetworkConnections&gt;&quot;)</span>
<span class="fc" id="L674">        .append(nbNetworkConnection).append(&quot;&lt;/NetworkConnections&gt;&quot;)</span>
<span class="fc" id="L675">        .append(&quot;&lt;NbThreads&gt;&quot;).append(nbThread).append(&quot;&lt;/NbThreads&gt;&quot;)</span>
<span class="fc" id="L676">        .append(&quot;&lt;InBandwidth&gt;&quot;).append(bandwidthIn).append(&quot;&lt;/InBandwidth&gt;&quot;)</span>
<span class="fc" id="L677">        .append(&quot;&lt;OutBandwidth&gt;&quot;).append(bandwidthOut).append(&quot;&lt;/OutBandwidth&gt;&quot;)</span>

        // Overall status including past, future and current transfers
<span class="fc" id="L680">        .append(&quot;&lt;OVERALL&gt;&quot;).append(&quot;&lt;AllTransfer&gt;&quot;)</span>
<span class="fc" id="L681">        .append(nbCountStepAllTransfer).append(&quot;&lt;/AllTransfer&gt;&quot;)</span>
<span class="fc" id="L682">        .append(&quot;&lt;Unknown&gt;&quot;).append(nbCountInfoUnknown).append(&quot;&lt;/Unknown&gt;&quot;)</span>
<span class="fc" id="L683">        .append(&quot;&lt;NotUpdated&gt;&quot;).append(nbCountInfoNotUpdated)</span>
<span class="fc" id="L684">        .append(&quot;&lt;/NotUpdated&gt;&quot;).append(&quot;&lt;Interrupted&gt;&quot;)</span>
<span class="fc" id="L685">        .append(nbCountInfoInterrupted).append(&quot;&lt;/Interrupted&gt;&quot;)</span>
<span class="fc" id="L686">        .append(&quot;&lt;ToSubmit&gt;&quot;).append(nbCountInfoToSubmit).append(&quot;&lt;/ToSubmit&gt;&quot;)</span>
<span class="fc" id="L687">        .append(&quot;&lt;Error&gt;&quot;).append(nbCountInfoError).append(&quot;&lt;/Error&gt;&quot;)</span>
<span class="fc" id="L688">        .append(&quot;&lt;Running&gt;&quot;).append(nbCountInfoRunning).append(&quot;&lt;/Running&gt;&quot;)</span>
<span class="fc" id="L689">        .append(&quot;&lt;Done&gt;&quot;).append(nbCountInfoDone).append(&quot;&lt;/Done&gt;&quot;)</span>
<span class="fc" id="L690">        .append(&quot;&lt;InRunning&gt;&quot;).append(nbInActiveTransfer).append(&quot;&lt;/InRunning&gt;&quot;)</span>
<span class="fc" id="L691">        .append(&quot;&lt;OutRunning&gt;&quot;).append(nbOutActiveTransfer)</span>
<span class="fc" id="L692">        .append(&quot;&lt;/OutRunning&gt;&quot;).append(&quot;&lt;LastInRunning&gt;&quot;)</span>
<span class="fc" id="L693">        .append(new DateTime(lastInActiveTransfer)).append(&quot;&lt;/LastInRunning&gt;&quot;)</span>
<span class="fc" id="L694">        .append(&quot;&lt;LastOutRunning&gt;&quot;).append(new DateTime(lastOutActiveTransfer))</span>
<span class="fc" id="L695">        .append(&quot;&lt;/LastOutRunning&gt;&quot;).append(&quot;&lt;InAll&gt;&quot;).append(nbInTotalTransfer)</span>
<span class="fc" id="L696">        .append(&quot;&lt;/InAll&gt;&quot;).append(&quot;&lt;OutAll&gt;&quot;).append(nbOutTotalTransfer)</span>
<span class="fc" id="L697">        .append(&quot;&lt;/OutAll&gt;&quot;).append(&quot;&lt;InError&gt;&quot;).append(nbInErrorTransfer)</span>
<span class="fc" id="L698">        .append(&quot;&lt;/InError&gt;&quot;).append(&quot;&lt;OutError&gt;&quot;).append(nbOutErrorTransfer)</span>
<span class="fc" id="L699">        .append(&quot;&lt;/OutError&gt;&quot;).append(&quot;&lt;/OVERALL&gt;&quot;)</span>

        // Current situation of all transfers, running or not
<span class="fc" id="L702">        .append(&quot;&lt;STEPS&gt;&quot;).append(&quot;&lt;Notask&gt;&quot;).append(nbCountStepNotask)</span>
<span class="fc" id="L703">        .append(&quot;&lt;/Notask&gt;&quot;).append(&quot;&lt;Pretask&gt;&quot;).append(nbCountStepPretask)</span>
<span class="fc" id="L704">        .append(&quot;&lt;/Pretask&gt;&quot;).append(&quot;&lt;Transfer&gt;&quot;).append(nbCountStepTransfer)</span>
<span class="fc" id="L705">        .append(&quot;&lt;/Transfer&gt;&quot;).append(&quot;&lt;Posttask&gt;&quot;).append(nbCountStepPosttask)</span>
<span class="fc" id="L706">        .append(&quot;&lt;/Posttask&gt;&quot;).append(&quot;&lt;AllDone&gt;&quot;).append(nbCountStepAllDone)</span>
<span class="fc" id="L707">        .append(&quot;&lt;/AllDone&gt;&quot;).append(&quot;&lt;Error&gt;&quot;).append(nbCountStepError)</span>
<span class="fc" id="L708">        .append(&quot;&lt;/Error&gt;&quot;).append(&quot;&lt;/STEPS&gt;&quot;)</span>

        // On Running Transfers only
<span class="fc" id="L711">        .append(&quot;&lt;RUNNINGSTEPS&gt;&quot;).append(&quot;&lt;AllRunning&gt;&quot;)</span>
<span class="fc" id="L712">        .append(nbCountAllRunningStep).append(&quot;&lt;/AllRunning&gt;&quot;);</span>
<span class="fc bfc" id="L713" title="All 2 branches covered.">    if (detail) {</span>
<span class="fc" id="L714">      builder.append(&quot;&lt;Running&gt;&quot;).append(nbCountRunningStep)</span>
<span class="fc" id="L715">             .append(&quot;&lt;/Running&gt;&quot;).append(&quot;&lt;InitOk&gt;&quot;).append(nbCountInitOkStep)</span>
<span class="fc" id="L716">             .append(&quot;&lt;/InitOk&gt;&quot;).append(&quot;&lt;PreProcessingOk&gt;&quot;)</span>
<span class="fc" id="L717">             .append(nbCountPreProcessingOkStep).append(&quot;&lt;/PreProcessingOk&gt;&quot;)</span>
<span class="fc" id="L718">             .append(&quot;&lt;TransferOk&gt;&quot;).append(nbCountTransferOkStep)</span>
<span class="fc" id="L719">             .append(&quot;&lt;/TransferOk&gt;&quot;).append(&quot;&lt;PostProcessingOk&gt;&quot;)</span>
<span class="fc" id="L720">             .append(nbCountPostProcessingOkStep).append(&quot;&lt;/PostProcessingOk&gt;&quot;)</span>
<span class="fc" id="L721">             .append(&quot;&lt;CompleteOk&gt;&quot;).append(nbCountCompleteOkStep)</span>
<span class="fc" id="L722">             .append(&quot;&lt;/CompleteOk&gt;&quot;);</span>
    }
<span class="fc" id="L724">    builder.append(&quot;&lt;/RUNNINGSTEPS&gt;&quot;);</span>

<span class="fc bfc" id="L726" title="All 2 branches covered.">    if (detail) {</span>
      // Error Status on all transfers
<span class="fc" id="L728">      builder.append(&quot;&lt;ERRORTYPES&gt;&quot;).append(&quot;&lt;ConnectionImpossible&gt;&quot;)</span>
<span class="fc" id="L729">             .append(nbCountStatusConnectionImpossible)</span>
<span class="fc" id="L730">             .append(&quot;&lt;/ConnectionImpossible&gt;&quot;).append(&quot;&lt;ServerOverloaded&gt;&quot;)</span>
<span class="fc" id="L731">             .append(nbCountStatusServerOverloaded)</span>
<span class="fc" id="L732">             .append(&quot;&lt;/ServerOverloaded&gt;&quot;).append(&quot;&lt;BadAuthent&gt;&quot;)</span>
<span class="fc" id="L733">             .append(nbCountStatusBadAuthent).append(&quot;&lt;/BadAuthent&gt;&quot;)</span>
<span class="fc" id="L734">             .append(&quot;&lt;ExternalOp&gt;&quot;).append(nbCountStatusExternalOp)</span>
<span class="fc" id="L735">             .append(&quot;&lt;/ExternalOp&gt;&quot;).append(&quot;&lt;TransferError&gt;&quot;)</span>
<span class="fc" id="L736">             .append(nbCountStatusTransferError).append(&quot;&lt;/TransferError&gt;&quot;)</span>
<span class="fc" id="L737">             .append(&quot;&lt;MD5Error&gt;&quot;).append(nbCountStatusMD5Error)</span>
<span class="fc" id="L738">             .append(&quot;&lt;/MD5Error&gt;&quot;).append(&quot;&lt;Disconnection&gt;&quot;)</span>
<span class="fc" id="L739">             .append(nbCountStatusDisconnection).append(&quot;&lt;/Disconnection&gt;&quot;)</span>
<span class="fc" id="L740">             .append(&quot;&lt;FinalOp&gt;&quot;).append(nbCountStatusFinalOp)</span>
<span class="fc" id="L741">             .append(&quot;&lt;/FinalOp&gt;&quot;).append(&quot;&lt;Unimplemented&gt;&quot;)</span>
<span class="fc" id="L742">             .append(nbCountStatusUnimplemented).append(&quot;&lt;/Unimplemented&gt;&quot;)</span>
<span class="fc" id="L743">             .append(&quot;&lt;Internal&gt;&quot;).append(nbCountStatusInternal)</span>
<span class="fc" id="L744">             .append(&quot;&lt;/Internal&gt;&quot;).append(&quot;&lt;Warning&gt;&quot;)</span>
<span class="fc" id="L745">             .append(nbCountStatusWarning).append(&quot;&lt;/Warning&gt;&quot;)</span>
<span class="fc" id="L746">             .append(&quot;&lt;QueryAlreadyFinished&gt;&quot;)</span>
<span class="fc" id="L747">             .append(nbCountStatusQueryAlreadyFinished)</span>
<span class="fc" id="L748">             .append(&quot;&lt;/QueryAlreadyFinished&gt;&quot;).append(&quot;&lt;QueryStillRunning&gt;&quot;)</span>
<span class="fc" id="L749">             .append(nbCountStatusQueryStillRunning)</span>
<span class="fc" id="L750">             .append(&quot;&lt;/QueryStillRunning&gt;&quot;).append(&quot;&lt;KnownHost&gt;&quot;)</span>
<span class="fc" id="L751">             .append(nbCountStatusNotKnownHost).append(&quot;&lt;/KnownHost&gt;&quot;)</span>
<span class="fc" id="L752">             .append(&quot;&lt;RemotelyUnknown&gt;&quot;)</span>
<span class="fc" id="L753">             .append(nbCountStatusQueryRemotelyUnknown)</span>
<span class="fc" id="L754">             .append(&quot;&lt;/RemotelyUnknown&gt;&quot;).append(&quot;&lt;CommandNotFound&gt;&quot;)</span>
<span class="fc" id="L755">             .append(nbCountStatusCommandNotFound).append(&quot;&lt;/CommandNotFound&gt;&quot;)</span>
<span class="fc" id="L756">             .append(&quot;&lt;PassThroughMode&gt;&quot;).append(nbCountStatusPassThroughMode)</span>
<span class="fc" id="L757">             .append(&quot;&lt;/PassThroughMode&gt;&quot;).append(&quot;&lt;RemoteShutdown&gt;&quot;)</span>
<span class="fc" id="L758">             .append(nbCountStatusRemoteShutdown).append(&quot;&lt;/RemoteShutdown&gt;&quot;)</span>
<span class="fc" id="L759">             .append(&quot;&lt;Shutdown&gt;&quot;).append(nbCountStatusShutdown)</span>
<span class="fc" id="L760">             .append(&quot;&lt;/Shutdown&gt;&quot;).append(&quot;&lt;RemoteError&gt;&quot;)</span>
<span class="fc" id="L761">             .append(nbCountStatusRemoteError).append(&quot;&lt;/RemoteError&gt;&quot;)</span>
<span class="fc" id="L762">             .append(&quot;&lt;Stopped&gt;&quot;).append(nbCountStatusStopped)</span>
<span class="fc" id="L763">             .append(&quot;&lt;/Stopped&gt;&quot;).append(&quot;&lt;Canceled&gt;&quot;)</span>
<span class="fc" id="L764">             .append(nbCountStatusCanceled).append(&quot;&lt;/Canceled&gt;&quot;)</span>
<span class="fc" id="L765">             .append(&quot;&lt;FileNotFound&gt;&quot;).append(nbCountStatusFileNotFound)</span>
<span class="fc" id="L766">             .append(&quot;&lt;/FileNotFound&gt;&quot;).append(&quot;&lt;Unknown&gt;&quot;)</span>
<span class="fc" id="L767">             .append(nbCountStatusUnknown).append(&quot;&lt;/Unknown&gt;&quot;)</span>
<span class="fc" id="L768">             .append(&quot;&lt;/ERRORTYPES&gt;&quot;);</span>
    }
<span class="fc" id="L770">    builder.append(&quot;&lt;/STATUS&gt;&quot;);</span>
<span class="fc" id="L771">    return builder.toString();</span>
  }

  /**
   * @param detail
   *
   * @return The Json representation of the current status
   */
  public final String exportJson(final boolean detail) {
<span class="fc" id="L780">    return JsonHandler.prettyPrint(exportAsJson(detail));</span>
  }

  /**
   * @param detail
   *
   * @return The Json representation of the current status
   */
  public final ObjectNode exportAsJson(final boolean detail) {
<span class="fc" id="L789">    ObjectNode node = JsonHandler.createObjectNode();</span>
<span class="fc" id="L790">    node = node.putObject(&quot;STATUS&quot;);</span>
    // Global Informations
<span class="fc" id="L792">    node.put(&quot;HostID&quot;, Configuration.configuration.getHostId());</span>
<span class="fc" id="L793">    node.put(&quot;Date&quot;, new DateTime().toString());</span>
<span class="fc" id="L794">    node.put(&quot;LastRun&quot;, new DateTime(lastTry).toString());</span>
<span class="fc" id="L795">    node.put(&quot;FromDate&quot;, new DateTime(currentLimit).toString());</span>
<span class="fc" id="L796">    node.put(&quot;SecondsRunning&quot;, secondsRunning);</span>
<span class="fc" id="L797">    node.put(&quot;NetworkConnections&quot;, nbNetworkConnection);</span>
<span class="fc" id="L798">    node.put(&quot;NbThreads&quot;, nbThread);</span>
<span class="fc" id="L799">    node.put(&quot;InBandwidth&quot;, bandwidthIn);</span>
<span class="fc" id="L800">    node.put(&quot;OutBandwidth&quot;, bandwidthOut);</span>

    // Overall status including past, future and current transfers
<span class="fc" id="L803">    ObjectNode node2 = node.putObject(&quot;OVERALL&quot;);</span>
<span class="fc" id="L804">    node2.put(&quot;AllTransfer&quot;, nbCountStepAllTransfer);</span>
<span class="fc" id="L805">    node2.put(&quot;Unknown&quot;, nbCountInfoUnknown);</span>
<span class="fc" id="L806">    node2.put(&quot;NotUpdated&quot;, nbCountInfoNotUpdated);</span>
<span class="fc" id="L807">    node2.put(&quot;Interrupted&quot;, nbCountInfoInterrupted);</span>
<span class="fc" id="L808">    node2.put(&quot;ToSubmit&quot;, nbCountInfoToSubmit);</span>
<span class="fc" id="L809">    node2.put(&quot;Error&quot;, nbCountInfoError);</span>
<span class="fc" id="L810">    node2.put(&quot;Running&quot;, nbCountInfoRunning);</span>
<span class="fc" id="L811">    node2.put(&quot;Done&quot;, nbCountInfoDone);</span>
<span class="fc" id="L812">    node2.put(&quot;InRunning&quot;, nbInActiveTransfer);</span>
<span class="fc" id="L813">    node2.put(&quot;OutRunning&quot;, nbOutActiveTransfer);</span>
<span class="fc" id="L814">    node2.put(&quot;LastInRunning&quot;, new DateTime(lastInActiveTransfer).toString());</span>
<span class="fc" id="L815">    node2.put(&quot;LastOutRunning&quot;, new DateTime(lastOutActiveTransfer).toString());</span>
<span class="fc" id="L816">    node2.put(&quot;InAll&quot;, nbInTotalTransfer);</span>
<span class="fc" id="L817">    node2.put(&quot;OutAll&quot;, nbOutTotalTransfer);</span>
<span class="fc" id="L818">    node2.put(&quot;InError&quot;, nbInErrorTransfer);</span>
<span class="fc" id="L819">    node2.put(&quot;OutError&quot;, nbOutErrorTransfer);</span>

    // Current situation of all transfers, running or not
<span class="fc" id="L822">    node2 = node.putObject(&quot;STEPS&quot;);</span>
<span class="fc" id="L823">    node2.put(&quot;Notask&quot;, nbCountStepNotask);</span>
<span class="fc" id="L824">    node2.put(&quot;Pretask&quot;, nbCountStepPretask);</span>
<span class="fc" id="L825">    node2.put(&quot;Transfer&quot;, nbCountStepTransfer);</span>
<span class="fc" id="L826">    node2.put(&quot;Posttask&quot;, nbCountStepPosttask);</span>
<span class="fc" id="L827">    node2.put(&quot;AllDone&quot;, nbCountStepAllDone);</span>
<span class="fc" id="L828">    node2.put(&quot;Error&quot;, nbCountStepError);</span>

    // On Running Transfers only
<span class="fc" id="L831">    node2 = node.putObject(&quot;RUNNINGSTEPS&quot;);</span>
<span class="fc" id="L832">    node2.put(&quot;AllRunning&quot;, nbCountAllRunningStep);</span>
<span class="fc bfc" id="L833" title="All 2 branches covered.">    if (detail) {</span>
<span class="fc" id="L834">      node2.put(&quot;Running&quot;, nbCountRunningStep);</span>
<span class="fc" id="L835">      node2.put(&quot;InitOk&quot;, nbCountInitOkStep);</span>
<span class="fc" id="L836">      node2.put(&quot;PreProcessingOk&quot;, nbCountPreProcessingOkStep);</span>
<span class="fc" id="L837">      node2.put(&quot;TransferOk&quot;, nbCountTransferOkStep);</span>
<span class="fc" id="L838">      node2.put(&quot;PostProcessingOk&quot;, nbCountPostProcessingOkStep);</span>
<span class="fc" id="L839">      node2.put(&quot;CompleteOk&quot;, nbCountCompleteOkStep);</span>
    }

<span class="fc bfc" id="L842" title="All 2 branches covered.">    if (detail) {</span>
      // Error Status on all transfers
<span class="fc" id="L844">      node2 = node.putObject(&quot;ERRORTYPES&quot;);</span>
<span class="fc" id="L845">      node2.put(&quot;ConnectionImpossible&quot;, nbCountStatusConnectionImpossible);</span>
<span class="fc" id="L846">      node2.put(&quot;ServerOverloaded&quot;, nbCountStatusServerOverloaded);</span>
<span class="fc" id="L847">      node2.put(&quot;BadAuthent&quot;, nbCountStatusBadAuthent);</span>
<span class="fc" id="L848">      node2.put(&quot;ExternalOp&quot;, nbCountStatusExternalOp);</span>
<span class="fc" id="L849">      node2.put(&quot;TransferError&quot;, nbCountStatusTransferError);</span>
<span class="fc" id="L850">      node2.put(&quot;MD5Error&quot;, nbCountStatusMD5Error);</span>
<span class="fc" id="L851">      node2.put(&quot;Disconnection&quot;, nbCountStatusDisconnection);</span>
<span class="fc" id="L852">      node2.put(&quot;FinalOp&quot;, nbCountStatusFinalOp);</span>
<span class="fc" id="L853">      node2.put(&quot;Unimplemented&quot;, nbCountStatusUnimplemented);</span>
<span class="fc" id="L854">      node2.put(&quot;Internal&quot;, nbCountStatusInternal);</span>
<span class="fc" id="L855">      node2.put(&quot;Warning&quot;, nbCountStatusWarning);</span>
<span class="fc" id="L856">      node2.put(&quot;QueryAlreadyFinished&quot;, nbCountStatusQueryAlreadyFinished);</span>
<span class="fc" id="L857">      node2.put(&quot;QueryStillRunning&quot;, nbCountStatusQueryStillRunning);</span>
<span class="fc" id="L858">      node2.put(&quot;KnownHost&quot;, nbCountStatusNotKnownHost);</span>
<span class="fc" id="L859">      node2.put(&quot;RemotelyUnknown&quot;, nbCountStatusQueryRemotelyUnknown);</span>
<span class="fc" id="L860">      node2.put(&quot;CommandNotFound&quot;, nbCountStatusCommandNotFound);</span>
<span class="fc" id="L861">      node2.put(&quot;PassThroughMode&quot;, nbCountStatusPassThroughMode);</span>
<span class="fc" id="L862">      node2.put(&quot;RemoteShutdown&quot;, nbCountStatusRemoteShutdown);</span>
<span class="fc" id="L863">      node2.put(&quot;Shutdown&quot;, nbCountStatusShutdown);</span>
<span class="fc" id="L864">      node2.put(&quot;RemoteError&quot;, nbCountStatusRemoteError);</span>
<span class="fc" id="L865">      node2.put(&quot;Stopped&quot;, nbCountStatusStopped);</span>
<span class="fc" id="L866">      node2.put(&quot;Canceled&quot;, nbCountStatusCanceled);</span>
<span class="fc" id="L867">      node2.put(&quot;FileNotFound&quot;, nbCountStatusFileNotFound);</span>
<span class="fc" id="L868">      node2.put(&quot;Unknown&quot;, nbCountStatusUnknown);</span>
    }
<span class="fc" id="L870">    return node;</span>
  }

  @Override
  public final void setAgent(final WaarpSnmpAgent agent) {
<span class="fc" id="L875">    this.agent = agent;</span>
<span class="fc" id="L876">    lastInActiveTransfer = this.agent.getUptimeSystemTime();</span>
<span class="fc" id="L877">    lastOutActiveTransfer = this.agent.getUptimeSystemTime();</span>
<span class="fc" id="L878">  }</span>

  /**
   * Update the value for one particular MIB entry
   *
   * @param type
   * @param entry
   */
  public final void run(final int type, final int entry) {
<span class="fc" id="L887">    final long nbMs =</span>
<span class="fc" id="L888">        Configuration.configuration.getAgentSnmp().getUptime() + 100;</span>
<span class="fc" id="L889">    final MibLevel level = MibLevel.values()[type];</span>
<span class="fc bfc" id="L890" title="All 4 branches covered.">    switch (level) {</span>
      case globalInfo:// Global
<span class="pc bpc" id="L892" title="1 of 2 branches missed.">        if (((R66PrivateMib) agent.getMib()).rowGlobal != null) {</span>
<span class="nc" id="L893">          run(nbMs, WaarpGlobalValuesIndex.values()[entry]);</span>
        }
<span class="fc" id="L895">        return;</span>
      case detailedInfo:// Detailed
<span class="pc bpc" id="L897" title="1 of 2 branches missed.">        if (((R66PrivateMib) agent.getMib()).rowDetailed != null) {</span>
<span class="nc" id="L898">          run(nbMs, WaarpDetailedValuesIndex.values()[entry]);</span>
        }
<span class="fc" id="L900">        return;</span>
      case errorInfo:// Error
<span class="pc bpc" id="L902" title="1 of 2 branches missed.">        if (((R66PrivateMib) agent.getMib()).rowError != null) {</span>
<span class="nc" id="L903">          run(nbMs, WaarpErrorValuesIndex.values()[entry]);</span>
        }
<span class="fc" id="L905">        return;</span>
      case trapInfo:
      case staticInfo:
      default:
        break;
    }
<span class="fc" id="L911">  }</span>

  /**
   * Update a value in Global MIB part
   *
   * @param rank
   * @param value
   */
  protected final void updateGlobalValue(final int rank, final long value) {
<span class="nc" id="L920">    ((R66PrivateMib) agent.getMib()).rowGlobal.setValue(rank, value);</span>
<span class="nc" id="L921">  }</span>

  /**
   * Update a value in Detailed MIB part
   *
   * @param rank
   * @param value
   */
  protected final void updateDetailedValue(final int rank, final long value) {
<span class="nc" id="L930">    ((R66PrivateMib) agent.getMib()).rowDetailed.setValue(rank, value);</span>
<span class="nc" id="L931">  }</span>

  /**
   * Update a value in Error MIB part
   *
   * @param rank
   * @param value
   */
  protected final void updateErrorValue(final int rank, final long value) {
<span class="nc" id="L940">    ((R66PrivateMib) agent.getMib()).rowError.setValue(rank, value);</span>
<span class="nc" id="L941">  }</span>

  /**
   * Update a value in Global MIB part
   *
   * @param nbMs
   * @param entry
   */
  protected final void run(final long nbMs,
                           final WaarpGlobalValuesIndex entry) {
<span class="nc" id="L951">    synchronized (trafficCounter) {</span>
      long val;
<span class="nc" id="L953">      final long limitDate = System.currentTimeMillis() - nbMs;</span>
<span class="nc bnc" id="L954" title="All 4 branches missed.">      if (dbSession == null || dbSession.isDisActive()) {</span>
<span class="nc bnc" id="L955" title="All 22 branches missed.">        switch (entry) {</span>
          case applUptime:
          case memoryUsed:
          case memoryFree:
          case memoryTotal:
          case applLastChange:
          case applOperStatus:
<span class="nc" id="L962">            return;</span>
          case applInboundAssociations:
<span class="nc" id="L964">            updateGlobalValue(entry.ordinal(), nbInActiveTransfer);</span>
<span class="nc" id="L965">            return;</span>
          case applOutboundAssociations:
<span class="nc" id="L967">            updateGlobalValue(entry.ordinal(), nbOutActiveTransfer);</span>
<span class="nc" id="L968">            return;</span>
          case applAccumInboundAssociations:
<span class="nc" id="L970">            updateGlobalValue(entry.ordinal(), nbInTotalTransfer);</span>
<span class="nc" id="L971">            return;</span>
          case applAccumOutboundAssociations:
<span class="nc" id="L973">            updateGlobalValue(entry.ordinal(), nbOutTotalTransfer);</span>
<span class="nc" id="L974">            return;</span>
          case applLastInboundActivity:
<span class="nc" id="L976">            val = (lastInActiveTransfer - agent.getUptimeSystemTime()) / 10;</span>
<span class="nc bnc" id="L977" title="All 2 branches missed.">            if (val &lt; 0) {</span>
<span class="nc" id="L978">              val = 0;</span>
            }
<span class="nc" id="L980">            updateGlobalValue(entry.ordinal(), val);</span>
<span class="nc" id="L981">            return;</span>
          case applLastOutboundActivity:
<span class="nc" id="L983">            val = (lastOutActiveTransfer - agent.getUptimeSystemTime()) / 10;</span>
<span class="nc bnc" id="L984" title="All 2 branches missed.">            if (val &lt; 0) {</span>
<span class="nc" id="L985">              val = 0;</span>
            }
<span class="nc" id="L987">            updateGlobalValue(entry.ordinal(), val);</span>
<span class="nc" id="L988">            return;</span>
          case applRejectedInboundAssociations:
<span class="nc" id="L990">            updateGlobalValue(entry.ordinal(), nbInErrorTransfer);</span>
<span class="nc" id="L991">            return;</span>
          case applFailedOutboundAssociations:
<span class="nc" id="L993">            updateGlobalValue(entry.ordinal(), nbOutErrorTransfer);</span>
<span class="nc" id="L994">            return;</span>
          case applInboundBandwidthKBS:
<span class="nc" id="L996">            val = trafficCounter.lastReadThroughput() &gt;&gt; 10;// B/s -&gt; KB/s</span>
<span class="nc" id="L997">            updateGlobalValue(entry.ordinal(), val);</span>
<span class="nc" id="L998">            return;</span>
          case applOutboundBandwidthKBS:
<span class="nc" id="L1000">            val = trafficCounter.lastWriteThroughput() &gt;&gt; 10;</span>
<span class="nc" id="L1001">            updateGlobalValue(entry.ordinal(), val);</span>
<span class="nc" id="L1002">            return;</span>
          case nbInfoUnknown:
<span class="nc" id="L1004">            updateGlobalValue(entry.ordinal(), nbCountInfoUnknown);</span>
<span class="nc" id="L1005">            return;</span>
          case nbInfoNotUpdated:
<span class="nc" id="L1007">            updateGlobalValue(entry.ordinal(), nbCountInfoNotUpdated);</span>
<span class="nc" id="L1008">            return;</span>
          case nbInfoInterrupted:
<span class="nc" id="L1010">            updateGlobalValue(entry.ordinal(), nbCountInfoInterrupted);</span>
<span class="nc" id="L1011">            return;</span>
          case nbInfoToSubmit:
<span class="nc" id="L1013">            nbCountInfoToSubmit = CommanderNoDb.todoList.size();</span>
<span class="nc" id="L1014">            updateGlobalValue(entry.ordinal(), nbCountInfoToSubmit);</span>
<span class="nc" id="L1015">            return;</span>
          case nbInfoError:
<span class="nc" id="L1017">            updateGlobalValue(entry.ordinal(), nbCountInfoError);</span>
<span class="nc" id="L1018">            return;</span>
          case nbInfoRunning:
<span class="nc" id="L1020">            nbCountInfoRunning = Configuration.configuration.getInternalRunner()</span>
<span class="nc" id="L1021">                                                            .nbInternalRunner();</span>
<span class="nc" id="L1022">            updateGlobalValue(entry.ordinal(), nbCountInfoRunning);</span>
<span class="nc" id="L1023">            return;</span>
          case nbInfoDone:
<span class="nc" id="L1025">            updateGlobalValue(entry.ordinal(), nbCountInfoDone);</span>
<span class="nc" id="L1026">            return;</span>
          case nbStepAllTransfer:
<span class="nc" id="L1028">            updateGlobalValue(entry.ordinal(), nbCountStepAllTransfer);</span>
<span class="nc" id="L1029">            return;</span>
          case nbThreads:
<span class="nc" id="L1031">            nbThread = Thread.activeCount();</span>
<span class="nc" id="L1032">            updateGlobalValue(entry.ordinal(), nbThread);</span>
<span class="nc" id="L1033">            return;</span>
          case nbNetworkConnection:
<span class="nc" id="L1035">            nbNetworkConnection =</span>
<span class="nc" id="L1036">                ChannelUtils.nbCommandChannels(Configuration.configuration);</span>
<span class="nc" id="L1037">            updateGlobalValue(entry.ordinal(), nbNetworkConnection);</span>
<span class="nc" id="L1038">            return;</span>
        }
<span class="nc" id="L1040">        return;</span>
      }
      // Global
      try {
<span class="nc bnc" id="L1044" title="All 22 branches missed.">        switch (entry) {</span>
          case applUptime:
          case memoryUsed:
          case memoryFree:
          case memoryTotal:
          case applLastChange:
          case applOperStatus:
<span class="nc" id="L1051">            return;</span>
          case applInboundAssociations:
<span class="nc" id="L1053">            DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
                countInActiveTransfer, limitDate);
<span class="nc" id="L1055">            nbInActiveTransfer = DbTaskRunner.getResultCountPrepareStatement(</span>
                countInActiveTransfer);
<span class="nc" id="L1057">            updateGlobalValue(entry.ordinal(), nbInActiveTransfer);</span>
<span class="nc" id="L1058">            return;</span>
          case applOutboundAssociations:
<span class="nc" id="L1060">            DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
                countOutActiveTransfer, limitDate);
<span class="nc" id="L1062">            nbOutActiveTransfer = DbTaskRunner.getResultCountPrepareStatement(</span>
                countOutActiveTransfer);
<span class="nc" id="L1064">            updateGlobalValue(entry.ordinal(), nbOutActiveTransfer);</span>
<span class="nc" id="L1065">            return;</span>
          case applAccumInboundAssociations:
<span class="nc" id="L1067">            DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
                countInTotalTransfer, limitDate);
<span class="nc" id="L1069">            nbInTotalTransfer = DbTaskRunner.getResultCountPrepareStatement(</span>
                countInTotalTransfer);
<span class="nc" id="L1071">            updateGlobalValue(entry.ordinal(), nbInTotalTransfer);</span>
<span class="nc" id="L1072">            return;</span>
          case applAccumOutboundAssociations:
<span class="nc" id="L1074">            DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
                countOutTotalTransfer, limitDate);
<span class="nc" id="L1076">            nbOutTotalTransfer = DbTaskRunner.getResultCountPrepareStatement(</span>
                countOutTotalTransfer);
<span class="nc" id="L1078">            updateGlobalValue(entry.ordinal(), nbOutTotalTransfer);</span>
<span class="nc" id="L1079">            return;</span>
          case applLastInboundActivity:
<span class="nc" id="L1081">            val = (lastInActiveTransfer - agent.getUptimeSystemTime()) / 10;</span>
<span class="nc bnc" id="L1082" title="All 2 branches missed.">            if (val &lt; 0) {</span>
<span class="nc" id="L1083">              val = 0;</span>
            }
<span class="nc" id="L1085">            updateGlobalValue(entry.ordinal(), val);</span>
<span class="nc" id="L1086">            return;</span>
          case applLastOutboundActivity:
<span class="nc" id="L1088">            val = (lastOutActiveTransfer - agent.getUptimeSystemTime()) / 10;</span>
<span class="nc bnc" id="L1089" title="All 2 branches missed.">            if (val &lt; 0) {</span>
<span class="nc" id="L1090">              val = 0;</span>
            }
<span class="nc" id="L1092">            updateGlobalValue(entry.ordinal(), val);</span>
<span class="nc" id="L1093">            return;</span>
          case applRejectedInboundAssociations:
<span class="nc" id="L1095">            DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
                countInErrorTransfer, limitDate);
<span class="nc" id="L1097">            nbInErrorTransfer = DbTaskRunner.getResultCountPrepareStatement(</span>
                countInErrorTransfer);
<span class="nc" id="L1099">            updateGlobalValue(entry.ordinal(), nbInErrorTransfer);</span>
<span class="nc" id="L1100">            return;</span>
          case applFailedOutboundAssociations:
<span class="nc" id="L1102">            DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
                countOutErrorTransfer, limitDate);
<span class="nc" id="L1104">            nbOutErrorTransfer = DbTaskRunner.getResultCountPrepareStatement(</span>
                countOutErrorTransfer);
<span class="nc" id="L1106">            updateGlobalValue(entry.ordinal(), nbOutErrorTransfer);</span>
<span class="nc" id="L1107">            return;</span>
          case applInboundBandwidthKBS:
<span class="nc" id="L1109">            val = trafficCounter.lastReadThroughput() &gt;&gt; 10;// B/s -&gt; KB/s</span>
<span class="nc" id="L1110">            updateGlobalValue(entry.ordinal(), val);</span>
<span class="nc" id="L1111">            return;</span>
          case applOutboundBandwidthKBS:
<span class="nc" id="L1113">            val = trafficCounter.lastWriteThroughput() &gt;&gt; 10;</span>
<span class="nc" id="L1114">            updateGlobalValue(entry.ordinal(), val);</span>
<span class="nc" id="L1115">            return;</span>
          case nbInfoUnknown:
<span class="nc" id="L1117">            nbCountInfoUnknown =</span>
<span class="nc" id="L1118">                DbTaskRunner.getResultCountPrepareStatement(countInfo,</span>
                                                            UpdatedInfo.UNKNOWN,
                                                            limitDate);
<span class="nc" id="L1121">            updateGlobalValue(entry.ordinal(), nbCountInfoUnknown);</span>
<span class="nc" id="L1122">            return;</span>
          case nbInfoNotUpdated:
<span class="nc" id="L1124">            nbCountInfoNotUpdated =</span>
<span class="nc" id="L1125">                DbTaskRunner.getResultCountPrepareStatement(countInfo,</span>
                                                            UpdatedInfo.NOTUPDATED,
                                                            limitDate);
<span class="nc" id="L1128">            updateGlobalValue(entry.ordinal(), nbCountInfoNotUpdated);</span>
<span class="nc" id="L1129">            return;</span>
          case nbInfoInterrupted:
<span class="nc" id="L1131">            nbCountInfoInterrupted =</span>
<span class="nc" id="L1132">                DbTaskRunner.getResultCountPrepareStatement(countInfo,</span>
                                                            UpdatedInfo.INTERRUPTED,
                                                            limitDate);
<span class="nc" id="L1135">            updateGlobalValue(entry.ordinal(), nbCountInfoInterrupted);</span>
<span class="nc" id="L1136">            return;</span>
          case nbInfoToSubmit:
<span class="nc" id="L1138">            nbCountInfoToSubmit =</span>
<span class="nc" id="L1139">                DbTaskRunner.getResultCountPrepareStatement(countInfo,</span>
                                                            UpdatedInfo.TOSUBMIT,
                                                            limitDate);
<span class="nc" id="L1142">            updateGlobalValue(entry.ordinal(), nbCountInfoToSubmit);</span>
<span class="nc" id="L1143">            return;</span>
          case nbInfoError:
<span class="nc" id="L1145">            nbCountInfoError =</span>
<span class="nc" id="L1146">                DbTaskRunner.getResultCountPrepareStatement(countInfo,</span>
                                                            UpdatedInfo.INERROR,
                                                            limitDate);
<span class="nc" id="L1149">            updateGlobalValue(entry.ordinal(), nbCountInfoError);</span>
<span class="nc" id="L1150">            return;</span>
          case nbInfoRunning:
<span class="nc" id="L1152">            nbCountInfoRunning =</span>
<span class="nc" id="L1153">                DbTaskRunner.getResultCountPrepareStatement(countInfo,</span>
                                                            UpdatedInfo.RUNNING,
                                                            limitDate);
<span class="nc" id="L1156">            updateGlobalValue(entry.ordinal(), nbCountInfoRunning);</span>
<span class="nc" id="L1157">            return;</span>
          case nbInfoDone:
<span class="nc" id="L1159">            nbCountInfoDone =</span>
<span class="nc" id="L1160">                DbTaskRunner.getResultCountPrepareStatement(countInfo,</span>
                                                            UpdatedInfo.DONE,
                                                            limitDate);
<span class="nc" id="L1163">            updateGlobalValue(entry.ordinal(), nbCountInfoDone);</span>
<span class="nc" id="L1164">            return;</span>
          case nbStepAllTransfer:
<span class="nc" id="L1166">            DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
                countStepAllTransfer, limitDate);
<span class="nc" id="L1168">            nbCountStepAllTransfer =</span>
<span class="nc" id="L1169">                DbTaskRunner.getResultCountPrepareStatement(</span>
                    countStepAllTransfer);
<span class="nc" id="L1171">            updateGlobalValue(entry.ordinal(), nbCountStepAllTransfer);</span>
<span class="nc" id="L1172">            return;</span>
          case nbThreads:
<span class="nc" id="L1174">            nbThread = Thread.activeCount();</span>
<span class="nc" id="L1175">            updateGlobalValue(entry.ordinal(), nbThread);</span>
<span class="nc" id="L1176">            return;</span>
          case nbNetworkConnection:
<span class="nc" id="L1178">            nbNetworkConnection = DbAdmin.getNbConnection();</span>
<span class="nc" id="L1179">            updateGlobalValue(entry.ordinal(), nbNetworkConnection);</span>
        }
<span class="nc" id="L1181">      } catch (final WaarpDatabaseNoConnectionException ignored) {</span>
        // ignore
<span class="nc" id="L1183">      } catch (final WaarpDatabaseSqlException ignored) {</span>
        // ignore
<span class="nc" id="L1185">      }</span>
<span class="nc" id="L1186">    }</span>
<span class="nc" id="L1187">  }</span>

  /**
   * Update a value in Detailed MIB part
   *
   * @param nbMs
   * @param entry
   */
  protected final void run(final long nbMs,
                           final WaarpDetailedValuesIndex entry) {
<span class="nc" id="L1197">    synchronized (trafficCounter) {</span>
<span class="nc" id="L1198">      final long limitDate = System.currentTimeMillis() - nbMs;</span>
<span class="nc bnc" id="L1199" title="All 4 branches missed.">      if (dbSession == null || dbSession.isDisActive()) {</span>
<span class="nc bnc" id="L1200" title="All 14 branches missed.">        switch (entry) {</span>
          case nbStepNotask:
<span class="nc" id="L1202">            updateDetailedValue(entry.ordinal(), nbCountStepNotask);</span>
<span class="nc" id="L1203">            return;</span>
          case nbStepPretask:
<span class="nc" id="L1205">            updateDetailedValue(entry.ordinal(), nbCountStepPretask);</span>
<span class="nc" id="L1206">            return;</span>
          case nbStepTransfer:
<span class="nc" id="L1208">            updateDetailedValue(entry.ordinal(), nbCountStepTransfer);</span>
<span class="nc" id="L1209">            return;</span>
          case nbStepPosttask:
<span class="nc" id="L1211">            updateDetailedValue(entry.ordinal(), nbCountStepPosttask);</span>
<span class="nc" id="L1212">            return;</span>
          case nbStepAllDone:
<span class="nc" id="L1214">            updateDetailedValue(entry.ordinal(), nbCountStepAllDone);</span>
<span class="nc" id="L1215">            return;</span>
          case nbStepError:
<span class="nc" id="L1217">            updateDetailedValue(entry.ordinal(), nbCountStepError);</span>
<span class="nc" id="L1218">            return;</span>
          case nbAllRunningStep:
<span class="nc" id="L1220">            nbCountAllRunningStep =</span>
<span class="nc" id="L1221">                Configuration.configuration.getInternalRunner()</span>
<span class="nc" id="L1222">                                           .nbInternalRunner();</span>
<span class="nc" id="L1223">            updateDetailedValue(entry.ordinal(), nbCountAllRunningStep);</span>
<span class="nc" id="L1224">            return;</span>
          case nbRunningStep:
<span class="nc" id="L1226">            updateDetailedValue(entry.ordinal(), nbCountRunningStep);</span>
<span class="nc" id="L1227">            return;</span>
          case nbInitOkStep:
<span class="nc" id="L1229">            updateDetailedValue(entry.ordinal(), nbCountInitOkStep);</span>
<span class="nc" id="L1230">            return;</span>
          case nbPreProcessingOkStep:
<span class="nc" id="L1232">            updateDetailedValue(entry.ordinal(), nbCountPreProcessingOkStep);</span>
<span class="nc" id="L1233">            return;</span>
          case nbTransferOkStep:
<span class="nc" id="L1235">            updateDetailedValue(entry.ordinal(), nbCountTransferOkStep);</span>
<span class="nc" id="L1236">            return;</span>
          case nbPostProcessingOkStep:
<span class="nc" id="L1238">            updateDetailedValue(entry.ordinal(), nbCountPostProcessingOkStep);</span>
<span class="nc" id="L1239">            return;</span>
          case nbCompleteOkStep:
<span class="nc" id="L1241">            updateDetailedValue(entry.ordinal(), nbCountCompleteOkStep);</span>
<span class="nc" id="L1242">            return;</span>
        }
<span class="nc" id="L1244">        return;</span>
      }
      // Detailed
      try {
<span class="nc bnc" id="L1248" title="All 14 branches missed.">        switch (entry) {</span>
          case nbStepNotask:
<span class="nc" id="L1250">            DbTaskRunner.finishSelectOrCountPrepareStatement(countStepNotask,</span>
                                                             limitDate);
<span class="nc" id="L1252">            nbCountStepNotask =</span>
<span class="nc" id="L1253">                DbTaskRunner.getResultCountPrepareStatement(countStepNotask);</span>
<span class="nc" id="L1254">            updateDetailedValue(entry.ordinal(), nbCountStepNotask);</span>
<span class="nc" id="L1255">            return;</span>
          case nbStepPretask:
<span class="nc" id="L1257">            DbTaskRunner.finishSelectOrCountPrepareStatement(countStepPretask,</span>
                                                             limitDate);
<span class="nc" id="L1259">            nbCountStepPretask =</span>
<span class="nc" id="L1260">                DbTaskRunner.getResultCountPrepareStatement(countStepPretask);</span>
<span class="nc" id="L1261">            updateDetailedValue(entry.ordinal(), nbCountStepPretask);</span>
<span class="nc" id="L1262">            return;</span>
          case nbStepTransfer:
<span class="nc" id="L1264">            DbTaskRunner.finishSelectOrCountPrepareStatement(countStepTransfer,</span>
                                                             limitDate);
<span class="nc" id="L1266">            nbCountStepTransfer =</span>
<span class="nc" id="L1267">                DbTaskRunner.getResultCountPrepareStatement(countStepTransfer);</span>
<span class="nc" id="L1268">            updateDetailedValue(entry.ordinal(), nbCountStepTransfer);</span>
<span class="nc" id="L1269">            return;</span>
          case nbStepPosttask:
<span class="nc" id="L1271">            DbTaskRunner.finishSelectOrCountPrepareStatement(countStepPosttask,</span>
                                                             limitDate);
<span class="nc" id="L1273">            nbCountStepPosttask =</span>
<span class="nc" id="L1274">                DbTaskRunner.getResultCountPrepareStatement(countStepPosttask);</span>
<span class="nc" id="L1275">            updateDetailedValue(entry.ordinal(), nbCountStepPosttask);</span>
<span class="nc" id="L1276">            return;</span>
          case nbStepAllDone:
<span class="nc" id="L1278">            DbTaskRunner.finishSelectOrCountPrepareStatement(countStepAllDone,</span>
                                                             limitDate);
<span class="nc" id="L1280">            nbCountStepAllDone =</span>
<span class="nc" id="L1281">                DbTaskRunner.getResultCountPrepareStatement(countStepAllDone);</span>
<span class="nc" id="L1282">            updateDetailedValue(entry.ordinal(), nbCountStepAllDone);</span>
<span class="nc" id="L1283">            return;</span>
          case nbStepError:
<span class="nc" id="L1285">            DbTaskRunner.finishSelectOrCountPrepareStatement(countStepError,</span>
                                                             limitDate);
<span class="nc" id="L1287">            nbCountStepError =</span>
<span class="nc" id="L1288">                DbTaskRunner.getResultCountPrepareStatement(countStepError);</span>
<span class="nc" id="L1289">            updateDetailedValue(entry.ordinal(), nbCountStepError);</span>
<span class="nc" id="L1290">            return;</span>
          case nbAllRunningStep:
<span class="nc" id="L1292">            DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
                countAllRunningStep, limitDate);
<span class="nc" id="L1294">            nbCountAllRunningStep = DbTaskRunner.getResultCountPrepareStatement(</span>
                countAllRunningStep);
<span class="nc" id="L1296">            updateDetailedValue(entry.ordinal(), nbCountAllRunningStep);</span>
<span class="nc" id="L1297">            return;</span>
          case nbRunningStep:
<span class="nc" id="L1299">            DbTaskRunner.finishSelectOrCountPrepareStatement(countRunningStep,</span>
                                                             limitDate);
<span class="nc" id="L1301">            nbCountRunningStep =</span>
<span class="nc" id="L1302">                DbTaskRunner.getResultCountPrepareStatement(countRunningStep);</span>
<span class="nc" id="L1303">            updateDetailedValue(entry.ordinal(), nbCountRunningStep);</span>
<span class="nc" id="L1304">            return;</span>
          case nbInitOkStep:
<span class="nc" id="L1306">            DbTaskRunner.finishSelectOrCountPrepareStatement(countInitOkStep,</span>
                                                             limitDate);
<span class="nc" id="L1308">            nbCountInitOkStep =</span>
<span class="nc" id="L1309">                DbTaskRunner.getResultCountPrepareStatement(countInitOkStep);</span>
<span class="nc" id="L1310">            updateDetailedValue(entry.ordinal(), nbCountInitOkStep);</span>
<span class="nc" id="L1311">            return;</span>
          case nbPreProcessingOkStep:
<span class="nc" id="L1313">            DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
                countPreProcessingOkStep, limitDate);
<span class="nc" id="L1315">            nbCountPreProcessingOkStep =</span>
<span class="nc" id="L1316">                DbTaskRunner.getResultCountPrepareStatement(</span>
                    countPreProcessingOkStep);
<span class="nc" id="L1318">            updateDetailedValue(entry.ordinal(), nbCountPreProcessingOkStep);</span>
<span class="nc" id="L1319">            return;</span>
          case nbTransferOkStep:
<span class="nc" id="L1321">            DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
                countTransferOkStep, limitDate);
<span class="nc" id="L1323">            nbCountTransferOkStep = DbTaskRunner.getResultCountPrepareStatement(</span>
                countTransferOkStep);
<span class="nc" id="L1325">            updateDetailedValue(entry.ordinal(), nbCountTransferOkStep);</span>
<span class="nc" id="L1326">            return;</span>
          case nbPostProcessingOkStep:
<span class="nc" id="L1328">            DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
                countPostProcessingOkStep, limitDate);
<span class="nc" id="L1330">            nbCountPostProcessingOkStep =</span>
<span class="nc" id="L1331">                DbTaskRunner.getResultCountPrepareStatement(</span>
                    countPostProcessingOkStep);
<span class="nc" id="L1333">            updateDetailedValue(entry.ordinal(), nbCountPostProcessingOkStep);</span>
<span class="nc" id="L1334">            return;</span>
          case nbCompleteOkStep:
<span class="nc" id="L1336">            DbTaskRunner.finishSelectOrCountPrepareStatement(</span>
                countCompleteOkStep, limitDate);
<span class="nc" id="L1338">            nbCountCompleteOkStep = DbTaskRunner.getResultCountPrepareStatement(</span>
                countCompleteOkStep);
<span class="nc" id="L1340">            updateDetailedValue(entry.ordinal(), nbCountCompleteOkStep);</span>
        }
<span class="nc" id="L1342">      } catch (final WaarpDatabaseNoConnectionException e) {</span>
<span class="nc" id="L1343">        logger.info(&quot;Database No Connection Error: Cannot execute Monitoring&quot;,</span>
                    e);
        try {
<span class="nc" id="L1346">          dbSession.getAdmin().getDbModel().validConnection(dbSession);</span>
<span class="nc" id="L1347">        } catch (final WaarpDatabaseNoConnectionException ignored) {</span>
          // ignore
<span class="nc" id="L1349">        }</span>
<span class="nc" id="L1350">      } catch (final WaarpDatabaseSqlException e) {</span>
<span class="nc" id="L1351">        logger.info(&quot;Database No Connection Error: Cannot execute Monitoring&quot;,</span>
                    e);
        try {
<span class="nc" id="L1354">          dbSession.getAdmin().getDbModel().validConnection(dbSession);</span>
<span class="nc" id="L1355">        } catch (final WaarpDatabaseNoConnectionException ignored) {</span>
          // ignore
<span class="nc" id="L1357">        }</span>
<span class="nc" id="L1358">      }</span>
<span class="nc" id="L1359">    }</span>
<span class="nc" id="L1360">  }</span>

  /**
   * Update a value in Error MIB part
   *
   * @param nbMs
   * @param entry
   */
  protected final void run(final long nbMs, final WaarpErrorValuesIndex entry) {
<span class="nc" id="L1369">    synchronized (trafficCounter) {</span>
<span class="nc" id="L1370">      final long limitDate = System.currentTimeMillis() - nbMs;</span>
<span class="nc bnc" id="L1371" title="All 4 branches missed.">      if (dbSession == null || dbSession.isDisActive()) {</span>
<span class="nc" id="L1372">        return;</span>
      }
      // Error
<span class="nc bnc" id="L1375" title="All 25 branches missed.">      switch (entry) {</span>
        case nbStatusConnectionImpossible:
<span class="nc" id="L1377">          nbCountStatusConnectionImpossible =</span>
<span class="nc" id="L1378">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.ConnectionImpossible,
                                                          limitDate);
<span class="nc" id="L1381">          updateErrorValue(entry.ordinal(), nbCountStatusConnectionImpossible);</span>
<span class="nc" id="L1382">          return;</span>
        case nbStatusServerOverloaded:
<span class="nc" id="L1384">          nbCountStatusServerOverloaded =</span>
<span class="nc" id="L1385">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.ServerOverloaded,
                                                          limitDate);
<span class="nc" id="L1388">          updateErrorValue(entry.ordinal(), nbCountStatusServerOverloaded);</span>
<span class="nc" id="L1389">          return;</span>
        case nbStatusBadAuthent:
<span class="nc" id="L1391">          nbCountStatusBadAuthent =</span>
<span class="nc" id="L1392">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.BadAuthent,
                                                          limitDate);
<span class="nc" id="L1395">          updateErrorValue(entry.ordinal(), nbCountStatusBadAuthent);</span>
<span class="nc" id="L1396">          return;</span>
        case nbStatusExternalOp:
<span class="nc" id="L1398">          nbCountStatusExternalOp =</span>
<span class="nc" id="L1399">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.ExternalOp,
                                                          limitDate);
<span class="nc" id="L1402">          updateErrorValue(entry.ordinal(), nbCountStatusExternalOp);</span>
<span class="nc" id="L1403">          return;</span>
        case nbStatusTransferError:
<span class="nc" id="L1405">          nbCountStatusTransferError =</span>
<span class="nc" id="L1406">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.TransferError,
                                                          limitDate);
<span class="nc" id="L1409">          updateErrorValue(entry.ordinal(), nbCountStatusTransferError);</span>
<span class="nc" id="L1410">          return;</span>
        case nbStatusMD5Error:
<span class="nc" id="L1412">          nbCountStatusMD5Error =</span>
<span class="nc" id="L1413">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.MD5Error,
                                                          limitDate);
<span class="nc" id="L1416">          updateErrorValue(entry.ordinal(), nbCountStatusMD5Error);</span>
<span class="nc" id="L1417">          return;</span>
        case nbStatusDisconnection:
<span class="nc" id="L1419">          nbCountStatusDisconnection =</span>
<span class="nc" id="L1420">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.Disconnection,
                                                          limitDate);
<span class="nc" id="L1423">          updateErrorValue(entry.ordinal(), nbCountStatusDisconnection);</span>
<span class="nc" id="L1424">          return;</span>
        case nbStatusFinalOp:
<span class="nc" id="L1426">          nbCountStatusFinalOp =</span>
<span class="nc" id="L1427">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.FinalOp,
                                                          limitDate);
<span class="nc" id="L1430">          updateErrorValue(entry.ordinal(), nbCountStatusFinalOp);</span>
<span class="nc" id="L1431">          return;</span>
        case nbStatusUnimplemented:
<span class="nc" id="L1433">          nbCountStatusUnimplemented =</span>
<span class="nc" id="L1434">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.Unimplemented,
                                                          limitDate);
<span class="nc" id="L1437">          updateErrorValue(entry.ordinal(), nbCountStatusUnimplemented);</span>
<span class="nc" id="L1438">          return;</span>
        case nbStatusInternal:
<span class="nc" id="L1440">          nbCountStatusInternal =</span>
<span class="nc" id="L1441">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.Internal,
                                                          limitDate);
<span class="nc" id="L1444">          updateErrorValue(entry.ordinal(), nbCountStatusInternal);</span>
<span class="nc" id="L1445">          return;</span>
        case nbStatusWarning:
<span class="nc" id="L1447">          nbCountStatusWarning =</span>
<span class="nc" id="L1448">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.Warning,
                                                          limitDate);
<span class="nc" id="L1451">          updateErrorValue(entry.ordinal(), nbCountStatusWarning);</span>
<span class="nc" id="L1452">          return;</span>
        case nbStatusQueryAlreadyFinished:
<span class="nc" id="L1454">          nbCountStatusQueryAlreadyFinished =</span>
<span class="nc" id="L1455">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.QueryAlreadyFinished,
                                                          limitDate);
<span class="nc" id="L1458">          updateErrorValue(entry.ordinal(), nbCountStatusQueryAlreadyFinished);</span>
<span class="nc" id="L1459">          return;</span>
        case nbStatusQueryStillRunning:
<span class="nc" id="L1461">          nbCountStatusQueryStillRunning =</span>
<span class="nc" id="L1462">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.QueryStillRunning,
                                                          limitDate);
<span class="nc" id="L1465">          updateErrorValue(entry.ordinal(), nbCountStatusQueryStillRunning);</span>
<span class="nc" id="L1466">          return;</span>
        case nbStatusNotKnownHost:
<span class="nc" id="L1468">          nbCountStatusNotKnownHost =</span>
<span class="nc" id="L1469">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.NotKnownHost,
                                                          limitDate);
<span class="nc" id="L1472">          updateErrorValue(entry.ordinal(), nbCountStatusNotKnownHost);</span>
<span class="nc" id="L1473">          return;</span>
        case nbStatusQueryRemotelyUnknown:
<span class="nc" id="L1475">          nbCountStatusQueryRemotelyUnknown =</span>
<span class="nc" id="L1476">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.QueryRemotelyUnknown,
                                                          limitDate);
<span class="nc" id="L1479">          updateErrorValue(entry.ordinal(), nbCountStatusQueryRemotelyUnknown);</span>
<span class="nc" id="L1480">          return;</span>
        case nbStatusCommandNotFound:
<span class="nc" id="L1482">          nbCountStatusCommandNotFound =</span>
<span class="nc" id="L1483">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.CommandNotFound,
                                                          limitDate);
<span class="nc" id="L1486">          updateErrorValue(entry.ordinal(), nbCountStatusCommandNotFound);</span>
<span class="nc" id="L1487">          return;</span>
        case nbStatusPassThroughMode:
<span class="nc" id="L1489">          nbCountStatusPassThroughMode =</span>
<span class="nc" id="L1490">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.PassThroughMode,
                                                          limitDate);
<span class="nc" id="L1493">          updateErrorValue(entry.ordinal(), nbCountStatusPassThroughMode);</span>
<span class="nc" id="L1494">          return;</span>
        case nbStatusRemoteShutdown:
<span class="nc" id="L1496">          nbCountStatusRemoteShutdown =</span>
<span class="nc" id="L1497">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.RemoteShutdown,
                                                          limitDate);
<span class="nc" id="L1500">          updateErrorValue(entry.ordinal(), nbCountStatusRemoteShutdown);</span>
<span class="nc" id="L1501">          return;</span>
        case nbStatusShutdown:
<span class="nc" id="L1503">          nbCountStatusShutdown =</span>
<span class="nc" id="L1504">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.Shutdown,
                                                          limitDate);
<span class="nc" id="L1507">          updateErrorValue(entry.ordinal(), nbCountStatusShutdown);</span>
<span class="nc" id="L1508">          return;</span>
        case nbStatusRemoteError:
<span class="nc" id="L1510">          nbCountStatusRemoteError =</span>
<span class="nc" id="L1511">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.RemoteError,
                                                          limitDate);
<span class="nc" id="L1514">          updateErrorValue(entry.ordinal(), nbCountStatusRemoteError);</span>
<span class="nc" id="L1515">          return;</span>
        case nbStatusStopped:
<span class="nc" id="L1517">          nbCountStatusStopped =</span>
<span class="nc" id="L1518">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.StoppedTransfer,
                                                          limitDate);
<span class="nc" id="L1521">          updateErrorValue(entry.ordinal(), nbCountStatusStopped);</span>
<span class="nc" id="L1522">          return;</span>
        case nbStatusCanceled:
<span class="nc" id="L1524">          nbCountStatusCanceled =</span>
<span class="nc" id="L1525">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.CanceledTransfer,
                                                          limitDate);
<span class="nc" id="L1528">          updateErrorValue(entry.ordinal(), nbCountStatusCanceled);</span>
<span class="nc" id="L1529">          return;</span>
        case nbStatusFileNotFound:
<span class="nc" id="L1531">          nbCountStatusFileNotFound =</span>
<span class="nc" id="L1532">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.FileNotFound,
                                                          limitDate);
<span class="nc" id="L1535">          updateErrorValue(entry.ordinal(), nbCountStatusFileNotFound);</span>
<span class="nc" id="L1536">          return;</span>
        case nbStatusUnknown:
<span class="nc" id="L1538">          nbCountStatusUnknown =</span>
<span class="nc" id="L1539">              DbTaskRunner.getResultCountPrepareStatement(countStatus,</span>
                                                          ErrorCode.Unknown,
                                                          limitDate);
<span class="nc" id="L1542">          updateErrorValue(entry.ordinal(), nbCountStatusUnknown);</span>
      }
<span class="nc" id="L1544">    }</span>
<span class="nc" id="L1545">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>